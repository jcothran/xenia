OpenLayers.Filter.ComparisonEx=OpenLayers.Class(OpenLayers.Filter.Comparison,{initialize:function(a){OpenLayers.Filter.Comparison.prototype.initialize.apply(this,[a])},getAttribute:function(e,f,b){var d=f[0];if(typeOfEx(e[d])=="object"){var a=f.slice(1,f.length);this.getAttribute(e[d],a,b)}else{if(typeOfEx(e[d])=="array"){var a=f.slice(1,f.length);for(var c=0;c<e[d].length;c++){this.getAttribute(e[d][c],a,b)}}else{b.push(e[d])}}},evaluate:function(e){if(e instanceof OpenLayers.Feature.Vector){e=e.attributes}var f=false;var h=this.property.split(".");var c=[];this.getAttribute(e,h,c);for(var d=0;d<c.length;d++){var b=c[d];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:var g=this.value;if(!this.matchCase&&typeof b=="string"&&typeof g=="string"){f=(b.toUpperCase()==g.toUpperCase())}else{f=(b==g)}break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:var g=this.value;if(!this.matchCase&&typeof b=="string"&&typeof g=="string"){f=(b.toUpperCase()!=g.toUpperCase())}else{f=(b!=g)}break;case OpenLayers.Filter.Comparison.LESS_THAN:f=b<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:f=b>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:f=b<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:f=b>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:f=(b>=this.lowerBoundary)&&(b<=this.upperBoundary);break;case OpenLayers.Filter.Comparison.LIKE:var a=new RegExp(this.value,"gi");f=a.test(b);break}if(f==true){break}}return f}});Ext.namespace("GeoExt");GeoExt.LayerLegend=Ext.extend(Ext.Container,{layerRecord:null,showTitle:true,legendTitle:null,labelCls:null,layerStore:null,initComponent:function(){GeoExt.LayerLegend.superclass.initComponent.call(this);this.autoEl={};this.add({xtype:"label",text:this.getLayerTitle(this.layerRecord),cls:"x-form-item x-form-item-label"+(this.labelCls?" "+this.labelCls:"")});if(this.layerRecord&&this.layerRecord.store){this.layerStore=this.layerRecord.store;this.layerStore.on("update",this.onStoreUpdate,this)}},onStoreUpdate:function(b,d,a){if(d===this.layerRecord&&this.items.getCount()>0){var c=d.getLayer();this.setVisible(c.getVisibility()&&c.calculateInRange()&&c.displayInLayerSwitcher&&!d.get("hideInLegend"));this.update()}},update:function(){var a=this.getLayerTitle(this.layerRecord);if(this.items.get(0).text!==a){this.items.get(0).setText(a)}},getLayerTitle:function(a){var b=this.legendTitle||"";if(this.showTitle&&!b){if(a&&!a.get("hideTitle")){b=a.get("title")||a.get("name")||a.getLayer().name||""}}return b},beforeDestroy:function(){this.layerStore&&this.layerStore.un("update",this.onStoreUpdate,this);GeoExt.LayerLegend.superclass.beforeDestroy.apply(this,arguments)}});GeoExt.LayerLegend.getTypes=function(d,e){var b=(e||[]).concat();var a=[];for(var c in GeoExt.LayerLegend.types){if(GeoExt.LayerLegend.types[c].supports(d)){b.indexOf(c)==-1&&a.push(c)}else{b.remove(c)}}return b.concat(a)};GeoExt.LayerLegend.supports=function(a){};GeoExt.LayerLegend.types={};Ext.namespace("GeoExt");GeoExt.VectorLegend=Ext.extend(GeoExt.LayerLegend,{layerRecord:null,layer:null,rules:null,symbolType:null,untitledPrefix:"Untitled ",clickableSymbol:false,clickableTitle:false,selectOnClick:false,enableDD:false,bodyBorder:false,feature:null,selectedRule:null,currentScaleDenominator:null,initComponent:function(){GeoExt.VectorLegend.superclass.initComponent.call(this);if(this.layerRecord){this.layer=this.layerRecord.getLayer();if(this.layer.map){this.currentScaleDenominator=this.layer.map.getScale();this.layer.map.events.on({zoomend:this.onMapZoom,scope:this})}}if(!this.symbolType){if(this.feature){this.symbolType=this.symbolTypeFromFeature(this.feature)}else{if(this.layer){if(this.layer.features.length>0){var a=this.layer.features[0].clone();a.attributes={};this.feature=a;this.symbolType=this.symbolTypeFromFeature(this.feature)}else{this.layer.events.on({featuresadded:this.onFeaturesAdded,scope:this})}}}}if(this.layer&&this.feature&&!this.rules){this.setRules()}this.rulesContainer=new Ext.Container({autoEl:{}});this.add(this.rulesContainer);this.addEvents("titleclick","symbolclick","ruleclick","ruleselected","ruleunselected","rulemoved");this.update()},onMapZoom:function(){this.setCurrentScaleDenominator(this.layer.map.getScale())},symbolTypeFromFeature:function(b){var a=b.geometry.CLASS_NAME.match(/Point|Line|Polygon/);return(a&&a[0])||"Point"},onFeaturesAdded:function(){this.layer.events.un({featuresadded:this.onFeaturesAdded,scope:this});var a=this.layer.features[0].clone();a.attributes={};this.feature=a;this.symbolType=this.symbolTypeFromFeature(this.feature);if(!this.rules){this.setRules()}this.update()},setRules:function(){var a=this.layer.styleMap&&this.layer.styleMap.styles["default"];if(!a){a=new OpenLayers.Style()}if(a.rules.length===0){this.rules=[new OpenLayers.Rule({symbolizer:a.createSymbolizer(this.feature)})]}else{this.rules=a.rules}},setCurrentScaleDenominator:function(a){if(a!==this.currentScaleDenominator){this.currentScaleDenominator=a;this.update()}},getRuleEntry:function(a){return this.rulesContainer.items.get(this.rules.indexOf(a))},addRuleEntry:function(a,b){this.rulesContainer.add(this.createRuleEntry(a));if(!b){this.doLayout()}},removeRuleEntry:function(a,c){var b=this.getRuleEntry(a);if(b){this.rulesContainer.remove(b);if(!c){this.doLayout()}}},selectRuleEntry:function(b){var a=b!=this.selectedRule;if(this.selectedRule){this.unselect()}if(a){var c=this.getRuleEntry(b);c.body.addClass("x-grid3-row-selected");this.selectedRule=b;
this.fireEvent("ruleselected",this,b)}},unselect:function(){this.rulesContainer.items.each(function(b,a){if(this.rules[a]==this.selectedRule){b.body.removeClass("x-grid3-row-selected");this.selectedRule=null;this.fireEvent("ruleunselected",this,this.rules[a])}},this)},createRuleEntry:function(b){var a=true;if(this.currentScaleDenominator!=null){if(b.minScaleDenominator){a=a&&(this.currentScaleDenominator>=b.minScaleDenominator)}if(b.maxScaleDenominator){a=a&&(this.currentScaleDenominator<b.maxScaleDenominator)}}return{xtype:"panel",layout:"column",border:false,hidden:!a,bodyStyle:this.selectOnClick?{cursor:"pointer"}:undefined,defaults:{border:false},items:[this.createRuleRenderer(b),this.createRuleTitle(b)],listeners:{render:function(c){this.selectOnClick&&c.getEl().on({click:function(d){this.selectRuleEntry(b)},scope:this});if(this.enableDD==true){this.addDD(c)}},scope:this}}},createRuleRenderer:function(k){var g=[this.symbolType,"Point","Line","Polygon"];var h,e;var m=k.symbolizers;if(!m){var n=k.symbolizer;for(var c=0,f=g.length;c<f;++c){h=g[c];if(n[h]){n=n[h];e=true;break}}m=[n]}else{var a;outer:for(var c=0,l=g.length;c<l;++c){h=g[c];a=OpenLayers.Symbolizer[h];if(a){for(var b=0,d=m.length;b<d;++b){if(m[b] instanceof a){e=true;break outer}}}}}return{xtype:"gx_renderer",symbolType:e?h:this.symbolType,symbolizers:m,style:this.clickableSymbol?{cursor:"pointer"}:undefined,listeners:{click:function(){if(this.clickableSymbol){this.fireEvent("symbolclick",this,k);this.fireEvent("ruleclick",this,k)}},scope:this}}},createRuleTitle:function(a){return{cls:"x-form-item",style:"padding: 0.2em 0.5em 0;",bodyStyle:Ext.applyIf({background:"transparent"},this.clickableTitle?{cursor:"pointer"}:undefined),html:this.getRuleTitle(a),listeners:{render:function(b){this.clickableTitle&&b.getEl().on({click:function(){this.fireEvent("titleclick",this,a);this.fireEvent("ruleclick",this,a)},scope:this})},scope:this}}},addDD:function(c){var b=c.ownerCt;var a=this;new Ext.dd.DragSource(c.getEl(),{ddGroup:b.id,onDragOut:function(f,d){var g=Ext.getCmp(d);g.removeClass("gx-ruledrag-insert-above");g.removeClass("gx-ruledrag-insert-below");return Ext.dd.DragZone.prototype.onDragOut.apply(this,arguments)},onDragEnter:function(i,g){var j=Ext.getCmp(g);var f;var h=b.items.indexOf(c);var d=b.items.indexOf(j);if(h>d){f="gx-ruledrag-insert-above"}else{if(h<d){f="gx-ruledrag-insert-below"}}f&&j.addClass(f);return Ext.dd.DragZone.prototype.onDragEnter.apply(this,arguments)},onDragDrop:function(f,d){a.moveRule(b.items.indexOf(c),b.items.indexOf(Ext.getCmp(d)));return Ext.dd.DragZone.prototype.onDragDrop.apply(this,arguments)},getDragData:function(g){var f=g.getTarget(".x-column-inner");if(f){var h=f.cloneNode(true);h.id=Ext.id();return{sourceEl:f,repairXY:Ext.fly(f).getXY(),ddel:h}}}});new Ext.dd.DropTarget(c.getEl(),{ddGroup:b.id,notifyDrop:function(){return true}})},update:function(){GeoExt.VectorLegend.superclass.update.apply(this,arguments);if(this.symbolType&&this.rules){if(this.rulesContainer.items){var a;for(var b=this.rulesContainer.items.length-1;b>=0;--b){a=this.rulesContainer.getComponent(b);this.rulesContainer.remove(a,true)}}for(var b=0,c=this.rules.length;b<c;++b){this.addRuleEntry(this.rules[b],true)}this.doLayout();if(this.selectedRule){this.getRuleEntry(this.selectedRule).body.addClass("x-grid3-row-selected")}}},updateRuleEntry:function(a){var b=this.getRuleEntry(a);if(b){b.removeAll();b.add(this.createRuleRenderer(a));b.add(this.createRuleTitle(a));b.doLayout()}},moveRule:function(b,a){var c=this.rules[b];this.rules.splice(b,1);this.rules.splice(a,0,c);this.update();this.fireEvent("rulemoved",this,c)},getRuleTitle:function(a){var b=a.title||a.name||"";if(!b&&this.untitledPrefix){b=this.untitledPrefix+(this.rules.indexOf(a)+1)}return b},beforeDestroy:function(){if(this.layer){if(this.layer.events){this.layer.events.un({featuresadded:this.onFeaturesAdded,scope:this})}if(this.layer.map&&this.layer.map.events){this.layer.map.events.un({zoomend:this.onMapZoom,scope:this})
}}delete this.layer;delete this.rules;GeoExt.VectorLegend.superclass.beforeDestroy.apply(this,arguments)}});GeoExt.VectorLegend.supports=function(a){return a.getLayer() instanceof OpenLayers.Layer.Vector};GeoExt.LayerLegend.types.gx_vectorlegend=GeoExt.VectorLegend;Ext.reg("gx_vectorlegend",GeoExt.VectorLegend);Ext.namespace("GeoExt.tree");GeoExt.tree.LayerContainer=Ext.extend(Ext.tree.AsyncTreeNode,{constructor:function(a){a=Ext.applyIf(a||{},{text:"Layers"});this.loader=a.loader instanceof GeoExt.tree.LayerLoader?a.loader:new GeoExt.tree.LayerLoader(Ext.applyIf(a.loader||{},{store:a.layerStore}));GeoExt.tree.LayerContainer.superclass.constructor.call(this,a)},recordIndexToNodeIndex:function(c){var b=this.loader.store;var e=b.getCount();var a=this.childNodes.length;var f=-1;for(var d=e-1;d>=0;--d){if(this.loader.filter(b.getAt(d))===true){++f;if(c===d||f>a-1){break}}}return f},destroy:function(){delete this.layerStore;GeoExt.tree.LayerContainer.superclass.destroy.apply(this,arguments)}});Ext.tree.TreePanel.nodeTypes.gx_layercontainer=GeoExt.tree.LayerContainer;Ext.namespace("GeoExt.tree");GeoExt.tree.BaseLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{constructor:function(a){a=Ext.applyIf(a||{},{text:"Base Layer",loader:{}});a.loader=Ext.applyIf(a.loader,{baseAttrs:Ext.applyIf(a.loader.baseAttrs||{},{iconCls:"gx-tree-baselayer-icon",checkedGroup:"baselayer"}),filter:function(c){var b=c.getLayer();return b.displayInLayerSwitcher===true&&b.isBaseLayer===true}});GeoExt.tree.BaseLayerContainer.superclass.constructor.call(this,a)}});Ext.tree.TreePanel.nodeTypes.gx_baselayercontainer=GeoExt.tree.BaseLayerContainer;Ext.namespace("GeoExt.plugins");GeoExt.plugins.PrintExtent=Ext.extend(Ext.util.Observable,{initialConfig:null,printProvider:null,map:null,layer:null,control:null,pages:null,page:null,constructor:function(a){a=a||{};Ext.apply(this,a);this.initialConfig=a;if(!this.printProvider){this.printProvider=this.pages[0].printProvider}if(!this.pages){this.pages=[]}this.addEvents("selectpage");GeoExt.plugins.PrintExtent.superclass.constructor.apply(this,arguments)},print:function(a){this.printProvider.print(this.map,this.pages,a)},init:function(c){this.map=c.map;c.on("destroy",this.onMapPanelDestroy,this);if(!this.layer){this.layer=new OpenLayers.Layer.Vector(null,{displayInLayerSwitcher:false})}this.createControl();for(var b=0,a=this.pages.length;b<a;++b){this.addPage(this.pages[b])}this.show()},addPage:function(a){a=a||new GeoExt.data.PrintPage({printProvider:this.printProvider});if(this.pages.indexOf(a)===-1){this.pages.push(a)}this.layer.addFeatures([a.feature]);a.on("change",this.onPageChange,this);this.page=a;var b=this.map;if(b.getCenter()){this.fitPage()}else{b.events.register("moveend",this,function(){b.events.unregister("moveend",this,arguments.callee);this.fitPage()})}return a},removePage:function(a){this.pages.remove(a);if(a.feature.layer){this.layer.removeFeatures([a.feature])}a.un("change",this.onPageChange,this)},selectPage:function(a){this.control.active&&this.control.setFeature(a.feature)},show:function(){this.map.addLayer(this.layer);this.map.addControl(this.control);this.control.activate();if(this.page&&this.map.getCenter()){this.updateBox()}},hide:function(){var c=this.map;var b=this.control;if(b&&b.events){b.deactivate();if(c&&c.events&&b.map){c.removeControl(b)}}var a=this.layer;if(!this.initialConfig.layer&&c&&c.events&&a&&a.map){c.removeLayer(a)}},onMapPanelDestroy:function(){var e=this.map;for(var a=this.pages.length-1,c=a;c>=0;c--){this.removePage(this.pages[c])}this.hide();var d=this.control;if(e&&e.events&&d&&d.events){d.destroy()}var b=this.layer;if(!this.initialConfig.layer&&e&&e.events&&b&&b.events){b.destroy()}delete this.layer;delete this.control;delete this.page;this.map=null},createControl:function(){this.control=new OpenLayers.Control.TransformFeature(this.layer,{preserveAspectRatio:true,eventListeners:{beforesetfeature:function(c){for(var b=0,a=this.pages.length;b<a;++b){if(this.pages[b].feature===c.feature){this.page=this.pages[b];
c.object.rotation=-this.pages[b].rotation;break}}},setfeature:function(c){for(var b=0,a=this.pages.length;b<a;++b){if(this.pages[b].feature===c.feature){this.fireEvent("selectpage",this.pages[b]);break}}},beforetransform:function(g){this._updating=true;var f=this.page;if(g.rotation){if(this.printProvider.layout.get("rotation")){f.setRotation(-g.object.rotation)}else{g.object.setFeature(f.feature)}}else{if(g.center){f.setCenter(OpenLayers.LonLat.fromString(g.center.toShortString()))}else{f.fit(g.object.box,{mode:"closest"});var h=this.printProvider.scales.getAt(0);var i=this.printProvider.scales.getAt(this.printProvider.scales.getCount()-1);var d=g.object.box.geometry.getBounds();var c=f.feature.geometry.getBounds();var b=f.scale===h&&d.containsBounds(c);var a=f.scale===i&&c.containsBounds(d);if(b===true||a===true){this.updateBox()}}}delete this._updating;return false},transformcomplete:this.updateBox,scope:this}})},fitPage:function(){if(this.page){this.page.fit(this.map,{mode:"screen"})}},updateBox:function(){var a=this.page;this.control.active&&this.control.setFeature(a.feature,{rotation:-a.rotation})},onPageChange:function(b,a){if(!this._updating){this.control.active&&this.control.setFeature(b.feature,{rotation:-b.rotation})}}});Ext.preg("gx_printextent",GeoExt.plugins.PrintExtent);Ext.namespace("GeoExt");GeoExt.SliderTip=Ext.extend(Ext.slider.Tip,{hover:true,minWidth:10,offsets:[0,-10],dragging:false,init:function(a){GeoExt.SliderTip.superclass.init.apply(this,arguments);if(this.hover){a.on("render",this.registerThumbListeners,this)}this.slider=a},registerThumbListeners:function(){var a,d;for(var b=0,c=this.slider.thumbs.length;b<c;++b){a=this.slider.thumbs[b];d=a.tracker.el;(function(e,f){f.on({mouseover:function(g){this.onSlide(this.slider,g,e);this.dragging=false},mouseout:function(){if(!this.dragging){this.hide.apply(this,arguments)}},scope:this})}).apply(this,[a,d])}},onSlide:function(a,c,b){this.dragging=true;return GeoExt.SliderTip.superclass.onSlide.apply(this,arguments)}});Ext.namespace("GeoExt");GeoExt.ZoomSlider=Ext.extend(Ext.Slider,{map:null,baseCls:"gx-zoomslider",aggressive:false,updating:false,initComponent:function(){GeoExt.ZoomSlider.superclass.initComponent.call(this);if(this.map){if(this.map instanceof GeoExt.MapPanel){this.map=this.map.map}this.bind(this.map)}if(this.aggressive===true){this.on("change",this.changeHandler,this)}else{this.on("changecomplete",this.changeHandler,this)}this.on("beforedestroy",this.unbind,this)},onRender:function(){GeoExt.ZoomSlider.superclass.onRender.apply(this,arguments);this.el.addClass(this.baseCls)},afterRender:function(){Ext.Slider.superclass.afterRender.apply(this,arguments);this.update()},addToMapPanel:function(a){this.on({render:function(){var b=this.getEl();b.setStyle({position:"absolute",zIndex:a.map.Z_INDEX_BASE.Control});b.on({mousedown:this.stopMouseEvents,click:this.stopMouseEvents})},afterrender:function(){this.bind(a.map)},scope:this})},stopMouseEvents:function(a){a.stopEvent()},removeFromMapPanel:function(a){var b=this.getEl();b.un("mousedown",this.stopMouseEvents,this);b.un("click",this.stopMouseEvents,this);this.unbind()},bind:function(a){this.map=a;this.map.events.on({zoomend:this.update,changebaselayer:this.initZoomValues,scope:this});if(this.map.baseLayer){this.initZoomValues();this.update()}},unbind:function(){if(this.map){this.map.events.un({zoomend:this.update,changebaselayer:this.initZoomValues,scope:this})}},initZoomValues:function(){var a=this.map.baseLayer;if(this.initialConfig.minValue===undefined){this.minValue=a.minZoomLevel||0}if(this.initialConfig.maxValue===undefined){this.maxValue=a.minZoomLevel==null?a.numZoomLevels-1:a.maxZoomLevel}},getZoom:function(){return this.getValue()},getScale:function(){return OpenLayers.Util.getScaleFromResolution(this.map.getResolutionForZoom(this.getValue()),this.map.getUnits())},getResolution:function(){return this.map.getResolutionForZoom(this.getValue())},changeHandler:function(){if(this.map&&!this.updating){this.map.zoomTo(this.getValue())
}},update:function(){if(this.rendered&&this.map){this.updating=true;this.setValue(this.map.getZoom());this.updating=false}}});Ext.reg("gx_zoomslider",GeoExt.ZoomSlider);Ext.namespace("GeoExt.tree");GeoExt.tree.WMSCapabilitiesLoader=function(a){Ext.apply(this,a);GeoExt.tree.WMSCapabilitiesLoader.superclass.constructor.call(this)};Ext.extend(GeoExt.tree.WMSCapabilitiesLoader,Ext.tree.TreeLoader,{url:null,layerOptions:null,layerParams:null,requestMethod:"GET",getParams:function(a){return{service:"WMS",request:"GetCapabilities"}},processResponse:function(b,c,e,a){var d=new OpenLayers.Format.WMSCapabilities().read(b.responseXML||b.responseText);this.processLayer(d.capability,d.capability.request.getmap.href,c);if(typeof e=="function"){e.apply(a||c,[c])}},createWMSLayer:function(b,a){if(b.name){return new OpenLayers.Layer.WMS(b.title,a,OpenLayers.Util.extend({formats:b.formats[0],layers:b.name},this.layerParams),OpenLayers.Util.extend({minScale:b.minScale,queryable:b.queryable,maxScale:b.maxScale,metadata:b},this.layerOptions))}else{return null}},processLayer:function(b,a,c){Ext.each(b.nestedLayers,function(d){var e=this.createNode({text:d.title||d.name,nodeType:"node",layer:this.createWMSLayer(d,a),leaf:(d.nestedLayers.length===0)});if(e){c.appendChild(e)}if(d.nestedLayers){this.processLayer(d,a,e)}},this)}});Ext.namespace("GeoExt.data");GeoExt.data.WMSCapabilitiesReader=function(a,b){a=a||{};if(!a.format){a.format=new OpenLayers.Format.WMSCapabilities()}if(typeof b!=="function"){b=GeoExt.data.LayerRecord.create(b||a.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"abstract",type:"string"},{name:"queryable",type:"boolean"},{name:"opaque",type:"boolean"},{name:"noSubsets",type:"boolean"},{name:"cascaded",type:"int"},{name:"fixedWidth",type:"int"},{name:"fixedHeight",type:"int"},{name:"minScale",type:"float"},{name:"maxScale",type:"float"},{name:"prefix",type:"string"},{name:"formats"},{name:"styles"},{name:"srs"},{name:"dimensions"},{name:"bbox"},{name:"llbbox"},{name:"attribution"},{name:"keywords"},{name:"identifiers"},{name:"authorityURLs"},{name:"metadataURLs"}])}GeoExt.data.WMSCapabilitiesReader.superclass.constructor.call(this,a,b)};Ext.extend(GeoExt.data.WMSCapabilitiesReader,Ext.data.DataReader,{attributionCls:"gx-attribution",read:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}return this.readRecords(b)},serviceExceptionFormat:function(a){if(OpenLayers.Util.indexOf(a,"application/vnd.ogc.se_inimage")>-1){return"application/vnd.ogc.se_inimage"}if(OpenLayers.Util.indexOf(a,"application/vnd.ogc.se_xml")>-1){return"application/vnd.ogc.se_xml"}return a[0]},imageFormat:function(a){var b=a.formats;if(a.opaque&&OpenLayers.Util.indexOf(b,"image/jpeg")>-1){return"image/jpeg"}if(OpenLayers.Util.indexOf(b,"image/png")>-1){return"image/png"}if(OpenLayers.Util.indexOf(b,"image/png; mode=24bit")>-1){return"image/png; mode=24bit"}if(OpenLayers.Util.indexOf(b,"image/gif")>-1){return"image/gif"}return b[0]},imageTransparent:function(a){return a.opaque==undefined||!a.opaque},readRecords:function(t){if(typeof t==="string"||t.nodeType){t=this.meta.format.read(t)}var c=t.version;var g=t.capability||{};var d=g.request&&g.request.getmap&&g.request.getmap.href;var b=g.layers;var e=g.exception?g.exception.formats:[];var n=this.serviceExceptionFormat(e);var o=[];if(d&&b){var s=this.recordType.prototype.fields;var u,h,f,l,a,k;for(var p=0,r=b.length;p<r;p++){u=b[p];if(u.name){h={};for(var m=0,q=s.length;m<q;m++){a=s.items[m];k=u[a.mapping||a.name]||a.defaultValue;k=a.convert(k);h[a.name]=k}f={attribution:u.attribution?this.attributionMarkup(u.attribution):undefined,minScale:u.minScale,maxScale:u.maxScale};if(this.meta.layerOptions){Ext.apply(f,this.meta.layerOptions)}l={layers:u.name,exceptions:n,format:this.imageFormat(u),transparent:this.imageTransparent(u),version:c};if(this.meta.layerParams){Ext.apply(l,this.meta.layerParams)}h.layer=new OpenLayers.Layer.WMS(u.title||u.name,d,l,f);o.push(new this.recordType(h,h.layer.id))
}}}return{totalRecords:o.length,success:true,records:o}},attributionMarkup:function(c){var b=[];if(c.logo){b.push("<img class='"+this.attributionCls+"-image' src='"+c.logo.href+"' />")}if(c.title){b.push("<span class='"+this.attributionCls+"-title'>"+c.title+"</span>")}if(c.href){for(var a=0;a<b.length;a++){b[a]="<a class='"+this.attributionCls+"-link' href="+c.href+">"+b[a]+"</a>"}}return b.join(" ")}});Ext.namespace("GeoExt.data");GeoExt.data.LayerStoreMixin=function(){return{map:null,reader:null,constructor:function(b){b=b||{};b.reader=b.reader||new GeoExt.data.LayerReader({},b.fields);delete b.fields;var c=b.map instanceof GeoExt.MapPanel?b.map.map:b.map;delete b.map;if(b.layers){b.data=b.layers}delete b.layers;var a={initDir:b.initDir};delete b.initDir;arguments.callee.superclass.constructor.call(this,b);if(c){this.bind(c,a)}},bind:function(c,a){if(this.map){return}this.map=c;a=a||{};var b=a.initDir;if(a.initDir==undefined){b=GeoExt.data.LayerStore.MAP_TO_STORE|GeoExt.data.LayerStore.STORE_TO_MAP}var d=c.layers.slice(0);if(b&GeoExt.data.LayerStore.STORE_TO_MAP){this.each(function(e){this.map.addLayer(e.getLayer())},this)}if(b&GeoExt.data.LayerStore.MAP_TO_STORE){this.loadData(d,true)}c.events.on({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this});this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this});this.data.on({replace:this.onReplace,scope:this})},unbind:function(){if(this.map){this.map.events.un({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this});this.un("load",this.onLoad,this);this.un("clear",this.onClear,this);this.un("add",this.onAdd,this);this.un("remove",this.onRemove,this);this.data.un("replace",this.onReplace,this);this.map=null}},onChangeLayer:function(a){var d=a.layer;var b=this.findBy(function(f,g){return f.getLayer()===d});if(b>-1){var e=this.getAt(b);if(a.property==="order"){if(!this._adding&&!this._removing){var c=this.map.getLayerIndex(d);if(c!==b){this._removing=true;this.remove(e);delete this._removing;this._adding=true;this.insert(c,[e]);delete this._adding}}}else{if(a.property==="name"){e.set("title",d.name)}else{this.fireEvent("update",this,e,Ext.data.Record.EDIT)}}}},onAddLayer:function(a){if(!this._adding){var b=a.layer;this._adding=true;this.loadData([b],true);delete this._adding}},onRemoveLayer:function(a){if(this.map.unloadDestroy){if(!this._removing){var b=a.layer;this._removing=true;this.remove(this.getById(b.id));delete this._removing}}else{this.unbind()}},onLoad:function(c,b,f){if(!Ext.isArray(b)){b=[b]}if(f&&!f.add){this._removing=true;for(var e=this.map.layers.length-1;e>=0;e--){this.map.removeLayer(this.map.layers[e])}delete this._removing;var a=b.length;if(a>0){var g=new Array(a);for(var d=0;d<a;d++){g[d]=b[d].getLayer()}this._adding=true;this.map.addLayers(g);delete this._adding}}},onClear:function(a){this._removing=true;for(var b=this.map.layers.length-1;b>=0;b--){this.map.removeLayer(this.map.layers[b])}delete this._removing},onAdd:function(b,a,c){if(!this._adding){this._adding=true;var e;for(var d=a.length-1;d>=0;--d){e=a[d].getLayer();this.map.addLayer(e);if(c!==this.map.layers.length-1){this.map.setLayerIndex(e,c)}}delete this._adding}},onRemove:function(a,d,b){if(!this._removing){var c=d.getLayer();if(this.map.getLayer(c.id)!=null){this._removing=true;this.removeMapLayer(d);delete this._removing}}},onUpdate:function(b,d,a){if(a===Ext.data.Record.EDIT){if(d.modified&&d.modified.title){var c=d.getLayer();var e=d.get("title");if(e!==c.name){c.setName(e)}}}},removeMapLayer:function(a){this.map.removeLayer(a.getLayer())},onReplace:function(b,a,c){this.removeMapLayer(a)},getByLayer:function(b){var a=this.findBy(function(c){return c.getLayer()===b});if(a>-1){return this.getAt(a)}},destroy:function(){this.unbind();GeoExt.data.LayerStore.superclass.destroy.call(this)}}};GeoExt.data.LayerStore=Ext.extend(Ext.data.Store,new GeoExt.data.LayerStoreMixin);
GeoExt.data.LayerStore.MAP_TO_STORE=1;GeoExt.data.LayerStore.STORE_TO_MAP=2;Ext.namespace("GeoExt.tree");GeoExt.tree.LayerLoader=function(a){Ext.apply(this,a);this.addEvents("beforeload","load");GeoExt.tree.LayerLoader.superclass.constructor.call(this)};Ext.extend(GeoExt.tree.LayerLoader,Ext.util.Observable,{store:null,filter:function(a){return a.getLayer().displayInLayerSwitcher==true},baseAttrs:null,uiProviders:null,load:function(a,b){if(this.fireEvent("beforeload",this,a)){this.removeStoreHandlers();while(a.firstChild){a.removeChild(a.firstChild)}if(!this.uiProviders){this.uiProviders=a.getOwnerTree().getLoader().uiProviders}if(!this.store){this.store=GeoExt.MapPanel.guess().layers}this.store.each(function(c){this.addLayerNode(a,c)},this);this.addStoreHandlers(a);if(typeof b=="function"){b()}this.fireEvent("load",this,a)}},onStoreAdd:function(b,a,c,e){if(!this._reordering){var f=e.recordIndexToNodeIndex(c+a.length-1);for(var d=0;d<a.length;++d){this.addLayerNode(e,a[d],f)}}},onStoreRemove:function(a,d,b,c){if(!this._reordering){this.removeLayerNode(c,d)}},addLayerNode:function(d,c,a){a=a||0;if(this.filter(c)===true){var e=this.createNode({nodeType:"gx_layer",layer:c.getLayer(),layerStore:this.store});var b=d.item(a);if(b){d.insertBefore(e,b)}else{d.appendChild(e)}e.on("move",this.onChildMove,this)}},removeLayerNode:function(b,a){if(this.filter(a)===true){var c=b.findChildBy(function(d){return d.layer==a.getLayer()});if(c){c.un("move",this.onChildMove,this);c.remove();b.reload()}}},onChildMove:function(j,c,h,g,f){this._reordering=true;var b=this.store.getByLayer(c.layer);if(g instanceof GeoExt.tree.LayerContainer&&this.store===g.loader.store){g.loader._reordering=true;this.store.remove(b);var a;if(g.childNodes.length>1){var i=(f===0)?f+1:f-1;a=this.store.findBy(function(k){return g.childNodes[i].layer===k.getLayer()});f===0&&a++}else{if(h.parentNode===g.parentNode){var d=g;do{d=d.previousSibling}while(d&&!(d instanceof GeoExt.tree.LayerContainer&&d.lastChild));if(d){a=this.store.findBy(function(k){return d.lastChild.layer===k.getLayer()})}else{var e=g;do{e=e.nextSibling}while(e&&!(e instanceof GeoExt.tree.LayerContainer&&e.firstChild));if(e){a=this.store.findBy(function(k){return e.firstChild.layer===k.getLayer()})}a++}}}if(a!==undefined){this.store.insert(a,[b]);window.setTimeout(function(){g.reload();h.reload()})}else{this.store.insert(oldRecordIndex,[b])}delete g.loader._reordering}delete this._reordering},addStoreHandlers:function(b){if(!this._storeHandlers){this._storeHandlers={add:this.onStoreAdd.createDelegate(this,[b],true),remove:this.onStoreRemove.createDelegate(this,[b],true)};for(var a in this._storeHandlers){this.store.on(a,this._storeHandlers[a],this)}}},removeStoreHandlers:function(){if(this._storeHandlers){for(var a in this._storeHandlers){this.store.un(a,this._storeHandlers[a],this)}delete this._storeHandlers}},createNode:function(attr){if(this.baseAttrs){Ext.apply(attr,this.baseAttrs)}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)}attr.nodeType=attr.nodeType||"gx_layer";return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)},destroy:function(){this.removeStoreHandlers()}});Ext.namespace("GeoExt.plugins");GeoExt.plugins.PrintProviderField=Ext.extend(Ext.util.Observable,{target:null,constructor:function(a){this.initialConfig=a;Ext.apply(this,a);GeoExt.plugins.PrintProviderField.superclass.constructor.apply(this,arguments)},init:function(b){this.target=b;var a={scope:this,render:this.onRender,beforedestroy:this.onBeforeDestroy};a[b instanceof Ext.form.ComboBox?"select":"valid"]=this.onFieldChange;b.on(a)},onRender:function(a){var b=this.printProvider||a.ownerCt.printProvider;if(a.store===b.layouts){a.setValue(b.layout.get(a.displayField));b.on({layoutchange:this.onProviderChange,scope:this})}else{if(a.store===b.dpis){a.setValue(b.dpi.get(a.displayField));b.on({dpichange:this.onProviderChange,scope:this})}else{if(a.initialConfig.value===undefined){a.setValue(b.customParams[a.name])
}}}},onFieldChange:function(c,a){var d=this.printProvider||c.ownerCt.printProvider;var b=c.getValue();this._updating=true;if(a){switch(c.store){case d.layouts:d.setLayout(a);break;case d.dpis:d.setDpi(a)}}else{d.customParams[c.name]=b}delete this._updating},onProviderChange:function(b,a){if(!this._updating){this.target.setValue(a.get(this.target.displayField))}},onBeforeDestroy:function(){this.target.un("beforedestroy",this.onBeforeDestroy,this);this.target.un("render",this.onRender,this);this.target.un("select",this.onFieldChange,this);this.target.un("valid",this.onFieldChange,this);this.printProvider.un("layoutchange",this.onProviderChange,this);this.printProvider.un("dpichange",this.onProviderChange,this)}});Ext.preg("gx_printproviderfield",GeoExt.plugins.PrintProviderField);Ext.namespace("GeoExt","GeoExt.data");GeoExt.data.LayerReader=function(a,b){a=a||{};if(!(b instanceof Function)){b=GeoExt.data.LayerRecord.create(b||a.fields||{})}GeoExt.data.LayerReader.superclass.constructor.call(this,a,b)};Ext.extend(GeoExt.data.LayerReader,Ext.data.DataReader,{totalRecords:null,readRecords:function(d){var b=[];if(d){var f=this.recordType,a=f.prototype.fields;var h,e,g,c,k,n,l,m;for(h=0,e=d.length;h<e;h++){k=d[h];n={};for(g=0,c=a.length;g<c;g++){l=a.items[g];m=k[l.mapping||l.name]||l.defaultValue;m=l.convert(m);n[l.name]=m}n.layer=k;b[b.length]=new f(n,k.id)}}return{records:b,totalRecords:this.totalRecords!=null?this.totalRecords:b.length}}});Ext.namespace("GeoExt.data");GeoExt.data.WMSDescribeLayerStore=function(a){a=a||{};GeoExt.data.WMSDescribeLayerStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(!a.data?new Ext.data.HttpProxy({url:a.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.WMSDescribeLayerReader(a,a.fields)}))};Ext.extend(GeoExt.data.WMSDescribeLayerStore,Ext.data.Store);Ext.namespace("GeoExt.form");GeoExt.form.BasicForm=Ext.extend(Ext.form.BasicForm,{protocol:null,prevResponse:null,autoAbort:true,doAction:function(a,b){if(a=="search"){b=Ext.applyIf(b||{},{protocol:this.protocol,abortPrevious:this.autoAbort});a=new GeoExt.form.SearchAction(this,b)}return GeoExt.form.BasicForm.superclass.doAction.call(this,a,b)},search:function(a){return this.doAction("search",a)}});Ext.namespace("GeoExt.tree");GeoExt.tree.LayerParamLoader=function(a){Ext.apply(this,a);this.addEvents("beforeload","load");GeoExt.tree.LayerParamLoader.superclass.constructor.call(this)};Ext.extend(GeoExt.tree.LayerParamLoader,Ext.util.Observable,{param:null,delimiter:",",load:function(b,c){if(this.fireEvent("beforeload",this,b)){while(b.firstChild){b.removeChild(b.firstChild)}var d=(b.layer instanceof OpenLayers.Layer.HTTPRequest)&&b.layer.params[this.param];if(d){var a=(d instanceof Array)?d.slice():d.split(this.delimiter);Ext.each(a,function(g,e,f){this.addParamNode(g,f,b)},this)}if(typeof c=="function"){c()}this.fireEvent("load",this,b)}},addParamNode:function(a,b,d){var e=this.createNode({layer:d.layer,param:this.param,item:a,allItems:b,delimiter:this.delimiter});var c=d.item(0);if(c){d.insertBefore(e,c)}else{d.appendChild(e)}},createNode:function(attr){if(this.baseAttrs){Ext.apply(attr,this.baseAttrs)}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)}attr.nodeType=attr.nodeType||"gx_layerparam";return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)}});Ext.namespace("GeoExt.grid");GeoExt.grid.FeatureSelectionModelMixin=function(){return{autoActivateControl:true,layerFromStore:true,selectControl:null,bound:false,superclass:null,constructor:function(a){a=a||{};if(a.selectControl instanceof OpenLayers.Control.SelectFeature){if(!a.singleSelect){var b=a.selectControl;a.singleSelect=!(b.multiple||!!b.multipleKey)}}else{if(a.layer instanceof OpenLayers.Layer.Vector){this.selectControl=this.createSelectControl(a.layer,a.selectControl);delete a.layer;delete a.selectControl}}this.superclass=arguments.callee.superclass;this.superclass.constructor.call(this,a)
},initEvents:function(){this.superclass.initEvents.call(this);if(this.layerFromStore){var a=this.grid.getStore()&&this.grid.getStore().layer;if(a&&!(this.selectControl instanceof OpenLayers.Control.SelectFeature)){this.selectControl=this.createSelectControl(a,this.selectControl)}}if(this.selectControl){this.bind(this.selectControl)}},createSelectControl:function(b,a){a=a||{};var d=a.singleSelect!==undefined?a.singleSelect:this.singleSelect;a=OpenLayers.Util.extend({toggle:true,multipleKey:d?null:(Ext.isMac?"metaKey":"ctrlKey")},a);var c=new OpenLayers.Control.SelectFeature(b,a);b.map.addControl(c);return c},bind:function(d,c){if(!this.bound){c=c||{};this.selectControl=d;if(d instanceof OpenLayers.Layer.Vector){this.selectControl=this.createSelectControl(d,c.controlConfig)}if(this.autoActivateControl){this.selectControl.activate()}var e=this.getLayers();for(var b=0,a=e.length;b<a;b++){e[b].events.on({featureselected:this.featureSelected,featureunselected:this.featureUnselected,scope:this})}this.on("rowselect",this.rowSelected,this);this.on("rowdeselect",this.rowDeselected,this);this.bound=true}return this.selectControl},unbind:function(){var c=this.selectControl;if(this.bound){var d=this.getLayers();for(var b=0,a=d.length;b<a;b++){d[b].events.un({featureselected:this.featureSelected,featureunselected:this.featureUnselected,scope:this})}this.un("rowselect",this.rowSelected,this);this.un("rowdeselect",this.rowDeselected,this);if(this.autoActivateControl){c.deactivate()}this.selectControl=null;this.bound=false}return c},featureSelected:function(a){if(!this._selecting){var b=this.grid.store;var c=b.findBy(function(d,e){return d.getFeature()==a.feature});if(c!=-1&&!this.isSelected(c)){this._selecting=true;this.selectRow(c,!this.singleSelect);this._selecting=false;this.grid.getView().focusRow(c)}}},featureUnselected:function(a){if(!this._selecting){var b=this.grid.store;var c=b.findBy(function(d,e){return d.getFeature()==a.feature});if(c!=-1&&this.isSelected(c)){this._selecting=true;this.deselectRow(c);this._selecting=false;this.grid.getView().focusRow(c)}}},rowSelected:function(c,f,e){var b=e.getFeature();if(!this._selecting&&b){var g=this.getLayers();for(var d=0,a=g.length;d<a;d++){if(g[d].selectedFeatures.indexOf(b)==-1){this._selecting=true;this.selectControl.select(b);this._selecting=false;break}}}},rowDeselected:function(c,f,e){var b=e.getFeature();if(!this._selecting&&b){var g=this.getLayers();for(var d=0,a=g.length;d<a;d++){if(g[d].selectedFeatures.indexOf(b)!=-1){this._selecting=true;this.selectControl.unselect(b);this._selecting=false;break}}}},getLayers:function(){return this.selectControl.layers||[this.selectControl.layer]}}};GeoExt.grid.FeatureSelectionModel=Ext.extend(Ext.grid.RowSelectionModel,new GeoExt.grid.FeatureSelectionModelMixin);Ext.namespace("GeoExt","GeoExt.data");GeoExt.data.FeatureReader=function(a,b){a=a||{};if(!(b instanceof Function)){b=GeoExt.data.FeatureRecord.create(b||a.fields||{})}GeoExt.data.FeatureReader.superclass.constructor.call(this,a,b)};Ext.extend(GeoExt.data.FeatureReader,Ext.data.DataReader,{totalRecords:null,read:function(a){return this.readRecords(a.features)},readRecords:function(l){var c=[];if(l){var g=this.recordType,b=g.prototype.fields;var k,f,h,d,n,q,o,p;for(k=0,f=l.length;k<f;k++){n=l[k];q={};if(n.attributes){for(h=0,d=b.length;h<d;h++){o=b.items[h];if(/[\[\.]/.test(o.mapping)){try{p=new Function("obj","return obj."+o.mapping)(n.attributes)}catch(m){p=o.defaultValue}}else{p=n.attributes[o.mapping||o.name]||o.defaultValue}if(o.convert){p=o.convert(p)}q[o.name]=p}}q.feature=n;q.state=n.state;q.fid=n.fid;var a=(n.state===OpenLayers.State.INSERT)?undefined:n.id;c[c.length]=new g(q,a)}}return{records:c,totalRecords:this.totalRecords!=null?this.totalRecords:c.length}}});Ext.namespace("GeoExt");GeoExt.WMSLegend=Ext.extend(GeoExt.LayerLegend,{defaultStyleIsFirst:true,useScaleParameter:true,baseParams:null,initComponent:function(){GeoExt.WMSLegend.superclass.initComponent.call(this);var a=this.layerRecord.getLayer();
this._noMap=!a.map;a.events.register("moveend",this,this.onLayerMoveend);this.update()},onLayerMoveend:function(a){if((a.zoomChanged===true&&this.useScaleParameter===true)||this._noMap){delete this._noMap;this.update()}},getLegendUrl:function(b,k){var e=this.layerRecord;var a;var h=e&&e.get("styles");var g=e.getLayer();k=k||[g.params.LAYERS].join(",").split(",");var j=g.params.STYLES&&[g.params.STYLES].join(",").split(",");var i=k.indexOf(b);var c=j&&j[i];if(h&&h.length>0){if(c){Ext.each(h,function(l){a=(l.name==c&&l.legend)&&l.legend.href;return !a})}else{if(this.defaultStyleIsFirst===true&&!j&&!g.params.SLD&&!g.params.SLD_BODY){a=h[0].legend&&h[0].legend.href}}}if(!a){a=g.getFullRequestString({REQUEST:"GetLegendGraphic",WIDTH:null,HEIGHT:null,EXCEPTIONS:"application/vnd.ogc.se_xml",LAYER:b,LAYERS:null,STYLE:(c!=="")?c:null,STYLES:null,SRS:null,FORMAT:null})}if(this.useScaleParameter===true&&a.toLowerCase().indexOf("request=getlegendgraphic")!=-1){var d=g.map.getScale();a=Ext.urlAppend(a,"SCALE="+d)}var f=this.baseParams||{};Ext.applyIf(f,{FORMAT:"image/gif"});if(a.indexOf("?")>0){a=Ext.urlEncode(f,a)}return a},update:function(){var e=this.layerRecord.getLayer();if(!(e&&e.map)){return}GeoExt.WMSLegend.superclass.update.apply(this,arguments);var h,d,c,a;h=[e.params.LAYERS].join(",").split(",");var b=[];var g=this.items.get(0);this.items.each(function(i){c=h.indexOf(i.itemId);if(c<0&&i!=g){b.push(i)}else{if(i!==g){d=h[c];var j=this.getLegendUrl(d,h);if(!OpenLayers.Util.isEquivalentUrl(j,i.url)){i.setUrl(j)}}}},this);for(c=0,a=b.length;c<a;c++){var f=b[c];this.remove(f);f.destroy()}for(c=0,a=h.length;c<a;c++){d=h[c];if(!this.items||!this.getComponent(d)){this.add({xtype:"gx_legendimage",url:this.getLegendUrl(d,h),itemId:d})}}this.doLayout()},beforeDestroy:function(){if(this.useScaleParameter===true){var a=this.layerRecord.getLayer();a&&a.events&&a.events.unregister("moveend",this,this.onLayerMoveend)}GeoExt.WMSLegend.superclass.beforeDestroy.apply(this,arguments)}});GeoExt.WMSLegend.supports=function(a){return a.getLayer() instanceof OpenLayers.Layer.WMS};GeoExt.LayerLegend.types.gx_wmslegend=GeoExt.WMSLegend;Ext.reg("gx_wmslegend",GeoExt.WMSLegend);Ext.namespace("GeoExt.data");GeoExt.data.WMSDescribeLayerReader=function(a,b){a=a||{};if(!a.format){a.format=new OpenLayers.Format.WMSDescribeLayer()}if(!(typeof b==="function")){b=Ext.data.Record.create(b||a.fields||[{name:"owsType",type:"string"},{name:"owsURL",type:"string"},{name:"typeName",type:"string"}])}GeoExt.data.WMSDescribeLayerReader.superclass.constructor.call(this,a,b)};Ext.extend(GeoExt.data.WMSDescribeLayerReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}return this.readRecords(b)},readRecords:function(e){if(typeof e==="string"||e.nodeType){e=this.meta.format.read(e)}var c=[],b;for(var d=0,a=e.length;d<a;d++){b=e[d];if(b){c.push(new this.recordType(b))}}return{totalRecords:c.length,success:true,records:c}}});Ext.namespace("GeoExt.form");GeoExt.form.SearchAction=Ext.extend(Ext.form.Action,{type:"search",response:null,constructor:function(b,a){GeoExt.form.SearchAction.superclass.constructor.call(this,b,a)},run:function(){var b=this.options;var a=GeoExt.form.toFilter(this.form,b.logicalOp,b.wildcard);if(b.clientValidation===false||this.form.isValid()){if(b.abortPrevious&&this.form.prevResponse){b.protocol.abort(this.form.prevResponse)}this.form.prevResponse=b.protocol.read(Ext.applyIf({filter:a,callback:this.handleResponse,scope:this},b))}else{if(b.clientValidation!==false){this.failureType=Ext.form.Action.CLIENT_INVALID;this.form.afterAction(this,false)}}},handleResponse:function(a){this.form.prevResponse=null;this.response=a;if(a.success()){this.form.afterAction(this,true)}else{this.form.afterAction(this,false)}var b=this.options;if(b.callback){b.callback.call(b.scope,a)}}});Ext.namespace("GeoExt.data");GeoExt.data.FeatureRecord=Ext.data.Record.create([{name:"feature"},{name:"state"},{name:"fid"}]);GeoExt.data.FeatureRecord.prototype.getFeature=function(){return this.get("feature")
};GeoExt.data.FeatureRecord.prototype.setFeature=function(a){if(a!==this.data.feature){this.dirty=true;if(!this.modified){this.modified={}}if(this.modified.feature===undefined){this.modified.feature=this.data.feature}this.data.feature=a;if(!this.editing){this.afterEdit()}}};GeoExt.data.FeatureRecord.create=function(e){var c=Ext.extend(GeoExt.data.FeatureRecord,{});var d=c.prototype;d.fields=new Ext.util.MixedCollection(false,function(f){return f.name});GeoExt.data.FeatureRecord.prototype.fields.each(function(g){d.fields.add(g)});if(e){for(var b=0,a=e.length;b<a;b++){d.fields.add(new Ext.data.Field(e[b]))}}c.getField=function(f){return d.fields.get(f)};return c};Ext.namespace("GeoExt.data");GeoExt.data.PrintPage=Ext.extend(Ext.util.Observable,{printProvider:null,feature:null,center:null,scale:null,rotation:0,customParams:null,constructor:function(a){this.initialConfig=a;Ext.apply(this,a);if(!this.customParams){this.customParams={}}this.addEvents("change");GeoExt.data.PrintPage.superclass.constructor.apply(this,arguments);this.feature=new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT("POLYGON((-1 -1,1 -1,1 1,-1 1,-1 -1))"));if(this.printProvider.capabilities){this.setScale(this.printProvider.scales.getAt(0))}else{this.printProvider.on({loadcapabilities:function(){this.setScale(this.printProvider.scales.getAt(0))},scope:this,single:true})}this.printProvider.on({layoutchange:this.onLayoutChange,scope:this})},getPrintExtent:function(a){a=a instanceof GeoExt.MapPanel?a.map:a;return this.calculatePageBounds(this.scale,a.getUnits())},setScale:function(e,b){var a=this.calculatePageBounds(e,b);var d=a.toGeometry();var c=this.rotation;if(c!=0){d.rotate(-c,d.getCentroid())}this.updateFeature(d,{scale:e})},setCenter:function(d){var c=this.feature.geometry;var e=c.getBounds().getCenterLonLat();var b=d.lon-e.lon;var a=d.lat-e.lat;c.move(b,a);this.updateFeature(c,{center:d})},setRotation:function(a,c){if(c||this.printProvider.layout.get("rotation")===true){var b=this.feature.geometry;b.rotate(this.rotation-a,b.getCentroid());this.updateFeature(b,{rotation:a})}},fit:function(j,h){h=h||{};var a=j,i;if(j instanceof GeoExt.MapPanel){a=j.map}else{if(j instanceof OpenLayers.Feature.Vector){a=j.layer.map;i=j.geometry.getBounds()}}if(!i){i=a.getExtent();if(!i){return}}this._updating=true;var g=i.getCenterLonLat();this.setCenter(g);var f=a.getUnits();var c=this.printProvider.scales.getAt(0);var b=Number.POSITIVE_INFINITY;var d=i.getWidth();var e=i.getHeight();this.printProvider.scales.each(function(n){var k=this.calculatePageBounds(n,f);if(h.mode=="closest"){var m=Math.abs(k.getWidth()-d)+Math.abs(k.getHeight()-e);if(m<b){b=m;c=n}}else{var l=h.mode=="screen"?!i.containsBounds(k):k.containsBounds(i);if(l||(h.mode=="screen"&&!l)){c=n}return l}},this);this.setScale(c,f);delete this._updating;this.updateFeature(this.feature.geometry,{center:g,scale:c})},updateFeature:function(e,c){var d=this.feature;var b=d.geometry!==e;e.id=d.geometry.id;d.geometry=e;if(!this._updating){for(var a in c){if(c[a]===this[a]){delete c[a]}else{this[a]=c[a];b=true}}Ext.apply(this,c);d.layer&&d.layer.drawFeature(d);b&&this.fireEvent("change",this,c)}},calculatePageBounds:function(b,e){var l=b.get("value");var d=this.feature;var i=this.feature.geometry;var g=i.getBounds().getCenterLonLat();var k=this.printProvider.layout.get("size");var e=e||(d.layer&&d.layer.map&&d.layer.map.getUnits())||"dd";var a=OpenLayers.INCHES_PER_UNIT[e];var j=k.width/72/a*l/2;var c=k.height/72/a*l/2;return new OpenLayers.Bounds(g.lon-j,g.lat-c,g.lon+j,g.lat+c)},onLayoutChange:function(){if(this.printProvider.layout.get("rotation")===false){this.setRotation(0,true)}this.scale&&this.setScale(this.scale)},destroy:function(){this.printProvider.un("layoutchange",this.onLayoutChange,this)}});Ext.namespace("GeoExt.data");GeoExt.data.LayerRecord=Ext.data.Record.create([{name:"layer"},{name:"title",type:"string",mapping:"name"}]);GeoExt.data.LayerRecord.prototype.getLayer=function(){return this.get("layer")
};GeoExt.data.LayerRecord.prototype.setLayer=function(a){if(a!==this.data.layer){this.dirty=true;if(!this.modified){this.modified={}}if(this.modified.layer===undefined){this.modified.layer=this.data.layer}this.data.layer=a;if(!this.editing){this.afterEdit()}}};GeoExt.data.LayerRecord.prototype.clone=function(b){var a=this.getLayer()&&this.getLayer().clone();return new this.constructor(Ext.applyIf({layer:a},this.data),b||a.id)};GeoExt.data.LayerRecord.create=function(e){var c=Ext.extend(GeoExt.data.LayerRecord,{});var d=c.prototype;d.fields=new Ext.util.MixedCollection(false,function(f){return f.name});GeoExt.data.LayerRecord.prototype.fields.each(function(g){d.fields.add(g)});if(e){for(var b=0,a=e.length;b<a;b++){d.fields.add(new Ext.data.Field(e[b]))}}c.getField=function(f){return d.fields.get(f)};return c};Ext.namespace("GeoExt");GeoExt.FeatureRenderer=Ext.extend(Ext.BoxComponent,{feature:undefined,symbolizers:[OpenLayers.Feature.Vector.style["default"]],symbolType:"Polygon",resolution:1,minWidth:20,minHeight:20,renderers:["SVG","VML","Canvas"],rendererOptions:null,pointFeature:undefined,lineFeature:undefined,polygonFeature:undefined,renderer:null,initComponent:function(){GeoExt.FeatureRenderer.superclass.initComponent.apply(this,arguments);Ext.applyIf(this,{pointFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(0,0)),lineFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-8,-3),new OpenLayers.Geometry.Point(-3,3),new OpenLayers.Geometry.Point(3,-3),new OpenLayers.Geometry.Point(8,3)])),polygonFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(-8,-4),new OpenLayers.Geometry.Point(-6,-6),new OpenLayers.Geometry.Point(6,-6),new OpenLayers.Geometry.Point(8,-4),new OpenLayers.Geometry.Point(8,4),new OpenLayers.Geometry.Point(6,6),new OpenLayers.Geometry.Point(-6,6),new OpenLayers.Geometry.Point(-8,4)])]))});if(!this.feature){this.setFeature(null,{draw:false})}this.addEvents("click")},initCustomEvents:function(){this.clearCustomEvents();this.el.on("click",this.onClick,this)},clearCustomEvents:function(){if(this.el&&this.el.removeAllListeners){this.el.removeAllListeners()}},onClick:function(){this.fireEvent("click",this)},onRender:function(b,a){if(!this.el){this.el=document.createElement("div");this.el.id=this.getId()}if(!this.renderer||!this.renderer.supported()){this.assignRenderer()}this.renderer.map={getResolution:(function(){return this.resolution}).createDelegate(this)};GeoExt.FeatureRenderer.superclass.onRender.apply(this,arguments);this.drawFeature()},afterRender:function(){GeoExt.FeatureRenderer.superclass.afterRender.apply(this,arguments);this.initCustomEvents()},onResize:function(a,b){this.setRendererDimensions();GeoExt.FeatureRenderer.superclass.onResize.apply(this,arguments)},setRendererDimensions:function(){var i=this.feature.geometry.getBounds();var j=i.getWidth();var e=i.getHeight();var c=this.initialConfig.resolution;if(!c){c=Math.max(j/this.width||0,e/this.height||0)||1}this.resolution=c;var a=Math.max(this.width||this.minWidth,j/c);var h=Math.max(this.height||this.minHeight,e/c);var g=i.getCenterPixel();var b=a*c/2;var d=h*c/2;var f=new OpenLayers.Bounds(g.x-b,g.y-d,g.x+b,g.y+d);this.renderer.setSize(new OpenLayers.Size(Math.round(a),Math.round(h)));this.renderer.setExtent(f,true)},assignRenderer:function(){for(var b=0,a=this.renderers.length;b<a;++b){var c=OpenLayers.Renderer[this.renderers[b]];if(c&&c.prototype.supported()){this.renderer=new c(this.el,this.rendererOptions);break}}},setSymbolizers:function(b,a){this.symbolizers=b;if(!a||a.draw){this.drawFeature()}},setSymbolType:function(b,a){this.symbolType=b;this.setFeature(null,a)},setFeature:function(a,b){this.feature=a||this[this.symbolType.toLowerCase()+"Feature"];if(!b||b.draw){this.drawFeature()}},drawFeature:function(){this.renderer.clear();this.setRendererDimensions();var g=OpenLayers.Symbolizer;var f=g&&g.Text;
var e,c,b;for(var d=0,a=this.symbolizers.length;d<a;++d){e=this.symbolizers[d];c=this.feature;if(!f||!(e instanceof f)){if(g&&(e instanceof g)){e=e.clone();if(!this.initialConfig.feature){b=e.CLASS_NAME.split(".").pop().toLowerCase();c=this[b+"Feature"]}}else{e=Ext.apply({},e)}this.renderer.drawFeature(c.clone(),e)}}},update:function(a){a=a||{};if(a.feature){this.setFeature(a.feature,{draw:false})}else{if(a.symbolType){this.setSymbolType(a.symbolType,{draw:false})}}if(a.symbolizers){this.setSymbolizers(a.symbolizers,{draw:false})}this.drawFeature()},beforeDestroy:function(){this.clearCustomEvents();if(this.renderer){this.renderer.destroy()}}});Ext.reg("gx_renderer",GeoExt.FeatureRenderer);Ext.namespace("GeoExt");GeoExt.Popup=Ext.extend(Ext.Window,{anchored:true,map:null,panIn:true,unpinnable:true,location:null,animCollapse:false,draggable:false,shadow:false,popupCls:"gx-popup",ancCls:null,initComponent:function(){if(this.map instanceof GeoExt.MapPanel){this.map=this.map.map}if(!this.map&&this.location instanceof OpenLayers.Feature.Vector&&this.location.layer){this.map=this.location.layer.map}if(this.location instanceof OpenLayers.Feature.Vector){this.location=this.location.geometry}if(this.location instanceof OpenLayers.Geometry){if(typeof this.location.getCentroid=="function"){this.location=this.location.getCentroid()}this.location=this.location.getBounds().getCenterLonLat()}else{if(this.location instanceof OpenLayers.Pixel){this.location=this.map.getLonLatFromViewPortPx(this.location)}}if(this.anchored){this.addAnchorEvents()}this.baseCls=this.popupCls+" "+this.baseCls;this.elements+=",anc";GeoExt.Popup.superclass.initComponent.call(this)},onRender:function(b,a){GeoExt.Popup.superclass.onRender.call(this,b,a);this.ancCls=this.popupCls+"-anc";this.createElement("anc",this.el.dom)},initTools:function(){if(this.unpinnable){this.addTool({id:"unpin",handler:this.unanchorPopup.createDelegate(this,[])})}GeoExt.Popup.superclass.initTools.call(this)},show:function(){GeoExt.Popup.superclass.show.apply(this,arguments);if(this.anchored){this.position();if(this.panIn&&!this._mapMove){this.panIntoView()}}},maximize:function(){if(!this.maximized&&this.anc){this.unanchorPopup()}GeoExt.Popup.superclass.maximize.apply(this,arguments)},setSize:function(a,c){if(this.anc){var b=this.anc.getSize();if(typeof a=="object"){c=a.height-b.height;a=a.width}else{if(!isNaN(c)){c=c-b.height}}}GeoExt.Popup.superclass.setSize.call(this,a,c)},position:function(){if(this._mapMove===true){var f=this.map.getExtent().containsLonLat(this.location);if(f!==this.isVisible()){this.setVisible(f)}}if(this.isVisible()){var b=this.map.getViewPortPxFromLonLat(this.location);var e=Ext.fly(this.map.div).getBox();var d=this.anc;var c=d.getLeft(true)+d.getWidth()/2;var a=this.el.getHeight();this.setPosition(b.x+e.x-c,b.y+e.y-a)}},unanchorPopup:function(){this.removeAnchorEvents();this.draggable=true;this.header.addClass("x-window-draggable");this.dd=new Ext.Window.DD(this);this.anc.remove();this.anc=null;this.tools.unpin.hide()},panIntoView:function(){var f=Ext.fly(this.map.div).getBox();var d=this.getPosition(true);d[0]-=f.x;d[1]-=f.y;var e=[f.width,f.height];var h=this.getSize();var c=[d[0],d[1]];var g=this.map.paddingForPopups;if(d[0]<g.left){c[0]=g.left}else{if(d[0]+h.width>e[0]-g.right){c[0]=e[0]-g.right-h.width}}if(d[1]<g.top){c[1]=g.top}else{if(d[1]+h.height>e[1]-g.bottom){c[1]=e[1]-g.bottom-h.height}}var b=d[0]-c[0];var a=d[1]-c[1];this.map.pan(b,a)},onMapMove:function(){this._mapMove=true;this.position();delete this._mapMove},addAnchorEvents:function(){this.map.events.on({move:this.onMapMove,scope:this});this.on({resize:this.position,collapse:this.position,expand:this.position,scope:this})},removeAnchorEvents:function(){this.map.events.un({move:this.onMapMove,scope:this});this.un("resize",this.position,this);this.un("collapse",this.position,this);this.un("expand",this.position,this)},beforeDestroy:function(){if(this.anchored){this.removeAnchorEvents()}GeoExt.Popup.superclass.beforeDestroy.call(this)
}});Ext.reg("gx_popup",GeoExt.Popup);Ext.namespace("GeoExt.data");GeoExt.data.AttributeStoreMixin=function(){return{constructor:function(a){a=a||{};arguments.callee.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(!a.data?new Ext.data.HttpProxy({url:a.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.AttributeReader(a,a.fields||["name","type","restriction"])}));if(this.feature){this.bind()}},bind:function(){this.on({update:this.onUpdate,load:this.onLoad,add:this.onAdd,scope:this});var a=[];this.each(function(b){a.push(b)});this.updateFeature(a)},onUpdate:function(b,c,a){this.updateFeature([c])},onLoad:function(b,a,c){if(!c||c.add!==true){this.updateFeature(a)}},onAdd:function(b,a,c){this.updateFeature(a)},updateFeature:function(d){var j=this.feature,g=j.layer;var f,h,e,c,k,a,b;for(f=0,h=d.length;f<h;f++){e=d[f];c=e.get("name");k=e.get("value");a=j.attributes[c];if(a!==k){b=true}}if(b&&g&&g.events&&g.events.triggerEvent("beforefeaturemodified",{feature:j})!==false){for(f=0,h=d.length;f<h;f++){e=d[f];c=e.get("name");k=e.get("value");j.attributes[c]=k}g.events.triggerEvent("featuremodified",{feature:j});g.drawFeature(j)}}}};GeoExt.data.AttributeStore=Ext.extend(Ext.data.Store,GeoExt.data.AttributeStoreMixin());Ext.namespace("GeoExt.form");GeoExt.form.FormPanel=Ext.extend(Ext.form.FormPanel,{protocol:null,createForm:function(){delete this.initialConfig.listeners;return new GeoExt.form.BasicForm(null,this.initialConfig)},search:function(a){this.getForm().search(a)}});Ext.reg("gx_formpanel",GeoExt.form.FormPanel);Ext.namespace("GeoExt.data");GeoExt.data.WMCReader=function(a,b){a=a||{};if(!a.format){a.format=new OpenLayers.Format.WMC()}if(!(typeof b==="function")){b=GeoExt.data.LayerRecord.create(b||a.fields||[{name:"abstract",type:"string"},{name:"metadataURL",type:"string"},{name:"queryable",type:"boolean"},{name:"formats"},{name:"styles"}])}GeoExt.data.WMCReader.superclass.constructor.call(this,a,b)};Ext.extend(GeoExt.data.WMCReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}return this.readRecords(b)},readRecords:function(h){var p=this.meta.format;if(typeof h==="string"||h.nodeType){h=p.read(h)}var k=h?h.layersContext:undefined;var b=[];if(k){var e=this.recordType,a=e.prototype.fields;var g,d,f,c,m,o,l,n;for(g=0,d=k.length;g<d;g++){m=k[g];o={};for(f=0,c=a.length;f<c;f++){l=a.items[f];n=m[l.mapping||l.name]||l.defaultValue;n=l.convert(n);o[l.name]=n}o.layer=p.getLayerFromContext(m);b.push(new this.recordType(o,o.layer.id))}}return{totalRecords:b.length,success:true,records:b}}});Ext.namespace("GeoExt.tree");GeoExt.tree.OverlayLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{constructor:function(a){a=Ext.applyIf(a||{},{text:"Overlays"});a.loader=Ext.applyIf(a.loader||{},{filter:function(c){var b=c.getLayer();return b.displayInLayerSwitcher===true&&b.isBaseLayer===false}});GeoExt.tree.OverlayLayerContainer.superclass.constructor.call(this,a)}});Ext.tree.TreePanel.nodeTypes.gx_overlaylayercontainer=GeoExt.tree.OverlayLayerContainer;Ext.namespace("GeoExt.data");GeoExt.data.WFSCapabilitiesReader=function(a,b){a=a||{};if(!a.format){a.format=new OpenLayers.Format.WFSCapabilities()}if(!(typeof b==="function")){b=GeoExt.data.LayerRecord.create(b||a.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"namespace",type:"string",mapping:"featureNS"},{name:"abstract",type:"string"}])}GeoExt.data.WFSCapabilitiesReader.superclass.constructor.call(this,a,b)};Ext.extend(GeoExt.data.WFSCapabilitiesReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}return this.readRecords(b)},readRecords:function(m){if(typeof m==="string"||m.nodeType){m=this.meta.format.read(m)}var a=m.featureTypeList.featureTypes;var d=this.recordType.prototype.fields;var c,r,p,q,k,o,r;var b,s;var n={url:m.capability.request.getfeature.href.post};var e=[];for(var l=0,g=a.length;l<g;l++){c=a[l];if(c.name){r={};
for(var h=0,f=d.length;h<f;h++){p=d.items[h];q=c[p.mapping||p.name]||p.defaultValue;q=p.convert(q);r[p.name]=q}s={featureType:c.name,featureNS:c.featureNS};if(this.meta.protocolOptions){Ext.apply(s,this.meta.protocolOptions,n)}else{Ext.apply(s,{},n)}b={protocol:new OpenLayers.Protocol.WFS(s),strategies:[new OpenLayers.Strategy.Fixed()]};if(this.meta.layerOptions){Ext.apply(b,this.meta.layerOptions)}r.layer=new OpenLayers.Layer.Vector(c.title||c.name,b);e.push(new this.recordType(r,r.layer.id))}}return{totalRecords:e.length,success:true,records:e}}});Ext.namespace("GeoExt");GeoExt.LegendPanel=Ext.extend(Ext.Panel,{dynamic:true,layerStore:null,preferredTypes:null,filter:function(a){return true},initComponent:function(){GeoExt.LegendPanel.superclass.initComponent.call(this)},onRender:function(){GeoExt.LegendPanel.superclass.onRender.apply(this,arguments);if(!this.layerStore){this.layerStore=GeoExt.MapPanel.guess().layers}this.layerStore.each(function(a){this.addLegend(a)},this);if(this.dynamic){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,clear:this.onStoreClear,scope:this})}},recordIndexToPanelIndex:function(g){var j=this.layerStore;var h=j.getCount();var d=-1;var b=this.items?this.items.length:0;var a,e;for(var c=h-1;c>=0;--c){a=j.getAt(c);e=a.getLayer();var f=GeoExt.LayerLegend.getTypes(a);if(e.displayInLayerSwitcher&&f.length>0&&(j.getAt(c).get("hideInLegend")!==true)){++d;if(g===c||d>b-1){break}}}return d},getIdForLayer:function(a){return this.id+"-"+a.id},onStoreAdd:function(c,b,d){var f=this.recordIndexToPanelIndex(d+b.length-1);for(var e=0,a=b.length;e<a;e++){this.addLegend(b[e],f)}this.doLayout()},onStoreRemove:function(a,c,b){this.removeLegend(c)},removeLegend:function(b){if(this.items){var a=this.getComponent(this.getIdForLayer(b.getLayer()));if(a){this.remove(a,true);this.doLayout()}}},onStoreClear:function(a){this.removeAllLegends()},removeAllLegends:function(){this.removeAll(true);this.doLayout()},addLegend:function(e,b){if(this.filter(e)===true){var d=e.getLayer();b=b||0;var a;var c=GeoExt.LayerLegend.getTypes(e,this.preferredTypes);if(d.displayInLayerSwitcher&&!e.get("hideInLegend")&&c.length>0){this.insert(b,{xtype:c[0],id:this.getIdForLayer(d),layerRecord:e,hidden:!((!d.map&&d.visibility)||(d.getVisibility()&&d.calculateInRange()))})}}},onDestroy:function(){if(this.layerStore){this.layerStore.un("add",this.onStoreAdd,this);this.layerStore.un("remove",this.onStoreRemove,this);this.layerStore.un("clear",this.onStoreClear,this)}GeoExt.LegendPanel.superclass.onDestroy.apply(this,arguments)}});Ext.reg("gx_legendpanel",GeoExt.LegendPanel);Ext.namespace("GeoExt.form");GeoExt.form.toFilter=function(b,e,c){if(b instanceof Ext.form.FormPanel){b=b.getForm()}var d=[],h=b.getValues(false);for(var a in h){var i=a.split("__");var g=h[a],f;if(i.length>1&&(f=GeoExt.form.toFilter.FILTER_MAP[i[1]])!==undefined){a=i[0]}else{f=OpenLayers.Filter.Comparison.EQUAL_TO}if(f===OpenLayers.Filter.Comparison.LIKE){switch(c){case GeoExt.form.ENDS_WITH:g=".*"+g;break;case GeoExt.form.STARTS_WITH:g+=".*";break;case GeoExt.form.CONTAINS:g=".*"+g+".*";break;default:break}}d.push(new OpenLayers.Filter.Comparison({type:f,value:g,property:a}))}return new OpenLayers.Filter.Logical({type:e||OpenLayers.Filter.Logical.AND,filters:d})};GeoExt.form.toFilter.FILTER_MAP={eq:OpenLayers.Filter.Comparison.EQUAL_TO,ne:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,lt:OpenLayers.Filter.Comparison.LESS_THAN,le:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,gt:OpenLayers.Filter.Comparison.GREATER_THAN,ge:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,like:OpenLayers.Filter.Comparison.LIKE};GeoExt.form.ENDS_WITH=1;GeoExt.form.STARTS_WITH=2;GeoExt.form.CONTAINS=3;GeoExt.form.recordToField=function(c){var h=c.get("type");if(typeof h==="object"&&h.xtype){return h}var j;var b=c.get("name");var i=c.get("label");var d=c.get("restriction")||{};if(i==null){i=b}h=h.split(":").pop();var a=GeoExt.form.recordToField.REGEXES;if(h.match(a.text)){var g=d.maxLength!==undefined?parseFloat(d.maxLength):undefined;
var f=d.minLength!==undefined?parseFloat(d.minLength):undefined;j={xtype:"textfield",name:b,fieldLabel:i,maxLength:g,minLength:f}}else{if(h.match(a.number)){var e=d.maxInclusive!==undefined?parseFloat(d.maxInclusive):undefined;var k=d.minInclusive!==undefined?parseFloat(d.minInclusive):undefined;j={xtype:"numberfield",name:b,fieldLabel:i,maxValue:e,minValue:k}}else{if(h.match(a["boolean"])){j={xtype:"checkbox",name:b,boxLabel:i}}else{if(h.match(a.date)){j={xtype:"datefield",fieldLabel:i,name:b}}}}}return j};GeoExt.form.recordToField.REGEXES={text:new RegExp("^(text|string)$","i"),number:new RegExp("^(number|float|decimal|double|int|long|integer|short)$","i"),"boolean":new RegExp("^(boolean)$","i"),date:new RegExp("^(dateTime)$","i")};Ext.namespace("GeoExt.plugins");GeoExt.plugins.PrintPageField=Ext.extend(Ext.util.Observable,{printPage:null,target:null,constructor:function(a){this.initialConfig=a;Ext.apply(this,a);GeoExt.plugins.PrintPageField.superclass.constructor.apply(this,arguments)},init:function(c){this.target=c;var b={beforedestroy:this.onBeforeDestroy,scope:this};var a=c instanceof Ext.form.ComboBox?"select":c instanceof Ext.form.Checkbox?"check":"valid";b[a]=this.onFieldChange;c.on(b);this.printPage.on({change:this.onPageChange,scope:this});this.printPage.printProvider.on({layoutchange:this.onLayoutChange,scope:this});this.setValue(this.printPage)},onFieldChange:function(c,a){var d=this.printPage.printProvider;var b=c.getValue();this._updating=true;if(c.store===d.scales||c.name==="scale"){this.printPage.setScale(a)}else{if(c.name=="rotation"){!isNaN(b)&&this.printPage.setRotation(b)}else{this.printPage.customParams[c.name]=b}}delete this._updating},onPageChange:function(a){if(!this._updating){this.setValue(a)}},onLayoutChange:function(c,a){var b=this.target;b.name=="rotation"&&b.setDisabled(!a.get("rotation"))},setValue:function(b){var a=this.target;a.suspendEvents();if(a.store===b.printProvider.scales||a.name==="scale"){if(b.scale){a.setValue(b.scale.get(a.displayField))}}else{if(a.name=="rotation"){a.setValue(b.rotation)}}a.resumeEvents()},onBeforeDestroy:function(){this.target.un("beforedestroy",this.onBeforeDestroy,this);this.target.un("select",this.onFieldChange,this);this.target.un("valid",this.onFieldChange,this);this.printPage.un("change",this.onPageChange,this);this.printPage.printProvider.un("layoutchange",this.onLayoutChange,this)}});Ext.preg("gx_printpagefield",GeoExt.plugins.PrintPageField);Ext.namespace("GeoExt.tree");GeoExt.tree.LayerNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{constructor:function(a){GeoExt.tree.LayerNodeUI.superclass.constructor.apply(this,arguments)},render:function(e){var c=this.node.attributes;if(c.checked===undefined){c.checked=this.node.layer.getVisibility()}GeoExt.tree.LayerNodeUI.superclass.render.apply(this,arguments);var b=this.checkbox;if(c.checkedGroup){var d=Ext.DomHelper.insertAfter(b,['<input type="radio" name="',c.checkedGroup,'_checkbox" class="',b.className,b.checked?'" checked="checked"':"",'"></input>'].join(""));d.defaultChecked=b.defaultChecked;Ext.get(b).remove();this.checkbox=d}this.enforceOneVisible()},onClick:function(a){if(a.getTarget(".x-tree-node-cb",1)){this.toggleCheck(this.isChecked())}else{GeoExt.tree.LayerNodeUI.superclass.onClick.apply(this,arguments)}},toggleCheck:function(a){a=(a===undefined?!this.isChecked():a);GeoExt.tree.LayerNodeUI.superclass.toggleCheck.call(this,a);this.enforceOneVisible()},enforceOneVisible:function(){var b=this.node.attributes;var e=b.checkedGroup;if(e&&e!=="gx_baselayer"){var d=this.node.layer;var a=this.node.getOwnerTree().getChecked();var c=0;Ext.each(a,function(g){var f=g.layer;if(!g.hidden&&g.attributes.checkedGroup===e){c++;if(f!=d&&b.checked){f.setVisibility(false)}}});if(c===0&&b.checked==false){d.setVisibility(true)}}},appendDDGhost:function(b){var c=this.elNode.cloneNode(true);var a=Ext.DomQuery.select("input[type='radio']",c);Ext.each(a,function(d){d.name=d.name+"_clone"});b.appendChild(c)}});GeoExt.tree.LayerNode=Ext.extend(Ext.tree.AsyncTreeNode,{layer:null,layerStore:null,constructor:function(a){a.leaf=a.leaf||!(a.children||a.loader);
if(!a.iconCls&&!a.children){a.iconCls="gx-tree-layer-icon"}if(a.loader&&!(a.loader instanceof Ext.tree.TreeLoader)){a.loader=new GeoExt.tree.LayerParamLoader(a.loader)}this.defaultUI=this.defaultUI||GeoExt.tree.LayerNodeUI;Ext.apply(this,{layer:a.layer,layerStore:a.layerStore});if(a.text){this.fixedText=true}GeoExt.tree.LayerNode.superclass.constructor.apply(this,arguments)},render:function(c){var b=this.layer instanceof OpenLayers.Layer&&this.layer;if(!b){if(!this.layerStore||this.layerStore=="auto"){this.layerStore=GeoExt.MapPanel.guess().layers}var a=this.layerStore.findBy(function(e){return e.get("title")==this.layer},this);if(a!=-1){b=this.layerStore.getAt(a).getLayer()}}if(!this.rendered||!b){var d=this.getUI();if(b){this.layer=b;if(b.isBaseLayer){this.draggable=false;Ext.applyIf(this.attributes,{checkedGroup:"gx_baselayer"})}if(!this.text){this.text=b.name}d.show();this.addVisibilityEventHandlers()}else{d.hide()}if(this.layerStore instanceof GeoExt.data.LayerStore){this.addStoreEventHandlers(b)}}GeoExt.tree.LayerNode.superclass.render.apply(this,arguments)},addVisibilityEventHandlers:function(){this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this});this.on({checkchange:this.onCheckChange,scope:this})},onLayerVisibilityChanged:function(){if(!this._visibilityChanging){this.getUI().toggleCheck(this.layer.getVisibility())}},onCheckChange:function(c,b){if(b!=this.layer.getVisibility()){this._visibilityChanging=true;var a=this.layer;if(b&&a.isBaseLayer&&a.map){a.map.setBaseLayer(a)}else{a.setVisibility(b)}delete this._visibilityChanging}},addStoreEventHandlers:function(){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,update:this.onStoreUpdate,scope:this})},onStoreAdd:function(c,b,d){var a;for(var e=0;e<b.length;++e){a=b[e].getLayer();if(this.layer==a){this.getUI().show();break}else{if(this.layer==a.name){this.render();break}}}},onStoreRemove:function(a,c,b){if(this.layer==c.getLayer()){this.getUI().hide()}},onStoreUpdate:function(b,d,a){var c=d.getLayer();if(!this.fixedText&&(this.layer==c&&this.text!==c.name)){this.setText(c.name)}},destroy:function(){var b=this.layer;if(b instanceof OpenLayers.Layer){b.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this})}delete this.layer;var a=this.layerStore;if(a){a.un("add",this.onStoreAdd,this);a.un("remove",this.onStoreRemove,this);a.un("update",this.onStoreUpdate,this)}delete this.layerStore;this.un("checkchange",this.onCheckChange,this);GeoExt.tree.LayerNode.superclass.destroy.apply(this,arguments)}});Ext.tree.TreePanel.nodeTypes.gx_layer=GeoExt.tree.LayerNode;Ext.namespace("GeoExt.tree");GeoExt.tree.LayerParamNode=Ext.extend(Ext.tree.TreeNode,{layer:null,param:null,item:null,delimiter:null,allItems:null,constructor:function(a){var b=a||{};b.iconCls=b.iconCls||"gx-tree-layerparam-icon";b.text=b.text||b.item;this.param=b.param;this.item=b.item;this.delimiter=b.delimiter||",";this.allItems=b.allItems;GeoExt.tree.LayerParamNode.superclass.constructor.apply(this,arguments);this.getLayer();if(this.layer){if(!this.allItems){this.allItems=this.getItemsFromLayer()}if(this.attributes.checked==null){this.attributes.checked=this.layer.getVisibility()&&this.getItemsFromLayer().indexOf(this.item)>=0}else{this.onCheckChange(this,this.attributes.checked)}this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this});this.on({checkchange:this.onCheckChange,scope:this})}},getLayer:function(){if(!this.layer){var c=this.attributes.layer;if(typeof c=="string"){var a=this.attributes.layerStore||GeoExt.MapPanel.guess().layers;var b=a.findBy(function(d){return d.get("title")==c});c=b!=-1?a.getAt(b).getLayer():null}this.layer=c}return this.layer},getItemsFromLayer:function(){var a=this.layer.params[this.param];return a instanceof Array?a:(a?a.split(this.delimiter):[])},createParams:function(a){var b={};b[this.param]=this.layer.params[this.param] instanceof Array?a:a.join(this.delimiter);return b},onLayerVisibilityChanged:function(){if(this.getItemsFromLayer().length===0){this.layer.mergeNewParams(this.createParams(this.allItems))
}var a=this.layer.getVisibility();if(a&&this.getItemsFromLayer().indexOf(this.item)!==-1){this.getUI().toggleCheck(true)}if(!a){this.layer.mergeNewParams(this.createParams([]));this.getUI().toggleCheck(false)}},onCheckChange:function(e,d){var c=this.layer;var b=[];var a=this.getItemsFromLayer();if(d===true&&c.getVisibility()===false&&a.length===this.allItems.length){a=[]}Ext.each(this.allItems,function(g){if((g!==this.item&&a.indexOf(g)!==-1)||(d===true&&g===this.item)){b.push(g)}},this);var f=(b.length>0);f&&c.mergeNewParams(this.createParams(b));if(f!==c.getVisibility()){c.setVisibility(f)}(!f)&&c.mergeNewParams(this.createParams([]))},destroy:function(){var a=this.layer;if(a instanceof OpenLayers.Layer){a.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this})}delete this.layer;this.un("checkchange",this.onCheckChange,this);GeoExt.tree.LayerParamNode.superclass.destroy.apply(this,arguments)}});Ext.tree.TreePanel.nodeTypes.gx_layerparam=GeoExt.tree.LayerParamNode;Ext.namespace("GeoExt");GeoExt.UrlLegend=Ext.extend(GeoExt.LayerLegend,{initComponent:function(){GeoExt.UrlLegend.superclass.initComponent.call(this);this.add(new GeoExt.LegendImage({url:this.layerRecord.get("legendURL")}))},update:function(){GeoExt.UrlLegend.superclass.update.apply(this,arguments);this.items.get(1).setUrl(this.layerRecord.get("legendURL"))}});GeoExt.UrlLegend.supports=function(a){return a.get("legendURL")!=null};GeoExt.LayerLegend.types.gx_urllegend=GeoExt.UrlLegend;Ext.reg("gx_urllegend",GeoExt.UrlLegend);Ext.namespace("GeoExt.state");GeoExt.state.PermalinkProvider=function(b){GeoExt.state.PermalinkProvider.superclass.constructor.apply(this,arguments);b=b||{};var a=b.url;delete b.url;Ext.apply(this,b);this.state=this.readURL(a)};Ext.extend(GeoExt.state.PermalinkProvider,Ext.state.Provider,{encodeType:true,readURL:function(b){var d={};var f=OpenLayers.Util.getParameters(b);var a,c,e;for(a in f){if(f.hasOwnProperty(a)){c=a.split("_");if(c.length>1){e=c[0];d[e]=d[e]||{};d[e][c.slice(1).join("_")]=this.encodeType?this.decodeValue(f[a]):f[a]}}}return d},getLink:function(d){d=d||document.location.href;var f={};var g,a,c=this.state;for(g in c){if(c.hasOwnProperty(g)){for(a in c[g]){f[g+"_"+a]=this.encodeType?unescape(this.encodeValue(c[g][a])):c[g][a]}}}OpenLayers.Util.applyDefaults(f,OpenLayers.Util.getParameters(d));var e=OpenLayers.Util.getParameterString(f);var b=d.indexOf("?");if(b>0){d=d.substring(0,b)}return Ext.urlAppend(d,e)}});Ext.namespace("GeoExt");GeoExt.LegendImage=Ext.extend(Ext.BoxComponent,{url:null,defaultImgSrc:null,imgCls:null,initComponent:function(){GeoExt.LegendImage.superclass.initComponent.call(this);if(this.defaultImgSrc===null){this.defaultImgSrc=Ext.BLANK_IMAGE_URL}this.autoEl={tag:"img","class":(this.imgCls?this.imgCls:""),src:this.defaultImgSrc}},setUrl:function(a){this.url=a;var b=this.getEl();if(b){b.un("error",this.onImageLoadError,this);b.on("error",this.onImageLoadError,this,{single:true});b.dom.src=a}},onRender:function(b,a){GeoExt.LegendImage.superclass.onRender.call(this,b,a);if(this.url){this.setUrl(this.url)}},onDestroy:function(){var a=this.getEl();if(a){a.un("error",this.onImageLoadError,this)}GeoExt.LegendImage.superclass.onDestroy.apply(this,arguments)},onImageLoadError:function(){this.getEl().dom.src=this.defaultImgSrc}});Ext.reg("gx_legendimage",GeoExt.LegendImage);Ext.namespace("GeoExt");GeoExt.LayerOpacitySlider=Ext.extend(Ext.Slider,{layer:null,complementaryLayer:null,delay:5,changeVisibilityDelay:5,aggressive:false,changeVisibility:false,value:null,inverse:false,constructor:function(a){if(a.layer){this.layer=this.getLayer(a.layer);this.bind();this.complementaryLayer=this.getLayer(a.complementaryLayer);if(a.inverse!==undefined){this.inverse=a.inverse}a.value=(a.value!==undefined)?a.value:this.getOpacityValue(this.layer);delete a.layer;delete a.complementaryLayer}GeoExt.LayerOpacitySlider.superclass.constructor.call(this,a)},bind:function(){if(this.layer&&this.layer.map){this.layer.map.events.on({changelayer:this.update,scope:this})
}},unbind:function(){if(this.layer&&this.layer.map){this.layer.map.events.un({changelayer:this.update,scope:this})}},update:function(a){if(a.property==="opacity"&&a.layer==this.layer){this.setValue(this.getOpacityValue(this.layer))}},setLayer:function(a){this.unbind();this.layer=this.getLayer(a);this.setValue(this.getOpacityValue(a));this.bind()},getOpacityValue:function(a){var b;if(a&&a.opacity!==null){b=parseInt(a.opacity*(this.maxValue-this.minValue))}else{b=this.maxValue}if(this.inverse===true){b=(this.maxValue-this.minValue)-b}return b},getLayer:function(a){if(a instanceof OpenLayers.Layer){return a}else{if(a instanceof GeoExt.data.LayerRecord){return a.getLayer()}}},initComponent:function(){GeoExt.LayerOpacitySlider.superclass.initComponent.call(this);if(this.changeVisibility&&this.layer&&(this.layer.opacity==0||(this.inverse===false&&this.value==this.minValue)||(this.inverse===true&&this.value==this.maxValue))){this.layer.setVisibility(false)}if(this.complementaryLayer&&((this.layer&&this.layer.opacity==1)||(this.inverse===false&&this.value==this.maxValue)||(this.inverse===true&&this.value==this.minValue))){this.complementaryLayer.setVisibility(false)}if(this.aggressive===true){this.on("change",this.changeLayerOpacity,this,{buffer:this.delay})}else{this.on("changecomplete",this.changeLayerOpacity,this)}if(this.changeVisibility===true){this.on("change",this.changeLayerVisibility,this,{buffer:this.changeVisibilityDelay})}if(this.complementaryLayer){this.on("change",this.changeComplementaryLayerVisibility,this,{buffer:this.changeVisibilityDelay})}this.on("beforedestroy",this.unbind,this)},changeLayerOpacity:function(a,b){if(this.layer){b=b/(this.maxValue-this.minValue);if(this.inverse===true){b=1-b}this.layer.setOpacity(b)}},changeLayerVisibility:function(a,c){var b=this.layer.getVisibility();if((this.inverse===false&&c==this.minValue)||(this.inverse===true&&c==this.maxValue)&&b===true){this.layer.setVisibility(false)}else{if((this.inverse===false&&c>this.minValue)||(this.inverse===true&&c<this.maxValue)&&b==false){this.layer.setVisibility(true)}}},changeComplementaryLayerVisibility:function(a,c){var b=this.complementaryLayer.getVisibility();if((this.inverse===false&&c==this.maxValue)||(this.inverse===true&&c==this.minValue)&&b===true){this.complementaryLayer.setVisibility(false)}else{if((this.inverse===false&&c<this.maxValue)||(this.inverse===true&&c>this.minValue)&&b==false){this.complementaryLayer.setVisibility(true)}}},addToMapPanel:function(a){this.on({render:function(){var b=this.getEl();b.setStyle({position:"absolute",zIndex:a.map.Z_INDEX_BASE.Control});b.on({mousedown:this.stopMouseEvents,click:this.stopMouseEvents})},scope:this})},removeFromMapPanel:function(a){var b=this.getEl();b.un({mousedown:this.stopMouseEvents,click:this.stopMouseEvents,scope:this});this.unbind()},stopMouseEvents:function(a){a.stopEvent()}});Ext.reg("gx_opacityslider",GeoExt.LayerOpacitySlider);Ext.namespace("GeoExt.data");GeoExt.data.AttributeReader=function(a,b){a=a||{};if(!a.format){a.format=new OpenLayers.Format.WFSDescribeFeatureType()}GeoExt.data.AttributeReader.superclass.constructor.call(this,a,b||a.fields);if(a.feature){this.recordType.prototype.fields.add(new Ext.data.Field("value"))}};Ext.extend(GeoExt.data.AttributeReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}return this.readRecords(b)},readRecords:function(m){var k;if(m instanceof Array){k=m}else{k=this.meta.format.read(m).featureTypes[0].properties}var p=this.meta.feature;var f=this.recordType;var c=f.prototype.fields;var h=c.length;var o,r,b,e,a,q,d=[];for(var l=0,n=k.length;l<n;++l){a=false;o=k[l];r={};for(var g=0;g<h;++g){b=c.items[g].name;q=o[b];if(this.ignoreAttribute(b,q)){a=true;break}r[b]=q}if(p){q=p.attributes[r.name];if(q!==undefined){if(this.ignoreAttribute("value",q)){a=true}else{r.value=q}}}if(!a){d[d.length]=new f(r)}}return{success:true,records:d,totalRecords:d.length}},ignoreAttribute:function(a,c){var d=false;
if(this.meta.ignore&&this.meta.ignore[a]){var b=this.meta.ignore[a];if(typeof b=="string"){d=(b===c)}else{if(b instanceof Array){d=(b.indexOf(c)>-1)}else{if(b instanceof RegExp){d=(b.test(c))}}}}return d}});Ext.namespace("GeoExt.plugins");GeoExt.plugins.TreeNodeComponent=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this.initialConfig,Ext.apply({},a));Ext.apply(this,a);GeoExt.plugins.TreeNodeComponent.superclass.constructor.apply(this,arguments)},init:function(a){a.on({rendernode:this.onRenderNode,scope:this})},onRenderNode:function(d){var e=d.rendered;var a=d.attributes;var c=a.component||this.component;if(!e&&c){var b=Ext.DomHelper.append(d.ui.elNode,[{tag:"div"}]);if(typeof c=="function"){c=c(d,b)}else{if(typeof c=="object"&&typeof c.fn=="function"){c=c.fn.apply(c.scope,[d,b])}}if(typeof c=="object"&&typeof c.xtype=="string"){c=Ext.ComponentMgr.create(c)}if(c instanceof Ext.Component){c.render(b);d.component=c}}},destroy:function(){tree.un("rendernode",this.onRenderNode,this)}});Ext.preg&&Ext.preg("gx_treenodecomponent",GeoExt.plugins.TreeNodeComponent);Ext.namespace("GeoExt");GeoExt.ZoomSliderTip=Ext.extend(GeoExt.SliderTip,{template:"<div>Zoom Level: {zoom}</div><div>Resolution: {resolution}</div><div>Scale: 1 : {scale}</div>",compiledTemplate:null,init:function(a){this.compiledTemplate=new Ext.Template(this.template);GeoExt.ZoomSliderTip.superclass.init.call(this,a)},getText:function(a){var b={zoom:a.value,resolution:this.slider.getResolution(),scale:Math.round(this.slider.getScale())};return this.compiledTemplate.apply(b)}});Ext.namespace("GeoExt.data");GeoExt.data.PrintProvider=Ext.extend(Ext.util.Observable,{url:null,capabilities:null,method:"POST",customParams:null,scales:null,dpis:null,layouts:null,dpi:null,layout:null,constructor:function(a){this.initialConfig=a;Ext.apply(this,a);if(!this.customParams){this.customParams={}}this.addEvents("loadcapabilities","layoutchange","dpichange","beforeprint","print","printexception","beforeencodelayer","encodelayer");GeoExt.data.PrintProvider.superclass.constructor.apply(this,arguments);this.scales=new Ext.data.JsonStore({root:"scales",sortInfo:{field:"value",direction:"DESC"},fields:["name",{name:"value",type:"float"}]});this.dpis=new Ext.data.JsonStore({root:"dpis",fields:["name",{name:"value",type:"float"}]});this.layouts=new Ext.data.JsonStore({root:"layouts",fields:["name",{name:"size",mapping:"map"},{name:"rotation",type:"boolean"}]});if(a.capabilities){this.loadStores()}else{if(this.url.split("/").pop()){this.url+="/"}this.initialConfig.autoLoad&&this.loadCapabilities()}},setLayout:function(a){this.layout=a;this.fireEvent("layoutchange",this,a)},setDpi:function(a){this.dpi=a;this.fireEvent("dpichange",this,a)},print:function(c,d,g){if(c instanceof GeoExt.MapPanel){c=c.map}d=d instanceof Array?d:[d];g=g||{};if(this.fireEvent("beforeprint",this,c,d,g)===false){return}var l=Ext.apply({units:c.getUnits(),srs:c.baseLayer.projection.getCode(),layout:this.layout.get("name"),dpi:this.dpi.get("value")},this.customParams);var f=d[0].feature.layer;var i=[];Ext.each(c.layers,function(n){if(n!==f&&n.getVisibility()===true){var m=this.encodeLayer(n);m&&i.push(m)}},this);l.layers=i;var k=[];Ext.each(d,function(m){k.push(Ext.apply({center:[m.center.lon,m.center.lat],scale:m.scale.get("value"),rotation:m.rotation},m.customParams))},this);l.pages=k;if(g.overview){var h=[];Ext.each(g.overview.layers,function(n){var m=this.encodeLayer(n);m&&h.push(m)},this);l.overviewLayers=h}if(g.legend){var j=g.legend;var e=j.rendered;if(!e){j=j.cloneConfig({renderTo:document.body,hidden:true})}var b=[];j.items.each(function(m){if(!m.hidden){var n=this.encoders.legends[m.getXType()];b=b.concat(n.call(this,m))}},this);if(!e){j.destroy()}l.legends=b}if(this.method==="GET"){var a=Ext.urlAppend(this.capabilities.printURL,"spec="+encodeURIComponent(Ext.encode(l)));window.open(a);this.fireEvent("print",this,a)}else{Ext.Ajax.request({url:this.capabilities.createURL,jsonData:l,success:function(n){var m=Ext.decode(n.responseText).getURL+(Ext.isIE?"?inline=true":"");
if(Ext.isOpera||Ext.isIE){window.open(m)}else{window.location.href=m}this.fireEvent("print",this,m)},failure:function(m){this.fireEvent("printexception",this,m)},params:this.initialConfig.baseParams,scope:this})}},loadCapabilities:function(){if(!this.url){return}var a=this.url+"info.json";Ext.Ajax.request({url:a,method:"GET",disableCaching:false,success:function(b){this.capabilities=Ext.decode(b.responseText);this.loadStores()},params:this.initialConfig.baseParams,scope:this})},loadStores:function(){this.scales.loadData(this.capabilities);this.dpis.loadData(this.capabilities);this.layouts.loadData(this.capabilities);this.setLayout(this.layouts.getAt(0));this.setDpi(this.dpis.getAt(0));this.fireEvent("loadcapabilities",this,this.capabilities)},encodeLayer:function(a){var b;for(var d in this.encoders.layers){if(OpenLayers.Layer[d]&&a instanceof OpenLayers.Layer[d]){if(this.fireEvent("beforeencodelayer",this,a)===false){return}b=this.encoders.layers[d].call(this,a);this.fireEvent("encodelayer",this,a,b);break}}return(b&&b.type)?b:null},getAbsoluteUrl:function(c){var b;if(Ext.isIE){b=document.createElement("<a href='"+c+"'/>");b.style.display="none";document.body.appendChild(b);b.href=b.href;document.body.removeChild(b)}else{b=document.createElement("a");b.href=c}return b.href},encoders:{layers:{WMS:function(b){var a=this.encoders.layers.HTTPRequest.call(this,b);Ext.apply(a,{type:"WMS",layers:[b.params.LAYERS].join(",").split(","),format:b.params.FORMAT,styles:[b.params.STYLES].join(",").split(",")});var d;for(var c in b.params){d=c.toLowerCase();if(!b.DEFAULT_PARAMS[d]&&"layers,styles,width,height,srs".indexOf(d)==-1){if(!a.customParams){a.customParams={}}a.customParams[c]=b.params[c]}}return a},OSM:function(b){var a=this.encoders.layers.TileCache.call(this,b);return Ext.apply(a,{type:"OSM",baseURL:a.baseURL.substr(0,a.baseURL.indexOf("$")),extension:"png"})},TMS:function(b){var a=this.encoders.layers.TileCache.call(this,b);return Ext.apply(a,{type:"TMS",format:b.type})},TileCache:function(b){var a=this.encoders.layers.HTTPRequest.call(this,b);return Ext.apply(a,{type:"TileCache",layer:b.layername,maxExtent:b.maxExtent.toArray(),tileSize:[b.tileSize.w,b.tileSize.h],extension:b.extension,resolutions:b.serverResolutions||b.resolutions})},KaMapCache:function(b){var a=this.encoders.layers.KaMap.call(this,b);return Ext.apply(a,{type:"KaMapCache",group:b.params.g,metaTileWidth:b.params.metaTileSize["w"],metaTileHeight:b.params.metaTileSize["h"]})},KaMap:function(b){var a=this.encoders.layers.HTTPRequest.call(this,b);return Ext.apply(a,{type:"KaMap",map:b.params.map,extension:b.params.i,group:b.params.g||"",maxExtent:b.maxExtent.toArray(),tileSize:[b.tileSize.w,b.tileSize.h],resolutions:b.serverResolutions||b.resolutions})},HTTPRequest:function(a){return{baseURL:this.getAbsoluteUrl(a.url instanceof Array?a.url[0]:a.url),opacity:(a.opacity!=null)?a.opacity:1,singleTile:a.singleTile}},Image:function(a){return{type:"Image",baseURL:this.getAbsoluteUrl(a.getURL(a.extent)),opacity:(a.opacity!=null)?a.opacity:1,extent:a.extent.toArray(),pixelSize:[a.size.w,a.size.h],name:a.name}},Vector:function(k){if(!k.features.length){return}var d=[];var p={};var m=k.features;var q=new OpenLayers.Format.GeoJSON();var j=new OpenLayers.Format.JSON();var n=1;var h={};var o,a,g,c,b;for(var f=0,l=m.length;f<l;++f){o=m[f];a=o.style||k.style||k.styleMap.createSymbolizer(o,o.renderIntent);g=j.write(a);c=h[g];if(c){b=c}else{h[g]=b=n++;if(a.externalGraphic){p[b]=Ext.applyIf({externalGraphic:this.getAbsoluteUrl(a.externalGraphic)},a)}else{p[b]=a}}var e=q.extract.feature.call(q,o);e.properties=OpenLayers.Util.extend({_gx_style:b},e.properties);d.push(e)}return{type:"Vector",styles:p,styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:d},name:k.name,opacity:(k.opacity!=null)?k.opacity:1}}},legends:{gx_wmslegend:function(c){var b=this.encoders.legends.base.call(this,c);var e=[];for(var d=1,a=c.items.getCount();d<a;++d){e.push(this.getAbsoluteUrl(c.items.get(d).url))
}b[0].classes[0]={name:"",icons:e};return b},gx_urllegend:function(b){var a=this.encoders.legends.base.call(this,b);a[0].classes.push({name:"",icon:this.getAbsoluteUrl(b.items.get(1).url)});return a},base:function(a){return[{name:a.items.get(0).text,classes:[]}]}}}});Ext.namespace("GeoExt");GeoExt.MapPanel=Ext.extend(Ext.Panel,{map:null,layers:null,center:null,zoom:null,prettyStateKeys:false,extent:null,stateEvents:["aftermapmove","afterlayervisibilitychange","afterlayeropacitychange"],initComponent:function(){if(!(this.map instanceof OpenLayers.Map)){this.map=new OpenLayers.Map(Ext.applyIf(this.map||{},{allOverlays:true}))}var a=this.layers;if(!a||a instanceof Array){this.layers=new GeoExt.data.LayerStore({layers:a,map:this.map.layers.length>0?this.map:null})}if(typeof this.center=="string"){this.center=OpenLayers.LonLat.fromString(this.center)}else{if(this.center instanceof Array){this.center=new OpenLayers.LonLat(this.center[0],this.center[1])}}if(typeof this.extent=="string"){this.extent=OpenLayers.Bounds.fromString(this.extent)}else{if(this.extent instanceof Array){this.extent=OpenLayers.Bounds.fromArray(this.extent)}}GeoExt.MapPanel.superclass.initComponent.call(this);this.addEvents("aftermapmove","afterlayervisibilitychange","afterlayeropacitychange");this.map.events.on({moveend:this.onMoveend,changelayer:this.onLayerchange,scope:this})},onMoveend:function(){this.fireEvent("aftermapmove")},onLayerchange:function(a){if(a.property){if(a.property==="visibility"){this.fireEvent("afterlayervisibilitychange")}else{if(a.property==="opacity"){this.fireEvent("afterlayeropacitychange")}}}},applyState:function(g){this.center=new OpenLayers.LonLat(g.x,g.y);this.zoom=g.zoom;var e,b,d,f,a,c;var h=this.map.layers;for(e=0,b=h.length;e<b;e++){d=h[e];f=this.prettyStateKeys?d.name:d.id;a=g["visibility_"+f];if(a!==undefined){a=(/^true$/i).test(a);if(d.isBaseLayer){if(a){this.map.setBaseLayer(d)}}else{d.setVisibility(a)}}c=g["opacity_"+f];if(c!==undefined){d.setOpacity(c)}}},getState:function(){var f;if(!this.map){return}var e=this.map.getCenter();f={x:e.lon,y:e.lat,zoom:this.map.getZoom()};var c,a,b,d,g=this.map.layers;for(c=0,a=g.length;c<a;c++){b=g[c];d=this.prettyStateKeys?b.name:b.id;f["visibility_"+d]=b.getVisibility();f["opacity_"+d]=b.opacity==null?1:b.opacity}return f},updateMapSize:function(){if(this.map){this.map.updateSize()}},renderMap:function(){var a=this.map;a.render(this.body.dom);this.layers.bind(a);if(a.layers.length>0){if(this.center||this.zoom!=null){a.setCenter(this.center,this.zoom)}else{if(this.extent){a.zoomToExtent(this.extent)}else{a.zoomToMaxExtent()}}}},afterRender:function(){GeoExt.MapPanel.superclass.afterRender.apply(this,arguments);if(!this.ownerCt){this.renderMap()}else{this.ownerCt.on("move",this.updateMapSize,this);this.ownerCt.on({afterlayout:{fn:this.renderMap,scope:this,single:true}})}},onResize:function(){GeoExt.MapPanel.superclass.onResize.apply(this,arguments);this.updateMapSize()},onBeforeAdd:function(a){if(typeof a.addToMapPanel==="function"){a.addToMapPanel(this)}GeoExt.MapPanel.superclass.onBeforeAdd.apply(this,arguments)},remove:function(b,a){if(typeof b.removeFromMapPanel==="function"){b.removeFromMapPanel(this)}GeoExt.MapPanel.superclass.remove.apply(this,arguments)},beforeDestroy:function(){if(this.ownerCt){this.ownerCt.un("move",this.updateMapSize,this)}if(this.map&&this.map.events){this.map.events.un({moveend:this.onMoveend,changelayer:this.onLayerchange,scope:this})}if(!this.initialConfig.map||!(this.initialConfig.map instanceof OpenLayers.Map)){if(this.map&&this.map.destroy){this.map.destroy()}}delete this.map;GeoExt.MapPanel.superclass.beforeDestroy.apply(this,arguments)}});GeoExt.MapPanel.guess=function(){return Ext.ComponentMgr.all.find(function(a){return a instanceof GeoExt.MapPanel})};Ext.reg("gx_mappanel",GeoExt.MapPanel);Ext.namespace("GeoExt");GeoExt.PrintMapPanel=Ext.extend(GeoExt.MapPanel,{sourceMap:null,printProvider:null,printPage:null,previewScales:null,center:null,zoom:null,extent:null,currentZoom:null,initComponent:function(){if(this.sourceMap instanceof GeoExt.MapPanel){this.sourceMap=this.sourceMap.map
}if(!this.map){this.map={}}Ext.applyIf(this.map,{projection:this.sourceMap.getProjection(),maxExtent:this.sourceMap.getMaxExtent(),maxResolution:this.sourceMap.getMaxResolution(),units:this.sourceMap.getUnits()});if(!(this.printProvider instanceof GeoExt.data.PrintProvider)){this.printProvider=new GeoExt.data.PrintProvider(this.printProvider)}this.printPage=new GeoExt.data.PrintPage({printProvider:this.printProvider});this.previewScales=new Ext.data.Store();this.previewScales.add(this.printProvider.scales.getRange());this.layers=[];var a;Ext.each(this.sourceMap.layers,function(b){var c=b.clone();b.getVisibility()===true&&this.layers.push(c)},this);this.extent=this.sourceMap.getExtent();GeoExt.PrintMapPanel.superclass.initComponent.call(this);this.printProvider.on("layoutchange",this.syncSize,this);this.printPage.on("change",this.fitZoom,this);this.map.events.register("moveend",this,this.updatePage)},afterRender:function(){GeoExt.PrintMapPanel.superclass.afterRender.apply(this,arguments);this.syncSize();if(this.initialConfig.limitScales===true){if(!this.ownerCt){this.calculatePreviewScales()}else{this.ownerCt.on({afterlayout:{fn:this.calculatePreviewScales,scope:this,single:true}})}this.on("resize",this.calculatePreviewScales,this)}},adjustSize:function(d,f){var g=this.printProvider.layout.get("size");var c=g.width/g.height;var a=this.ownerCt;var b=(a&&a.autoWidth)?0:(d||this.initialConfig.width);var e=(a&&a.autoHeight)?0:(f||this.initialConfig.height);if(b){f=b/c;if(e&&f>e){f=e;d=f*c}else{d=b}}else{if(e){d=e*c;f=e}}return{width:d,height:f}},fitZoom:function(){if(!this._updating&&this.printPage.scale){this._updating=true;var a=this.printPage.getPrintExtent(this.map);this.currentZoom=this.map.getZoomForExtent(a);this.map.zoomToExtent(a);delete this._updating}},updatePage:function(){if(!this._updating){var a=this.map.getZoom();this._updating=true;if(a===this.currentZoom){this.printPage.setCenter(this.map.getCenter())}else{this.printPage.fit(this.map)}delete this._updating;this.currentZoom=a}},calculatePreviewScales:function(){this.previewScales.removeAll();this.printPage.suspendEvents();var e=this.printPage.scale;var h=this.map.getSize();var g={};var a=[];this.printProvider.scales.each(function(n){this.printPage.setScale(n);var j=this.printPage.getPrintExtent(this.map);var l=this.map.getZoomForExtent(j);var i=Math.max(j.getWidth()/h.w,j.getHeight()/h.h);var k=this.map.getResolutionForZoom(l);var m=Math.abs(i-k);if(!(l in g)||g[l].diff>m){g[l]={rec:n,diff:m};a.indexOf(l)==-1&&a.push(l)}},this);for(var b=0,c=a.length;b<c;++b){this.previewScales.add(g[a[b]].rec)}e&&this.printPage.setScale(e);this.printPage.resumeEvents();if(e&&this.previewScales.getCount()>0){var f=this.previewScales.getAt(0);var d=this.previewScales.getAt(this.previewScales.getCount()-1);if(e.get("value")<d.get("value")){this.printPage.setScale(d)}else{if(e.get("value")>f.get("value")){this.printPage.setScale(f)}}}this.fitZoom()},print:function(a){this.printProvider.print(this.map,[this.printPage],a)},beforeDestroy:function(){this.map.events.unregister("moveend",this,this.updatePage);this.printPage.un("change",this.fitZoom,this);this.printProvider.un("layoutchange",this.syncSize,this);GeoExt.PrintMapPanel.superclass.beforeDestroy.apply(this,arguments)}});Ext.reg("gx_printmappanel",GeoExt.PrintMapPanel);Ext.namespace("GeoExt.data");GeoExt.data.ScaleStore=Ext.extend(Ext.data.Store,{map:null,constructor:function(a){var b=(a.map instanceof GeoExt.MapPanel?a.map.map:a.map);delete a.map;a=Ext.applyIf(a,{reader:new Ext.data.JsonReader({},["level","resolution","scale"])});GeoExt.data.ScaleStore.superclass.constructor.call(this,a);if(b){this.bind(b)}},bind:function(b,a){this.map=(b instanceof GeoExt.MapPanel?b.map:b);this.map.events.register("changebaselayer",this,this.populateFromMap);if(this.map.baseLayer){this.populateFromMap()}else{this.map.events.register("addlayer",this,this.populateOnAdd)}},unbind:function(){if(this.map){this.map.events.unregister("addlayer",this,this.populateOnAdd);
this.map.events.unregister("changebaselayer",this,this.populateFromMap);delete this.map}},populateOnAdd:function(a){if(a.layer.isBaseLayer){this.populateFromMap();this.map.events.unregister("addlayer",this,this.populateOnAdd)}},populateFromMap:function(){var c=[];var a=this.map.baseLayer.resolutions;var b=this.map.baseLayer.units;for(var e=a.length-1;e>=0;e--){var d=a[e];c.push({level:e,resolution:d,scale:OpenLayers.Util.getScaleFromResolution(d,b)})}this.loadData(c)},destroy:function(){this.unbind();GeoExt.data.ScaleStore.superclass.destroy.apply(this,arguments)}});Ext.namespace("GeoExt.data");GeoExt.data.FeatureStoreMixin=function(){return{layer:null,reader:null,featureFilter:null,constructor:function(c){c=c||{};c.reader=c.reader||new GeoExt.data.FeatureReader({},c.fields);var b=c.layer;delete c.layer;if(c.features){c.data=c.features}delete c.features;var a={initDir:c.initDir};delete c.initDir;arguments.callee.superclass.constructor.call(this,c);if(b){this.bind(b,a)}},bind:function(e,d){if(this.layer){return}this.layer=e;d=d||{};var f=d.initDir;if(d.initDir==undefined){f=GeoExt.data.FeatureStore.LAYER_TO_STORE|GeoExt.data.FeatureStore.STORE_TO_LAYER}var b=e.features.slice(0);if(f&GeoExt.data.FeatureStore.STORE_TO_LAYER){var a=this.getRange();for(var c=a.length-1;c>=0;c--){this.layer.addFeatures([a[c].getFeature()])}}if(f&GeoExt.data.FeatureStore.LAYER_TO_STORE){this.loadData(b,true)}e.events.on({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this});this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this})},unbind:function(){if(this.layer){this.layer.events.un({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this});this.un("load",this.onLoad,this);this.un("clear",this.onClear,this);this.un("add",this.onAdd,this);this.un("remove",this.onRemove,this);this.un("update",this.onUpdate,this);this.layer=null}},getRecordFromFeature:function(b){var c=null;if(b.state!==OpenLayers.State.INSERT){c=this.getById(b.id)}else{var a=this.findBy(function(d){return d.getFeature()===b});if(a>-1){c=this.getAt(a)}}return c},onFeaturesAdded:function(b){if(!this._adding){var c=b.features,f=c;if(this.featureFilter){f=[];var e,a,d;for(var e=0,a=c.length;e<a;e++){d=c[e];if(this.featureFilter.evaluate(d)!==false){f.push(d)}}}this._adding=true;this.loadData(f,true);delete this._adding}},onFeaturesRemoved:function(a){if(!this._removing){var b=a.features,c,e,d;for(d=b.length-1;d>=0;d--){c=b[d];e=this.getRecordFromFeature(c);if(e!==undefined){this._removing=true;this.remove(e);delete this._removing}}}},onFeatureModified:function(j){if(!this._updating){var f=j.feature;var b=this.getRecordFromFeature(f);if(b!==undefined){b.beginEdit();var c=f.attributes;if(c){var a=this.recordType.prototype.fields;for(var d=0,e=a.length;d<e;d++){var g=a.items[d];var h=g.mapping||g.name;if(h in c){b.set(g.name,g.convert(c[h]))}}}b.set("state",f.state);b.set("fid",f.fid);b.setFeature(f);this._updating=true;b.endEdit();delete this._updating}}},addFeaturesToLayer:function(c){var d,a,b;b=new Array((a=c.length));for(d=0;d<a;d++){b[d]=c[d].getFeature()}if(b.length>0){this._adding=true;this.layer.addFeatures(b);delete this._adding}},onLoad:function(b,a,c){if(!c||c.add!==true){this._removing=true;this.layer.removeFeatures(this.layer.features);delete this._removing;this.addFeaturesToLayer(a)}},onClear:function(a){this._removing=true;this.layer.removeFeatures(this.layer.features);delete this._removing},onAdd:function(b,a,c){if(!this._adding){this.addFeaturesToLayer(a)}},onRemove:function(a,d,c){if(!this._removing){var b=d.getFeature();if(this.layer.getFeatureById(b.id)!=null){this._removing=true;this.layer.removeFeatures([d.getFeature()]);delete this._removing}}},onUpdate:function(d,f,c){if(!this._updating){var g=new GeoExt.data.FeatureRecord().fields;var e=f.getFeature();if(f.fields){var a=this.layer.events.triggerEvent("beforefeaturemodified",{feature:e});
if(a!==false){var b=e.attributes;f.fields.each(function(i){var h=i.mapping||i.name;if(!g.containsKey(h)){b[h]=f.get(i.name)}});this._updating=true;this.layer.events.triggerEvent("featuremodified",{feature:e});delete this._updating;if(this.layer.getFeatureById(e.id)!=null){this.layer.drawFeature(e)}}}}}}};GeoExt.data.FeatureStore=Ext.extend(Ext.data.Store,new GeoExt.data.FeatureStoreMixin);GeoExt.data.FeatureStore.LAYER_TO_STORE=1;GeoExt.data.FeatureStore.STORE_TO_LAYER=2;Ext.namespace("GeoExt.data");GeoExt.data.WFSCapabilitiesStore=function(a){a=a||{};GeoExt.data.WFSCapabilitiesStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(!a.data?new Ext.data.HttpProxy({url:a.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.WFSCapabilitiesReader(a,a.fields)}))};Ext.extend(GeoExt.data.WFSCapabilitiesStore,Ext.data.Store);Ext.namespace("GeoExt.plugins");GeoExt.plugins.AttributeForm=function(a){Ext.apply(this,a)};GeoExt.plugins.AttributeForm.prototype={attributeStore:null,formPanel:null,init:function(a){this.formPanel=a;if(this.attributeStore instanceof Ext.data.Store){this.fillForm();this.bind(this.attributeStore)}a.on("destroy",this.onFormDestroy,this)},bind:function(a){this.unbind();a.on({load:this.onLoad,scope:this});this.attributeStore=a},unbind:function(){if(this.attributeStore){this.attributeStore.un("load",this.onLoad,this)}},onLoad:function(){if(this.formPanel.items){this.formPanel.removeAll()}this.fillForm()},fillForm:function(){this.attributeStore.each(function(a){var b=GeoExt.form.recordToField(a);if(b){this.formPanel.add(b)}},this);this.formPanel.doLayout()},onFormDestroy:function(){this.unbind()}};Ext.preg("gx_attributeform",GeoExt.plugins.AttributeForm);Ext.namespace("GeoExt","GeoExt.data");GeoExt.data.ProtocolProxy=function(a){Ext.apply(this,a);GeoExt.data.ProtocolProxy.superclass.constructor.apply(this,arguments)};Ext.extend(GeoExt.data.ProtocolProxy,Ext.data.DataProxy,{protocol:null,abortPrevious:true,setParamsAsOptions:false,response:null,load:function(h,e,f,d,b){if(this.fireEvent("beforeload",this,h)!==false){var g={params:h||{},request:{callback:f,scope:d,arg:b},reader:e};var a=OpenLayers.Function.bind(this.loadResponse,this,g);if(this.abortPrevious){this.abortRequest()}var c={params:h,callback:a,scope:this};Ext.applyIf(c,b);if(this.setParamsAsOptions===true){Ext.applyIf(c,c.params);delete c.params}this.response=this.protocol.read(c)}else{f.call(d||this,null,b,false)}},abortRequest:function(){if(this.response){this.protocol.abort(this.response);this.response=null}},loadResponse:function(c,a){if(a.success()){var b=c.reader.read(a);this.fireEvent("load",this,c,c.request.arg);c.request.callback.call(c.request.scope,b,c.request.arg,true)}else{this.fireEvent("loadexception",this,c,a);c.request.callback.call(c.request.scope,null,c.request.arg,false)}}});Ext.namespace("GeoExt");GeoExt.Action=Ext.extend(Ext.Action,{control:null,map:null,uScope:null,uHandler:null,uToggleHandler:null,uCheckHandler:null,constructor:function(a){this.uScope=a.scope;this.uHandler=a.handler;this.uToggleHandler=a.toggleHandler;this.uCheckHandler=a.checkHandler;a.scope=this;a.handler=this.pHandler;a.toggleHandler=this.pToggleHandler;a.checkHandler=this.pCheckHandler;var b=this.control=a.control;delete a.control;if(b){if(a.map){a.map.addControl(b);delete a.map}if((a.pressed||a.checked)&&b.map){b.activate()}b.events.on({activate:this.onCtrlActivate,deactivate:this.onCtrlDeactivate,scope:this})}arguments.callee.superclass.constructor.call(this,a)},pHandler:function(a){var b=this.control;if(b&&b.type==OpenLayers.Control.TYPE_BUTTON){b.trigger()}if(this.uHandler){this.uHandler.apply(this.uScope,arguments)}},pToggleHandler:function(a,b){this.changeControlState(b);if(this.uToggleHandler){this.uToggleHandler.apply(this.uScope,arguments)}},pCheckHandler:function(a,b){this.changeControlState(b);if(this.uCheckHandler){this.uCheckHandler.apply(this.uScope,arguments)}},changeControlState:function(a){if(a){if(!this._activating){this._activating=true;
this.control.activate();this._activating=false}}else{if(!this._deactivating){this._deactivating=true;this.control.deactivate();this._deactivating=false}}},onCtrlActivate:function(){var a=this.control;if(a.type==OpenLayers.Control.TYPE_BUTTON){this.enable()}else{this.safeCallEach("toggle",[true]);this.safeCallEach("setChecked",[true])}},onCtrlDeactivate:function(){var a=this.control;if(a.type==OpenLayers.Control.TYPE_BUTTON){this.disable()}else{this.safeCallEach("toggle",[false]);this.safeCallEach("setChecked",[false])}},safeCallEach:function(e,b){var d=this.items;for(var c=0,a=d.length;c<a;c++){if(d[c][e]){d[c].rendered?d[c][e].apply(d[c],b):d[c].on({render:d[c][e].createDelegate(d[c],b),single:true})}}}});Ext.namespace("GeoExt.tree");GeoExt.tree.TreeNodeUIEventMixin=function(){return{constructor:function(a){a.addEvents("rendernode","rawclicknode");this.superclass=arguments.callee.superclass;this.superclass.constructor.apply(this,arguments)},render:function(a){if(!this.rendered){this.superclass.render.apply(this,arguments);this.fireEvent("rendernode",this.node)}},onClick:function(a){if(this.fireEvent("rawclicknode",this.node,a)!==false){this.superclass.onClick.apply(this,arguments)}}}};Ext.namespace("GeoExt.plugins");GeoExt.plugins.TreeNodeRadioButton=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this.initialConfig,Ext.apply({},a));Ext.apply(this,a);this.addEvents("radiochange");GeoExt.plugins.TreeNodeRadioButton.superclass.constructor.apply(this,arguments)},init:function(a){a.on({rendernode:this.onRenderNode,rawclicknode:this.onRawClickNode,beforedestroy:this.onBeforeDestroy,scope:this})},onRenderNode:function(c){var b=c.attributes;if(b.radioGroup&&!b.radio){b.radio=Ext.DomHelper.insertBefore(c.ui.anchor,['<input type="radio" class="gx-tree-radio" name="',b.radioGroup,'_radio"></input>'].join(""))}},onRawClickNode:function(b,c){var a=c.getTarget(".gx-tree-radio",1);if(a){a.defaultChecked=a.checked;this.fireEvent("radiochange",b);return false}},onBeforeDestroy:function(a){a.un("rendernode",this.onRenderNode,this);a.un("rawclicknode",this.onRenderNode,this);a.un("beforedestroy",this.onBeforeDestroy,this)}});Ext.preg("gx_treenoderadiobutton",GeoExt.plugins.TreeNodeRadioButton);Ext.namespace("GeoExt.data");GeoExt.data.WMSCapabilitiesStore=function(a){a=a||{};GeoExt.data.WMSCapabilitiesStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(!a.data?new Ext.data.HttpProxy({url:a.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.WMSCapabilitiesReader(a,a.fields)}))};Ext.extend(GeoExt.data.WMSCapabilitiesStore,Ext.data.Store);Ext.namespace("GeoExt");GeoExt.LayerOpacitySliderTip=Ext.extend(GeoExt.SliderTip,{template:"<div>{opacity}%</div>",compiledTemplate:null,init:function(a){this.compiledTemplate=new Ext.Template(this.template);GeoExt.LayerOpacitySliderTip.superclass.init.call(this,a)},getText:function(a){var b={opacity:a.value};return this.compiledTemplate.apply(b)}});GeoExt.version="1.0";Ext.namespace("GeoExt.tree");GeoExt.tree.TreeNodeUIEventMixinExtended=function(){return{constructor:function(a){a.addEvents("rendernode","rawclicknode","rawslidenode");this.superclass=arguments.callee.superclass;this.superclass.constructor.apply(this,arguments)},render:function(a){if(!this.rendered){this.superclass.render.apply(this,arguments);this.fireEvent("rendernode",this.node)}},onClick:function(a){if(this.fireEvent("rawclicknode",this.node,a)!==false){if(this.fireEvent("rawlayerinfoclick",this.node,a)!==false){this.superclass.onClick.apply(this,arguments)}}},onSliderChange:function(b,c,a){if(this.fireEvent("rawslidenode",this.node,b,c)!==false){}}}};Ext.namespace("GeoExt.tree");GeoExt.tree.LayerOpacitySliderPlugin=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this.initialConfig,Ext.apply({},a));Ext.apply(this,a);this.addEvents("opacityslide");GeoExt.tree.LayerOpacitySliderPlugin.superclass.constructor.apply(this,arguments)},init:function(a){a.on({rendernode:this.onRenderNode,rawslidenode:this.onRawSlideNode,scope:this})},onRenderNode:function(g){var c=g.attributes;var f=g.layer;if(c.slider){this.indentMarkup=g.parentNode?g.parentNode.ui.getChildIndent():"";var e=g.id+"-tree-slider-";e=Ext.id(null,e);buf=["<br/>","<table><tr>","<td>",'<span class="x-tree-node-indent">',this.indentMarkup,"</span>","</td><td>",'<span class="x-tree-node-indent">',this.indentMarkup,"</span>","</td><td>","<a id=",e,"></a>","</td>","</tr></table>"];Ext.DomHelper.insertAfter(g.ui.anchor,buf.join(""));var d=100;var b=new Ext.Slider({minValue:0,maxValue:100,value:d,width:100,aggressive:true,plugins:new GeoExt.LayerOpacitySliderTip()});Ext.override(Ext.Slider,{getRatio:function(){var a=this.innerEl.getComputedWidth();var h=this.maxValue-this.minValue;return h==0?a:(a/h)}});b.on("change",g.ui.onSliderChange,g.ui);b.render(e)}},onRawSlideNode:function(b,a,c){b.layer.setOpacity(c/100);this.fireEvent("opacityslide",b,c);return(false)}});Ext.preg&&Ext.preg("gx_layeropacitysliderplugin",GeoExt.tree.LayerOpacitySliderPlugin);Ext.namespace("GeoExt.tree");GeoExt.tree.RadioButtonPlugin=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this.initialConfig,Ext.apply({},a));Ext.apply(this,a);this.addEvents("radiochange");GeoExt.tree.RadioButtonPlugin.superclass.constructor.apply(this,arguments)},init:function(a){a.on({rendernode:this.onRenderNode,rawclicknode:this.onRawClickNode,scope:this})},onRenderNode:function(c){var b=c.attributes;if(b.radioGroup&&!b.radio){b.radio=Ext.DomHelper.insertBefore(c.ui.anchor,['<input type="radio" class="gx-tree-radio" name="',b.radioGroup,'_radio"></input>'].join(""))}},onRawClickNode:function(b,c){var a=c.getTarget(".gx-tree-radio",1);if(a){a.defaultChecked=a.checked;this.fireEvent("radiochange",b);return false}}});Ext.preg&&Ext.preg("gx_radiobuttonplugin",GeoExt.tree.RadioButtonPlugin);Ext.namespace("GeoExt.tree");GeoExt.tree.LayerInfoPlugin=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this.initialConfig,Ext.apply({},a));Ext.apply(this,a);this.addEvents("layerinfoclick");GeoExt.tree.LayerInfoPlugin.superclass.constructor.apply(this,arguments)},init:function(a){a.on({rendernode:this.onRenderNode,rawlayerinfoclick:this.onRawLayerInfoClick,scope:this})},onRenderNode:function(e){var b=e.attributes;var d=e.layer;if(b.layerinfo){var c=['<input type="button" class="gx-layer-info"></input>'];Ext.DomHelper.insertBefore(e.ui.anchor,c.join(""))}},onRawLayerInfoClick:function(b,c){var a=c.getTarget(".gx-layer-info",1);if(a){this.fireEvent("layerinfoclick",b);return(false)}return(true)}});Ext.preg&&Ext.preg("gx_layerinfoplugin",GeoExt.tree.LayerInfoPlugin);HighchartsAdapter={each:Ext.each,map:function(b,e){var d=[];if(b){for(var c=0,a=b.length;c<a;c++){d[c]=e.call(b[c],b[c],c,b)}}return d},grep:function(c,f,a){var d=[];for(var e=0,b=c.length;e<b;e++){if(!a!=!f(c[e],e)){d.push(c[e])}}return d},merge:function(){var a=arguments;var b=function(){var k=arguments[0]||{},g=1,d=arguments.length,c=false,f;if(typeof k==="boolean"){c=k;k=arguments[1]||{};g=2}if(typeof k!=="object"&&!Ext.isFunction(k)){k={}}if(d==g){k=this;--g}for(;g<d;g++){if((f=arguments[g])!=null){for(var e in f){var h=k[e],j=f[e];if(k===j){continue}if(c&&j&&typeof j==="object"&&!j.nodeType){k[e]=b(c,h||(j.length!=null?[]:{}),j)}else{if(j!==undefined){k[e]=j}}}}}return k};return b(true,null,a[0],a[1],a[2],a[3])},hyphenate:function(a){return a.replace(/([A-Z])/g,function(d,c){return"-"+c.toLowerCase()})},addEvent:function(b,c,a){var d=Ext.get(b);if(d){d.addListener(c,a)}else{if(!b.addListener){Ext.apply(b,new Ext.util.Observable())}b.addListener(c,a)}},fireEvent:function(a,c,b,d){var e={type:c,target:a};Ext.apply(e,b);if(a.fireEvent){a.fireEvent(c,e)}if(d){d(e)}},removeEvent:function(b,c,a){if(b.removeListener&&b.purgeListeners){if(c&&a){b.removeListener(c,a)}else{b.purgeListeners()}}else{var d=Ext.get(b);if(d){if(c&&a){d.removeListener(c,a)}else{d.purgeAllListeners()}}}},stop:function(a){},animate:function(b,e,c){var d=b;var a=b.attr;if(a){d=Ext.get(b.element)}if(c){if(c.duration==undefined||c.duration==0){c.duration=1}else{c.duration=c.duration/1000}}else{c={}}if(e.width!==undefined){if(a){if(Ext.isIE){b.attr("width",e.width)}else{b.element.setAttributeNS(null,"width",e.width)}}else{d.setWidth(e.width)}}else{if(e.height!==undefined){if(a){if(Ext.isIE){b.attr("height",e.height);if(e.y){b.attr("y",e.y)}}else{b.element.setAttributeNS(null,"height",e.height);if(e.y){b.element.setAttributeNS(null,"y",e.y)}}}else{d.setHeight(e.height)}}else{if(e.left!==undefined){if(a){if(Ext.isIE){b.attr("left",e.left)}else{b.element.setAttributeNS(null,"left",e.left)}}else{d.setLeft(e.left)}}else{if(e.top){if(a){if(Ext.isIE){b.attr("top",e.top)}else{b.element.setAttributeNS(null,"top",e.top)}}else{d.setTop(e.top)}}else{if(e.translateX&&e.translateY){if(a){if(Ext.isIE){b.attr("transform","translate("+e.translateX+","+e.translateY+" )")}else{b.element.setAttributeNS(null,"transform","translate("+e.translateX+","+e.translateY+" )")}}}}}}}if(e.opacity!==undefined){if(!a){d.setOpacity(parseInt(e.opacity),{duration:c.duration,callback:c.complete})}}if(c.complete!=undefined){c.complete()}},getAjax:function(a,b){Ext.Ajax.request({url:a,success:function(c){b(c.responseText)}})}};(function(){var B=document,ax=window,R=Math,w=R.round,N=R.floor,a7=R.ceil,aH=R.max,X=R.min,a6=R.abs,aO=R.cos,z=R.sin,d=navigator.userAgent,a2=/msie/i.test(d)&&!ax.opera,W=/AppleWebKit/.test(d),i=ax.SVGAngle||B.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),aG,I,ac={},H=0,E=1,aS,aD,at,au,aj="div",r="absolute",l="relative",am="hidden",aT="highcharts-",ah="visible",af="px",ad="none",ao="M",ap="L",az="rgba(192,192,192,"+(i?0.000001:0.002)+")",aC="",aF="hover",v="select",aW,D,aI,ak,o,aJ,ag,S,A,aM,C,aV,c=ax.HighchartsAdapter,aR=c||{},a8=aR.each,m=aR.grep,t=aR.map,y=aR.merge,aY=aR.hyphenate,aw=aR.addEvent,aq=aR.removeEvent,K=aR.fireEvent,an=aR.animate,aK=aR.stop,ae=aR.getAjax,p={};function Y(M,L){if(!M){M={}}for(var a9 in L){M[a9]=L[a9]}return M}function h(L){return L!==au&&L!==null}function V(a9,bc,bb){var M,ba="setAttribute",L;if(typeof bc=="string"){if(h(bb)){a9[ba](bc,bb)}else{if(a9&&a9.getAttribute){L=a9.getAttribute(bc)}}}else{if(h(bc)&&typeof bc=="object"){for(M in bc){a9[ba](M,bc[M])}}}return L}function Z(L){if(!L||L.constructor!=Array){L=[L]}return L}function b(){var M=arguments,a9,L;for(a9=0;a9<M.length;a9++){L=M[a9];if(h(L)){return L}}}function aZ(a9){var M="",L;for(L in a9){M+=aY(L)+":"+a9[L]+";"}return M}function ar(M,L){if(a2){if(L&&L.opacity!==au){L.filter="alpha(opacity="+(L.opacity*100)+")"}}Y(M.style,L)}function al(L,bc,M,a9,bb){var ba=B.createElement(L);if(bc){Y(ba,bc)}if(bb){ar(ba,{padding:0,border:ad,margin:0})}if(M){ar(ba,M)}if(a9){a9.appendChild(ba)}return ba}if(!c&&ax.jQuery){var G=jQuery;a8=function(M,ba){for(var a9=0,L=M.length;a9<L;a9++){if(ba.call(M[a9],M[a9],a9,M)===false){return a9}}};m=G.grep;t=function(M,bb){var ba=[];for(var a9=0,L=M.length;a9<L;a9++){ba[a9]=bb.call(M[a9],M[a9],a9,M)}return ba};y=function(){var L=arguments;return G.extend(true,null,L[0],L[1],L[2],L[3])};aY=function(L){return L.replace(/([A-Z])/g,function(a9,M){return"-"+M.toLowerCase()})};aw=function(M,a9,L){G(M).bind(a9,L)};aq=function(a9,L,M){var ba=B.removeEventListener?"removeEventListener":"detachEvent";if(B[ba]&&!a9[ba]){a9[ba]=function(){}}G(a9).unbind(L,M)};K=function(a9,M,bb,bc){var ba=G.Event(M),L="detached"+M;Y(ba,bb);if(a9[M]){a9[L]=a9[M];a9[M]=null}G(a9).trigger(ba);if(a9[L]){a9[M]=a9[L];a9[L]=null}if(bc&&!ba.isDefaultPrevented()){bc(ba)}};an=function(a9,ba,M){var L=G(a9);L.stop();L.animate(ba,M)};aK=function(L){G(L).stop()};ae=function(L,M){G.get(L,null,M)};G.extend(G.easing,{easeOutQuad:function(M,a9,L,bb,ba){return -bb*(a9/=ba)*(a9-2)+L}});var aL=jQuery.fx.step._default,s=jQuery.fx.prototype.cur;G.fx.step._default=function(M){var L=M.elem;if(L.attr){L.attr(M.prop,M.now)}else{aL.apply(this,arguments)}};G.fx.prototype.cur=function(){var M=this.elem,L;if(M.attr){L=M.attr(this.prop)}else{L=s.apply(this,arguments)}return L}}else{if(!c&&ax.MooTools){a8=$each;t=function(L,M){return L.map(M)};m=function(L,M){return L.filter(M)};y=$merge;aY=function(L){return L.hyphenate()};aw=function(a9,M,L){if(typeof M=="string"){if(M=="unload"){M="beforeunload"}if(!a9.addEvent){if(a9.nodeName){a9=$(a9)}else{Y(a9,new Events())}}a9.addEvent(M,L)}};aq=function(a9,M,L){if(M){if(M=="unload"){M="beforeunload"}a9.removeEvent(M,L)}};K=function(L,a9,M,ba){a9=new Event({type:a9,target:L});a9=Y(a9,M);a9.preventDefault=function(){ba=null};if(L.fireEvent){L.fireEvent(a9.type,a9)}if(ba){ba(a9)}};an=function(ba,bb,a9){var L=ba.attr,M;if(L&&!ba.setStyle){ba.setStyle=ba.getStyle=ba.attr;ba.$family=ba.uid=true}aK(ba);M=new Fx.Morph(L?ba:$(ba),Y(a9,{transition:Fx.Transitions.Quad.easeInOut}));M.start(bb);ba.fx=M};aK=function(L){if(L.fx){L.fx.cancel()}};ae=function(L,M){(new Request({url:L,method:"get",onSuccess:M})).send()}}}function U(){var L=aD.global.useUTC;aW=L?Date.UTC:function(bb,bc,a9,M,ba,bd){return new Date(bb,bc,b(a9,1),b(M,0),b(ba,0),b(bd,0)).getTime()};D=L?"getUTCMinutes":"getMinutes";aI=L?"getUTCHours":"getHours";ak=L?"getUTCDay":"getDay";o=L?"getUTCDate":"getDate";aJ=L?"getUTCMonth":"getMonth";ag=L?"getUTCFullYear":"getFullYear";
S=L?"setUTCMinutes":"setMinutes";A=L?"setUTCHours":"setHours";aM=L?"setUTCDate":"setDate";C=L?"setUTCMonth":"setMonth";aV=L?"setUTCFullYear":"setFullYear"}function av(L){aD=y(aD,L);U();return aD}function aN(){return aD}function Q(L){if(!aS){aS=al(aj)}if(L){aS.appendChild(L)}aS.innerHTML=""}var aA={enabled:true,align:"center",x:0,y:15,style:{color:"#666",fontSize:"11px"}};aD={colors:["#4572A7","#AA4643","#89A54E","#80699B","#3D96AE","#DB843D","#92A8CD","#A47D7C","#B5CA92"],symbols:["circle","diamond","square","triangle","triangle-down"],lang:{loading:"Loading...",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],decimalPoint:".",resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",thousandsSep:","},global:{useUTC:true},chart:{margin:[50,50,90,80],borderColor:"#4572A7",borderRadius:5,defaultSeriesType:"line",ignoreHiddenSeries:true,style:{fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Verdana, Arial, Helvetica, sans-serif',fontSize:"12px"},backgroundColor:"#FFFFFF",plotBorderColor:"#C0C0C0"},title:{text:"Chart title",x:0,y:20,align:"center",style:{color:"#3E576F",fontSize:"16px"}},subtitle:{text:"",x:0,y:40,align:"center",style:{color:"#6D869F"}},plotOptions:{line:{allowPointSelect:false,showCheckbox:false,animation:true,events:{},lineWidth:2,shadow:true,marker:{enabled:true,lineWidth:0,radius:4,lineColor:"#FFFFFF",states:{hover:{},select:{fillColor:"#FFFFFF",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:y(aA,{enabled:false,y:-6,formatter:function(){return this.y}}),showInLegend:true,states:{hover:{lineWidth:3,marker:{}},select:{marker:{}}},stickyTracking:true}},labels:{style:{position:r,color:"#3E576F"}},legend:{enabled:true,align:"center",layout:"horizontal",labelFormatter:function(){return this.name},borderWidth:1,borderColor:"#909090",borderRadius:5,shadow:false,style:{padding:"5px"},itemStyle:{cursor:"pointer",color:"#3E576F"},itemHoverStyle:{cursor:"pointer",color:"#000000"},itemHiddenStyle:{color:"#C0C0C0"},itemCheckboxStyle:{position:r,width:"13px",height:"13px"},symbolWidth:16,symbolPadding:5,verticalAlign:"bottom",x:15,y:-15},loading:{hideDuration:100,labelStyle:{fontWeight:"bold",position:l,top:"1em"},showDuration:100,style:{position:r,backgroundColor:"white",opacity:0.5,textAlign:"center"}},tooltip:{enabled:true,formatter:function(){var ba=this,M=ba.series,a9=M.xAxis,L=ba.x;return"<b>"+(ba.point.name||M.name)+"</b><br/>"+(h(L)?"X value: "+(a9&&a9.options.type=="datetime"?at(null,L):L)+"<br/>":"")+"Y value: "+ba.y},backgroundColor:"rgba(255, 255, 255, .85)",borderWidth:2,borderRadius:5,shadow:true,snap:10,style:{color:"#333333",fontSize:"12px",padding:"5px",whiteSpace:"nowrap"}},toolbar:{itemStyle:{color:"#4572A7",cursor:"pointer"}},credits:{enabled:true,text:"Highcharts.com",href:"http://www.highcharts.com",style:{cursor:"pointer",color:"#909090",fontSize:"10px"}}};var ai={dateTimeLabelFormats:{second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%e. %b",week:"%e. %b",month:"%b '%y",year:"%Y"},endOnTick:false,gridLineColor:"#C0C0C0",labels:aA,lineColor:"#C0D0E0",lineWidth:1,max:null,min:null,minPadding:0.01,maxPadding:0.01,maxZoom:null,minorGridLineColor:"#E0E0E0",minorGridLineWidth:1,minorTickColor:"#A0A0A0",minorTickLength:2,minorTickPosition:"outside",minorTickWidth:1,showFirstLabel:true,showLastLabel:false,startOfWeek:1,startOnTick:false,tickColor:"#C0D0E0",tickLength:5,tickmarkPlacement:"between",tickPixelInterval:100,tickPosition:"outside",tickWidth:1,title:{align:"middle",margin:35,style:{color:"#6D869F",fontWeight:"bold"}},type:"linear"},aQ=y(ai,{endOnTick:true,gridLineWidth:1,tickPixelInterval:72,showLastLabel:true,labels:{align:"right",x:-8,y:3},lineWidth:0,maxPadding:0.05,minPadding:0.05,startOnTick:true,tickWidth:0,title:{margin:40,rotation:270,text:"Y-values"}}),ab={labels:{align:"right",x:-8,y:3},title:{rotation:270}},aP={labels:{align:"left",x:8,y:3},title:{rotation:90}},a4={labels:{align:"center",x:0,y:14},title:{rotation:0}},u=y(a4,{labels:{y:-5}});
var k=aD.plotOptions,n=k.line;k.spline=y(n);k.scatter=y(n,{lineWidth:0,states:{hover:{lineWidth:0}}});k.area=y(n,{});k.areaspline=y(k.area);k.column=y(n,{borderColor:"#FFFFFF",borderWidth:1,borderRadius:0,groupPadding:0.2,marker:null,pointPadding:0.1,minPointLength:0,states:{hover:{brightness:0.1,shadow:false},select:{color:"#C0C0C0",borderColor:"#000000",shadow:false}}});k.bar=y(k.column,{dataLabels:{align:"left",x:5,y:0}});k.pie=y(n,{borderColor:"#FFFFFF",borderWidth:1,center:["50%","50%"],colorByPoint:true,legendType:"point",marker:null,size:"90%",slicedOffset:10,states:{hover:{brightness:0.1,shadow:false}}});U();function J(M,L){var a9=function(){};a9.prototype=new M();Y(a9.prototype,L);return a9}var x=function(L){var ba=[],bc;function bd(be){if((bc=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/.exec(be))){ba=[parseInt(bc[1],10),parseInt(bc[2],10),parseInt(bc[3],10),parseFloat(bc[4],10)]}else{if((bc=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(be))){ba=[parseInt(bc[1],16),parseInt(bc[2],16),parseInt(bc[3],16),1]}}}function a9(bf){var be;if(ba&&!isNaN(ba[0])){if(bf=="rgb"){be="rgb("+ba[0]+","+ba[1]+","+ba[2]+")"}else{if(bf=="a"){be=ba[3]}else{be="rgba("+ba.join(",")+")"}}}else{be=L}return be}function bb(bf){if(typeof bf=="number"&&bf!==0){for(var be=0;be<3;be++){ba[be]+=parseInt(bf*255,10);if(ba[be]<0){ba[be]=0}if(ba[be]>255){ba[be]=255}}}return this}function M(be){ba[3]=be;return this}bd(L);return{get:a9,brighten:bb,setOpacity:M}};function g(bb,M,bg,bf){var L=aD.lang,a9=bb,be=isNaN(M=a6(M))?2:M,bd=bg===undefined?L.decimalPoint:bg,bh=bf===undefined?L.thousandsSep:bf,bi=a9<0?"-":"",bc=parseInt(a9=a6(+a9||0).toFixed(be),10)+"",ba=(ba=bc.length)>3?ba%3:0;return bi+(ba?bc.substr(0,ba)+bh:"")+bc.substr(ba).replace(/(\d{3})(?=\d)/g,"$1"+bh)+(be?bd+a6(a9-bc).toFixed(be).slice(2):"")}at=function(bk,bd,M){function ba(bm){return bm.toString().replace(/^([0-9])$/,"0$1")}if(!h(bd)||isNaN(bd)){return"Invalid date"}bk=b(bk,"%Y-%m-%d %H:%M:%S");var a9=new Date(bd*E),bg=a9[aI](),be=a9[ak](),bi=a9[o](),bc=a9[aJ](),bj=a9[ag](),L=aD.lang,bf=L.weekdays,bl=L.months,bb={a:bf[be].substr(0,3),A:bf[be],d:ba(bi),e:bi,b:bl[bc].substr(0,3),B:bl[bc],m:ba(bc+1),y:bj.toString().substr(2,2),Y:bj,H:ba(bg),I:ba((bg%12)||12),l:(bg%12)||12,M:ba(a9[D]()),p:bg<12?"AM":"PM",P:bg<12?"am":"pm",S:ba(a9.getSeconds())};for(var bh in bb){bk=bk.replace("%"+bh,bb[bh])}return M?bk.substr(0,1).toUpperCase()+bk.substr(1):bk};function aX(L){var M={x:L.offsetLeft,y:L.offsetTop};while(L.offsetParent){L=L.offsetParent;M.x+=L.offsetLeft;M.y+=L.offsetTop;if(L!=B.body&&L!=B.documentElement){M.x-=L.scrollLeft;M.y-=L.scrollTop}}return M}function e(){}e.prototype={init:function(L,M){this.element=B.createElementNS("http://www.w3.org/2000/svg",M);this.renderer=L},animate:function(L,M){an(this,L,M)},attr:function(be,ba){var bj,bi,bd,a9,bb=this.element,bh=bb.nodeName,M=this.renderer,bg,bc=this.shadows,L,bf=this;if(typeof be=="string"&&h(ba)){bj=be;be={};be[bj]=ba}if(typeof be=="string"){bj=be;if(bh=="circle"){bj={x:"cx",y:"cy"}[bj]||bj}else{if(bj=="strokeWidth"){bj="stroke-width"}}bf=parseFloat(V(bb,bj)||this[bj]||0)}else{for(bj in be){bi=be[bj];if(bj=="d"){if(bi&&bi.join){bi=bi.join(" ")}if(/(NaN|  |^$)/.test(bi)){bi="M 0 0"}}else{if(bj=="x"&&bh=="text"){for(bd=0;bd<bb.childNodes.length;bd++){a9=bb.childNodes[bd];if(V(a9,"x")==V(bb,"x")){V(a9,"x",bi)}}}else{if(bj=="fill"){bi=M.color(bi,bb,bj)}else{if(bh=="circle"){bj={x:"cx",y:"cy"}[bj]||bj}else{if(bj=="translateX"||bj=="translateY"){this[bj]=bi;this.updateTransform();bg=true}else{if(bj=="stroke"){bi=M.color(bi,bb,bj)}else{if(bj=="isTracker"){this[bj]=bi}}}}}}}if(bj=="strokeWidth"){bj="stroke-width"}if(W&&bj=="stroke-width"&&bi===0){bi=0.000001}if(this.symbolName&&/^(x|y|r|start|end|innerR)/.test(bj)){if(!L){this.symbolAttr(be);L=true}bg=true}if(bc&&/^(width|height|visibility|x|y|d)$/.test(bj)){bd=bc.length;while(bd--){V(bc[bd],bj,bi)}}if(bj=="text"){M.buildText(bb,bi)}else{if(!bg){V(bb,bj,bi)
}}}}return bf},symbolAttr:function(L){var M=this;M.x=b(L.x,M.x);M.y=parseFloat(b(L.y,M.y));M.r=b(L.r,M.r);M.start=b(L.start,M.start);M.end=b(L.end,M.end);M.width=b(L.width,M.width);M.height=parseFloat(b(L.height,M.height));M.innerR=b(L.innerR,M.innerR);M.attr({d:M.renderer.symbols[M.symbolName](M.x,M.y,M.r,{start:M.start,end:M.end,width:M.width,height:M.height,innerR:M.innerR})})},clip:function(L){return this.attr("clip-path","url("+this.renderer.url+"#"+L.id+")")},css:function(L){var M=this;if(L&&L.color){L.fill=L.color}L=Y(M.styles,L);M.attr({style:aZ(L)});M.styles=L;return M},on:function(L,M){this.element["on"+L]=M;return this},translate:function(L,a9){var M=this;M.translateX=L;M.translateY=a9;M.updateTransform();return M},invert:function(){var L=this;L.inverted=true;L.updateTransform();return L},updateTransform:function(){var bb=this,a9=bb.translateX||0,ba=bb.translateY||0,L=bb.inverted,M=[];if(L){a9+=bb.attr("width");ba+=bb.attr("height")}if(a9||ba){M.push("translate("+a9+","+ba+")")}if(L){M.push("rotate(90) scale(-1,1)")}if(M.length){V(bb.element,"transform",M.join(" "))}},toFront:function(){var L=this.element;L.parentNode.appendChild(L);return this},getBBox:function(){return this.element.getBBox()},show:function(){return this.attr({visibility:ah})},hide:function(){return this.attr({visibility:am})},add:function(bd){var L=this.renderer,bc=bd||L,M=bc.element||L.box,bf=M.childNodes,a9=this.element,bg=V(a9,"zIndex"),be,bb,ba;this.parentInverted=bd&&bd.inverted;if(bg){bc.handleZ=true;bg=parseInt(bg,10)}if(bc.handleZ){for(ba=0;ba<bf.length;ba++){be=bf[ba];bb=V(be,"zIndex");if(be!=a9&&(parseInt(bb,10)>bg||(!h(bg)&&h(bb)))){M.insertBefore(a9,be);return this}}}M.appendChild(a9);return this},destroy:function(){var bb=this,L=bb.element,a9=bb.shadows,ba=L.parentNode,M;L.onclick=L.onmouseout=L.onmouseover=L.onmousemove=null;aK(bb);if(ba){ba.removeChild(L)}if(a9){a8(a9,function(bc){ba=bc.parentNode;if(ba){ba.removeChild(bc)}})}for(M in bb){delete bb[M]}return null},empty:function(){var L=this.element,a9=L.childNodes,M=a9.length;while(M--){L.removeChild(a9[M])}},shadow:function(L){var bb=[],ba,bc,a9=this.element,M=this.parentInverted?"(-1,-1)":"(1,1)";if(L){for(ba=1;ba<=3;ba++){bc=a9.cloneNode(0);V(bc,{isShadow:"true",stroke:"rgb(0, 0, 0)","stroke-opacity":0.05*ba,"stroke-width":7-2*ba,transform:"translate"+M,fill:ad});a9.parentNode.insertBefore(bc,a9);bb.push(bc)}this.shadows=bb}return this}};var q=function(){this.init.apply(this,arguments)};q.prototype={init:function(a9,L,ba){var M=B.createElementNS("http://www.w3.org/2000/svg","svg"),bb=location;V(M,{width:L,height:ba,xmlns:"http://www.w3.org/2000/svg",version:"1.1"});a9.appendChild(M);this.Element=e;this.box=M;this.url=a2?"":bb.href.replace(/#.*?$/,"");this.defs=this.createElement("defs").add()},createElement:function(M){var L=new this.Element();L.init(this,M);return L},buildText:function(bd,bc){var M=bc.toString().replace(/<(b|strong)>/g,'<span style="font-weight:bold">').replace(/<(i|em)>/g,'<span style="font-style:italic">').replace(/<a/g,"<span").replace(/<\/(b|strong|i|em|a)>/g,"</span>").split(/<br[^>]?>/g),bb=bd.childNodes,L=/style="([^"]+)"/,ba=/href="([^"]+)"/,be=V(bd,"x"),a9=bb.length;while(a9--){bd.removeChild(bb[a9])}a8(M,function(bf,bi){var bh,bg=0;bf=bf.replace(/<span/g,"|||<span").replace(/<\/span>/g,"</span>|||");bh=bf.split("|||");a8(bh,function(bk){if(bk!==""||bh.length==1){var bj={},bl=B.createElementNS("http://www.w3.org/2000/svg","tspan");if(L.test(bk)){V(bl,"style",bk.match(L)[1].replace(/(;| |^)color([ :])/,"$1fill$2"))}if(ba.test(bk)){V(bl,"onclick",'location.href="'+bk.match(ba)[1]+'"');ar(bl,{cursor:"pointer"})}bk=bk.replace(/<(.|\n)*?>/g,"");bl.appendChild(B.createTextNode(bk||" "));if(!bg){bj.x=be}else{bj.dx=3}if(bi&&!bg){bj.dy=16}V(bl,bj);bd.appendChild(bl);bg++}})})},crispLine:function(L,M){if(L[1]==L[4]){L[1]=L[4]=w(L[1])+(M%2/2)}if(L[2]==L[5]){L[2]=L[5]=w(L[2])+(M%2/2)}return L},path:function(L){return this.createElement("path").attr({d:L,fill:ad})},circle:function(M,ba,a9){var L=typeof M=="object"?M:{x:M,y:ba,r:a9};
return this.createElement("circle").attr(L)},arc:function(L,bc,ba,a9,bb,M){if(typeof L=="object"){bc=L.y;ba=L.r;a9=L.innerR;bb=L.start;M=L.end;L=L.x}return this.symbol("arc",L||0,bc||0,ba||0,{innerR:a9||0,start:bb||0,end:M||0})},rect:function(M,be,ba,bc,bb,bd){if(arguments.length>1){var a9=(bd||0)%2/2;M=w(M||0)+a9;be=w(be||0)+a9;ba=w((ba||0)-2*a9);bc=w((bc||0)-2*a9)}var L=typeof M=="object"?M:{x:M,y:be,width:aH(ba,0),height:aH(bc,0)};return this.createElement("rect").attr(Y(L,{rx:bb||L.r,ry:bb||L.r,fill:ad}))},g:function(L){return this.createElement("g").attr(h(L)&&{"class":aT+L})},image:function(bb,L,bc,a9,ba){var M=this.createElement("image").attr({x:L,y:bc,width:a9,height:ba,preserveAspectRatio:ad});M.element.setAttributeNS("http://www.w3.org/1999/xlink","href",bb);return M},symbol:function(ba,be,bd,L,bc){var bb,M=this.symbols[ba],bg=M&&M(be,bd,L,bc),a9=/^url\((.*?)\)$/,bf;if(bg){bb=this.path(bg);Y(bb,{symbolName:ba,x:be,y:bd,r:L});if(bc){Y(bb,bc)}}else{if(a9.test(ba)){bf=ba.match(a9)[1];bb=this.image(bf).attr({visibility:am});al("img",{onload:function(){var bh=this,bi=ac[bh.src]||[bh.width,bh.height];bb.attr({x:w(be-bi[0]/2)+af,y:w(bd-bi[1]/2)+af,width:bi[0],height:bi[1],visibility:"inherit"})},src:bf})}else{bb=this.circle(be,bd,L)}}return bb},symbols:{square:function(M,ba,a9){var L=0.707*a9;return[ao,M-L,ba-L,ap,M+L,ba-L,M+L,ba+L,M-L,ba+L,"Z"]},triangle:function(L,a9,M){return[ao,L,a9-1.33*M,ap,L+M,a9+0.67*M,L-M,a9+0.67*M,"Z"]},"triangle-down":function(L,a9,M){return[ao,L,a9+1.33*M,ap,L-M,a9-0.67*M,L+M,a9-0.67*M,"Z"]},diamond:function(L,a9,M){return[ao,L,a9-M,ap,L+M,a9,L,a9+M,L-M,a9,"Z"]},arc:function(bi,bh,bb,bg){var be=Math.PI,a9=bg.start,bc=bg.end-0.000001,M=bg.innerR,ba=aO(a9),L=z(a9),bf=aO(bc),bj=z(bc),bd=bg.end-a9<be?0:1;return[ao,bi+bb*ba,bh+bb*L,"A",bb,bb,0,bd,1,bi+bb*bf,bh+bb*bj,ap,bi+M*bf,bh+M*bj,"A",M,M,0,bd,0,bi+M*ba,bh+M*L,"Z"]}},clipRect:function(L,bd,M,ba){var bc,bb=aT+H++,a9=this.createElement("clipPath").attr({id:bb}).add(this.defs);bc=this.rect(L,bd,M,ba,0).add(a9);bc.id=bb;return bc},color:function(bc,bb,a9){var bh,bg=/^rgba/;if(bc&&bc.linearGradient){var M=this,bd="linearGradient",bi=bc[bd],ba=aT+H++,L,bf,be;L=M.createElement(bd).attr({id:ba,gradientUnits:"userSpaceOnUse",x1:bi[0],y1:bi[1],x2:bi[2],y2:bi[3]}).add(M.defs);a8(bc.stops,function(bj){if(bg.test(bj[1])){bh=x(bj[1]);bf=bh.get("rgb");be=bh.get("a")}else{bf=bj[1];be=1}M.createElement("stop").attr({offset:bj[0],"stop-color":bf,"stop-opacity":be}).add(L)});return"url("+this.url+"#"+ba+")"}else{if(bg.test(bc)){bh=x(bc);V(bb,a9+"-opacity",bh.get("a"));return bh.get("rgb")}else{return bc}}},text:function(bc,be,bd,L,bf,a9){L=L||{};a9=a9||"left";bf=bf||0;var ba,M,bg=L.color||"#000000",bb=aD.chart.style;be=w(b(be,0));bd=w(b(bd,0));Y(L,{fontFamily:L.fontFamily||bb.fontFamily,fontSize:L.fontSize||bb.fontSize});M=aZ(L);ba={x:be,y:bd,text:bc,fill:bg,style:M.replace(/"/g,"'")};if(bf||a9!="left"){ba=Y(ba,{"text-anchor":{left:"start",center:"middle",right:"end"}[a9],transform:"rotate("+bf+" "+be+" "+bd+")"})}return this.createElement("text").attr(ba)}};var a5;if(!i){var O=J(e,{init:function(L,ba){var a9=["<",ba,' filled="f" stroked="f"'],M=["position: ",r,";"];if(ba=="shape"||ba==aj){M.push("left:0;top:0;width:10px;height:10px")}a9.push(' style="',M.join(""),'"/>');if(ba){a9=ba==aj||ba=="span"||ba=="img"?a9.join(""):L.prepVML(a9);this.element=al(a9)}this.renderer=L},add:function(a9){var be=this,L=be.renderer,ba=be.element,bc=L.box,M=a9&&a9.inverted,bb,bd=a9?a9.element||a9:bc;if(M){bb=bd.style;ar(ba,{flip:"x",left:parseInt(bb.width,10)-10,top:parseInt(bb.height,10)-10,rotation:-90})}bd.appendChild(ba);return be},attr:function(bh,bb){var bm,bl,bf,bc=this.element,bg=bc.style,bk=bc.nodeName,a9=this.renderer,be=this.symbolName,M,bd=this.shadows,ba=B.documentMode,bj,bi=this;if(typeof bh=="string"&&h(bb)){bm=bh;bh={};bh[bm]=bb}if(typeof bh=="string"){bm=bh;if(bm=="strokeWidth"||bm=="stroke-width"){bi=bc.strokeweight}else{bi=b(this[bm],parseInt(bg[{x:"left",y:"top"}[bm]||bm],10))
}}else{for(bm in bh){bl=bh[bm];bj=false;if(be&&/^(x|y|r|start|end|width|height|innerR)/.test(bm)){if(!M){this.symbolAttr(bh);M=true}bj=true}else{if(bm=="d"){bf=bl.length;var L=[];while(bf--){if(typeof bl[bf]=="number"){L[bf]=w(bl[bf]*10)-5}else{if(bl[bf]=="Z"){L[bf]="x"}else{L[bf]=bl[bf]}}}bl=L.join(" ")||"x";bc.path=bl;if(bd){bf=bd.length;while(bf--){bd[bf].path=bl}}bj=true}else{if(bm=="zIndex"||bm=="visibility"){bg[bm]=bl;if(ba==8&&bm=="visibility"&&bk=="DIV"){a8(bc.childNodes,function(bn){ar(bn,{visibility:bl})})}bj=true}else{if(/^(width|height)$/.test(bm)){bg[bm]=bl;if(this.updateClipping){this.updateClipping()}bj=true}else{if(/^(x|y)$/.test(bm)){if(bm=="y"&&bc.tagName=="SPAN"&&bc.lineHeight){bl-=bc.lineHeight}bg[{x:"left",y:"top"}[bm]]=bl}else{if(bm=="class"){bc.className=bl}else{if(bm=="stroke"){bl=a9.color(bl,bc,bm);bm="strokecolor"}else{if(bm=="stroke-width"||bm=="strokeWidth"){bc.stroked=bl?true:false;bm="strokeweight";if(typeof bl=="number"){bl+=af}}else{if(bm=="fill"){if(bk=="SPAN"){bg.color=bl}else{bc.filled=bl!=ad?true:false;bl=a9.color(bl,bc,bm);bm="fillcolor"}}else{if(bm=="translateX"||bm=="translateY"){this[bm]=bb;this.updateTransform();bj=true}}}}}}}}}}if(bd&&bm=="visibility"){bf=bd.length;while(bf--){bd[bf].style[bm]=bl}}if(bm=="text"){bc.innerHTML=bl}else{if(!bj){if(ba==8){bc[bm]=bl}else{V(bc,bm,bl)}}}}}return bi},clip:function(a9){var ba=this,L=a9.members,M=L.length;L.push(ba);ba.destroyClip=function(){L.splice(M,1)};return ba.css(a9.getCSS(ba.inverted))},css:function(L){var M=this;ar(M.element,L);return M},destroy:function(){var L=this;if(L.destroyClip){L.destroyClip()}e.prototype.destroy.apply(this)},empty:function(){var L=this.element,ba=L.childNodes,M=ba.length,a9;while(M--){a9=ba[M];a9.parentNode.removeChild(a9)}},getBBox:function(){var M=this.element,L,ba=M.offsetWidth,a9=M.parentNode;if(!ba){B.body.appendChild(M)}L={x:M.offsetLeft,y:M.offsetTop,width:M.offsetWidth,height:M.offsetHeight};if(!ba){if(a9){a9.appendChild(M)}else{B.body.removeChild(M)}}return L},on:function(L,M){this.element["on"+L]=function(){var a9=ax.event;a9.target=a9.srcElement;M(a9)};return this},updateTransform:function(){var a9=this,L=a9.translateX||0,M=a9.translateY||0;if(L||M){a9.css({left:L,top:M})}},shadow:function(bd){var a9=[],ba,M=this.element,L=this.renderer,be,bb=M.style,bc,bf=M.path;if(""+M.path==""){bf="x"}if(bd){for(ba=1;ba<=3;ba++){bc=['<shape isShadow="true" strokeweight="',(7-2*ba),'" filled="false" path="',bf,'" coordsize="100,100" style="',M.style.cssText,'" />'];be=al(L.prepVML(bc),null,{left:parseInt(bb.left,10)+1,top:parseInt(bb.top,10)+1});bc=['<stroke color="black" opacity="',(0.05*ba),'"/>'];al(L.prepVML(bc),null,null,be);M.parentNode.insertBefore(be,M);a9.push(be)}this.shadows=a9}return this}});a5=function(){this.init.apply(this,arguments)};a5.prototype=y(q.prototype,{isIE8:d.indexOf("MSIE 8.0")>-1,init:function(M,L,a9){this.width=L;this.height=a9;this.box=al(aj,null,{width:L+af,height:a9+af},M);this.Element=O;if(!B.namespaces.hcv){B.namespaces.add("hcv","urn:schemas-microsoft-com:vml");B.createStyleSheet().cssText="hcv\\:fill, hcv\\:path, hcv\\:textpath, hcv\\:shape, hcv\\:stroke, hcv\\:line { behavior:url(#default#VML); display: inline-block; } "}},clipRect:function(L,bb,a9,ba){var M=this.createElement();return Y(M,{members:[],element:{style:{left:L,top:bb,width:a9,height:ba}},getCSS:function(bc){var bg=M.element.style,bi=bg.top,bh=bg.left,be=bh+bg.width,bf=bi+bg.height,bd={clip:"rect("+(bc?bh:bi)+"px,"+(bc?bf:be)+"px,"+(bc?be:bf)+"px,"+(bc?bi:bh)+"px)"};if(!bc&&B.documentMode==8){Y(bd,{width:be+af,height:bf+af})}return bd},updateClipping:function(){a8(M.members,function(bc){bc.css(M.getCSS(bc.inverted))})}})},color:function(bc,ba,L){var bk,be=/^rgba/,bg;if(bc&&bc.linearGradient){var bd,bf,bj=bc.linearGradient,bb,bh,M,bi,a9;a8(bc.stops,function(bm,bl){if(be.test(bm[1])){bk=x(bm[1]);bd=bk.get("rgb");bf=bk.get("a")}else{bd=bm[1];bf=1}if(!bl){bh=bd;M=bf}else{bi=bd;a9=bf}});bb=90-R.atan((bj[3]-bj[1])/(bj[2]-bj[0]))*180/R.PI;
bg=["<",L,' colors="0% ',bh,",100% ",bi,'" angle="',bb,'" opacity="',a9,'" o:opacity2="',M,'" type="gradient" focus="100%" />'];al(this.prepVML(bg),null,null,ba)}else{if(be.test(bc)){bk=x(bc);bg=["<",L,' opacity="',bk.get("a"),'"/>'];al(this.prepVML(bg),null,null,ba);return bk.get("rgb")}else{return bc}}},prepVML:function(ba){var M="display:inline-block;behavior:url(#default#VML);",bc=this.isIE8;try{ba=ba.join("")}catch(bb){var a9="",L=0;for(L;L<ba.length;L++){a9+=ba[L]}ba=a9}if(bc){ba=ba.replace("/>",' xmlns="urn:schemas-microsoft-com:vml" />');if(ba.indexOf('style="')==-1){ba=ba.replace("/>",' style="'+M+'" />')}else{ba=ba.replace('style="','style="'+M)}}else{ba=ba.replace("<","<hcv:")}return ba},text:function(bk,bf,bd,bn,bq,bl){bn=bn||{};bl=bl||"left";bq=bq||0;var bh,bp,bj,bc=w(parseInt(bn.fontSize||12,10)*1.2),be=aD.chart.style;bf=w(bf);bd=w(bd);Y(bn,{color:bn.color||"#000000",whiteSpace:"nowrap",fontFamily:bn.fontFamily||be.fontFamily,fontSize:bn.fontSize||be.fontSize});if(!bq){bh=this.createElement("span").attr({x:bf,y:bd-bc,text:bk});bp=bh.element;bp.lineHeight=bc;ar(bp,bn);if(bl!="left"){bj=bh.getBBox().width;ar(bp,{left:(bf-bj/{right:1,center:2}[bl])+af})}}else{var bs=(bq||0)*R.PI*2/360,ba=aO(bs),bg=z(bs),bb=10,bi=bc*0.3,a9=bl=="left",br=bl=="right",bo=a9?bf:bf-bb*ba,bm=br?bf:bf+bb*ba,M=a9?bd:bd-bb*bg,L=br?bd:bd+bb*bg;bo+=bi*bg;bm+=bi*bg;M-=bi*ba;L-=bi*ba;if(a6(bo-bm)<0.1){bo+=0.1}if(a6(M-L)<0.1){M+=0.1}bh=this.createElement("line").attr({from:bo+", "+M,to:bm+", "+L});bp=bh.element;al("hcv:fill",{on:true,color:bn.color},null,bp);al("hcv:path",{textpathok:true},null,bp);al('<hcv:textpath style="v-text-align:'+bl+";"+aZ(bn).replace(/"/g,"'")+'" on="true" string="'+bk.toString().replace(/<br[^>]?>/g,"\n")+'">',null,null,bp)}return bh},path:function(L){return this.createElement("shape").attr({coordsize:"100 100",d:L})},circle:function(L,a9,M){return this.path(this.symbols.circle(L,a9,M))},g:function(L){var a9,M;if(L){M={className:aT+L,"class":aT+L}}a9=this.createElement(aj).attr(M);return a9},image:function(ba,L,bb,M,a9){return this.createElement("img").attr({src:ba}).css({left:L,top:bb,width:M,height:a9})},rect:function(L,bd,a9,bb,ba,bc){if(arguments.length>1){var M=(bc||0)%2/2;L=w(L||0)+M;bd=w(bd||0)+M;a9=w((a9||0)-2*M);bb=w((bb||0)-2*M)}if(typeof L=="object"){bd=L.y;a9=L.width;bb=L.height;ba=L.r;L=L.x}return this.symbol("rect",L||0,bd||0,ba||0,{width:a9||0,height:bb||0})},symbol:function(M,L,bc,ba){var bb,a9=/^url\((.*?)\)$/;if(a9.test(M)){bb=this.createElement("img").attr({onload:function(){var bd=this,be=[bd.width,bd.height];ar(bd,{left:w(L-be[0]/2),top:w(bc-be[1]/2)})},src:M.match(a9)[1]})}else{bb=q.prototype.symbol.apply(this,arguments)}return bb},symbols:{arc:function(bh,bg,bc,bf){var ba=bf.start,a9=bf.end,bd=a9-ba==2*Math.PI?a9-0.001:a9,bb=aO(ba),M=z(ba),be=aO(bd),bi=z(bd),L=bf.innerR;if(a9-ba===0){return["x"]}return["wa",bh-bc,bg-bc,bh+bc,bg+bc,bh+bc*bb,bg+bc*M,bh+bc*be,bg+bc*bi,"at",bh-L,bg-L,bh+L,bg+L,bh+L*be,bg+L*bi,bh+L*bb,bg+L*M,"x","e"]},circle:function(L,a9,M){return["wa",L-M,a9-M,L+M,a9+M,L+M,a9,L+M,a9,"e"]},rect:function(be,bd,bb,M){var ba=M.width,bc=M.height,L=be+ba,a9=bd+bc;bb=X(bb,ba,bc);return[ao,be+bb,bd,ap,L-bb,bd,"wa",L-2*bb,bd,L,bd+2*bb,L-bb,bd,L,bd+bb,ap,L,a9-bb,"wa",L-2*bb,a9-2*bb,L,a9,L,a9-bb,L-bb,a9,ap,be+bb,a9,"wa",be,a9-2*bb,be+2*bb,a9,be+bb,a9,be,a9-bb,ap,be,bd+bb,"wa",be,bd,be+2*bb,bd+2*bb,be,bd+bb,be+bb,bd,"x","e"]}}})}var T=i?q:a5;function a3(bA,bk){ai=y(ai,aD.xAxis);aQ=y(aQ,aD.yAxis);aD.xAxis=aD.yAxis=null;bA=y(aD,bA);var by=bA.chart,bB=by.margin,bT=typeof bB=="number"?[bB,bB,bB,bB]:bB,bX=b(by.marginTop,bT[0]),b6=b(by.marginRight,bT[1]),bu=b(by.marginBottom,bT[2]),bx=b(by.marginLeft,bT[3]),bK,bf,bq,b5,bw,a9,b4=this,bG=by.events,bz,bb,b3,br,L,b1,bg,bh,ba,bJ,bI,bp,bP,bi,bQ,M=by.showAxes,bR=[],bj,bS=[],bc,bo,be,bt,bZ,bC;function bs(c2,cH){var cX=cH.isX,cz=cH.opposite,cq=bc?!cX:cX,ce={bar:{},column:{},area:{},areaspline:{},line:{}};cH=y(cX?ai:aQ,cq?(cz?u:a4):(cz?aP:ab),cH);var cA=this,cr=cH.type=="datetime",cl=cH.offset||0,c4=cX?"x":"y",co=cq?ba:bh,cv,cw=cq?bx:bu,cI,cY,b7,cL,cf,c1,cB,cD=null,c3=null,ci=cH.minPadding,ch=cH.maxPadding,cm=h(cH.linkedTo),cN,c6,cO,cE=cH.events,cs,cG=cH.plotBands||[],cT=cH.plotLines||[],b9,cj,cn,c5,cy,cU,cP=cH.labels.formatter||function(){var c7=this.value;
return cU?at(cU,c7):c7},cC=cH.categories||(cX&&c2.columnCount),cb=cH.reversed,cQ=(cC&&cH.tickmarkPlacement=="between")?0.5:0;function cd(){var c7=[],c8;b7=cL=null;cf=[];a8(bS,function(db){c8=false;a8(["xAxis","yAxis"],function(dc){if(db.isCartesian&&(dc=="xAxis"&&cX||dc=="yAxis"&&!cX)&&((db.options[dc]==cH.index)||(db.options[dc]===au&&cH.index===0))){db[dc]=cA;cf.push(db);c8=true}});if(!db.visible&&by.ignoreHiddenSeries){c8=false}if(c8){var da,c9;if(!cX){da=db.options.stacking;cO=da=="percent";if(da){c9=c7[db.type]||[];c7[db.type]=c9}if(cO){b7=0;cL=99}}if(db.isCartesian){a8(db.data,function(dc,dd){var df=dc.x,dg=dc.y;if(b7===null){b7=cL=dc[c4]}if(cX){if(df>cL){cL=df}else{if(df<b7){b7=df}}}else{if(h(dg)){if(da){c9[df]=c9[df]?c9[df]+dg:dg}var de=c9?c9[df]:dg;if(!cO){if(de>cL){cL=de}else{if(de<b7){b7=de}}}if(da){ce[db.type][df]={total:de,cum:de}}}}});if(/(area|column|bar)/.test(db.type)&&!cX){if(b7>=0){b7=0;cN=true}else{if(cL<0){cL=0;c6=true}}}}}})}function ca(dc,c9,c8){var c7=1,db=0,da;if(c8){c7*=-1;db=co}if(cb){c7*=-1;db-=c7*co}if(c3===au){da=null}else{if(c9){if(cb){dc=co-dc}da=dc/cv+c3}else{da=c7*(dc-c3)*cv+db}}return da}function cR(de,db,c9){if(c9){var c8,dd,c7,dc,da=ca(de),df;c8=c7=da+cw;dd=dc=a9-da-cw;if(cq){dd=bX;dc=a9-bu;if(c8<bx||c8>bx+ba){df=true}}else{c8=bx;c7=bw-b6;if(dd<bX||dd>bX+bh){df=true}}if(!df){bo.path(bo.crispLine([ao,c8,dd,ap,c7,dc],c9)).attr({stroke:db,"stroke-width":c9}).add(cY)}}}function cF(da,c9,c7){da=aH(da,c3);c9=X(c9,cD);var c8=(c9-da)*cv;cR(da+(c9-da)/2,c7,c8)}function cM(di,dc,dd,da,de,c7,df){var c9,dj,c8,dh,dg,db=cH.labels;if(dc=="inside"){de=-de}if(cz){de=-de}c9=c8=ca(di+cQ)+cw;dj=dh=a9-ca(di+cQ)-cw;if(cq){dj=a9-bu-(cz?bh:0)+cl;dh=dj+de}else{c9=bx+(cz?ba:0)+cl;c8=c9-de}if(da){bo.path(bo.crispLine([ao,c9,dj,ap,c8,dh],da)).attr({stroke:dd,"stroke-width":da}).add(cI)}if(c7&&db.enabled){dg=cP.call({index:df,isFirst:di==c5[0],isLast:di==c5[c5.length-1],dateTimeLabelFormat:cU,value:(cC&&cC[di]?cC[di]:di)});if(dg||dg===0){c9=c9+db.x-(cQ&&cq?cQ*cv*(cb?-1:1):0);dj=dj+db.y-(cQ&&!cq?cQ*cv*(cb?1:-1):0);bo.text(dg,c9,dj,db.style,db.rotation,db.align).add(cI)}}}function cg(c7,c9){var da;cn=c9?1:R.pow(10,N(R.log(c7)/R.LN10));da=c7/cn;if(!c9){c9=[1,2,2.5,5,10];if(cH.allowDecimals===false){if(cn==1){c9=[1,2,5,10]}else{if(cn<=0.1){c9=[1/cn]}}}}for(var c8=0;c8<c9.length;c8++){c7=c9[c8];if(da<=(c9[c8]+(c9[c8+1]||c9[c8]))/2){break}}c7*=cn;return c7}function cc(){c5=[];var dj,dr=aD.global.useUTC,de=1000/E,db=60000/E,dc=3600000/E,dp=24*3600000/E,dq=7*24*3600000/E,dm=30*24*3600000/E,c7=31556952000/E,df=[["second",de,[1,2,5,10,15,30]],["minute",db,[1,2,5,10,15,30]],["hour",dc,[1,2,3,4,6,8,12]],["day",dp,[1,2]],["week",dq,[1,2]],["month",dm,[1,2,3,4,6]],["year",c7,null]],dd=df[6],dl=dd[1],c8=dd[2];for(dj=0;dj<df.length;dj++){dd=df[dj];dl=dd[1];c8=dd[2];if(df[dj+1]){var di=(dl*c8[c8.length-1]+df[dj+1][1])/2;if(b9<=di){break}}}if(dl==c7&&b9<5*dl){c8=[1,2,5]}var dh=cg(b9/dl,c8),dn,da=new Date(c3*E);da.setMilliseconds(0);if(dl>=de){da.setSeconds(dl>=db?0:dh*N(da.getSeconds()/dh))}if(dl>=db){da[S](dl>=dc?0:dh*N(da[D]()/dh))}if(dl>=dc){da[A](dl>=dp?0:dh*N(da[aI]()/dh))}if(dl>=dp){da[aM](dl>=dm?1:dh*N(da[o]()/dh))}if(dl>=dm){da[C](dl>=c7?0:dh*N(da[aJ]()/dh));dn=da[ag]()}if(dl>=c7){dn-=dn%dh;da[aV](dn)}if(dl==dq){da[aM](da[o]()-da[ak]()+cH.startOfWeek)}dj=1;dn=da[ag]();var c9=da.getTime()/E,dg=da[aJ](),dk=da[o]();while(c9<cD&&dj<ba){c5.push(c9);if(dl==c7){c9=aW(dn+dj*dh,0)/E}else{if(dl==dm){c9=aW(dn,dg+dj*dh)/E}else{if(!dr&&(dl==dp||dl==dq)){c9=aW(dn,dg,dk+dj*dh*(dl==dp?1:7))}else{c9+=dl*dh}}}dj++}c5.push(c9);cU=cH.dateTimeLabelFormats[dd[0]]}function cu(c8){var c7=(cn<1?w(1/cn):1)*10;return w(c8*c7)/c7}function cV(){var c9,c7=N(c3/b9)*b9,c8=a7(cD/b9)*b9;c5=[];c9=cu(c7);while(c9<=c8){c5.push(c9);c9=cu(c9+b9)}if(cC){c3-=0.5;cD+=0.5}}function cx(){if(cr){cc()}else{cV()}var c7=c5[0],c8=c5[c5.length-1];if(cH.startOnTick){c3=c7}else{if(c3>c7){c5.shift()}}if(cH.endOnTick){cD=c8}else{if(cD<c8){c5.pop()}}}function cZ(){if(!cr&&!cC){var c7=cy,c8=c5.length;
cy=bj[c4];if(c8<cy){while(c5.length<cy){c5.push(cu(c5[c5.length-1]+b9))}cv*=(c8-1)/(cy-1)}if(h(c7)&&cy!=c7){cA.isDirty=true}}}function cK(){var c9,dc,c8,dd=c3,c7=cD,de=cH.maxZoom,df;cd();c3=b(c1,cH.min,b7);cD=b(cB,cH.max,cL);if(cm){var da=c2[cX?"xAxis":"yAxis"][cH.linkedTo],db=da.getExtremes();c3=b(db.min,db.dataMin);cD=b(db.max,db.dataMax)}if(cD-c3<de){df=(de-cD+c3)/2;c3=aH(c3-df,b(cH.min,c3-df));cD=X(c3+de,b(cH.max,c3+de))}if(!cC&&!cO&&!cm&&h(c3)&&h(cD)){c9=(cD-c3)||1;if(!h(cH.min)&&!h(c1)&&ci&&(b7<0||!cN)){c3-=c9*ci}if(!h(cH.max)&&!h(cB)&&ch&&(cL>0||!c6)){cD+=c9*ch}}if(cC||c3==cD){b9=1}else{b9=b(cH.tickInterval,(cD-c3)*cH.tickPixelInterval/co)}if(!cr&&!h(cH.tickInterval)){b9=cg(b9)}cj=cH.minorTickInterval==="auto"&&b9?b9/5:cH.minorTickInterval;cx();cv=co/((cD-c3)||1);if(!bj){bj={x:0,y:0}}if(!cr&&c5.length>bj[c4]){bj[c4]=c5.length}if(!cX){for(dc in ce){for(c8 in ce[dc]){ce[dc][c8].cum=ce[dc][c8].total}}}if(!cA.isDirty){cA.isDirty=(c3!=dd||cD!=c7)}}function cS(c9,c7,c8){c8=b(c8,true);K(cA,"setExtremes",{min:c9,max:c7},function(){if(cC){if(c9<0){c9=0}if(c7>cC.length-1){c7=cC.length-1}}c1=c9;cB=c7;if(c8){c2.redraw()}})}function ct(){return{min:c3,max:cD,dataMin:b7,dataMax:cL}}function c0(c7){if(c3>c7){c7=c3}else{if(cD<c7){c7=cD}}return ca(c7,0,1)}function ck(c8){var c7=c8.width,c9=c7?cT:cG;c9.push(c8);if(c7){cR(c8.value,c8.color,c8.width)}else{cF(c8.from,c8.to,c8.color)}}function cp(){var dh=cH.title,c8=cH.alternateGridColor,da=cH.minorTickWidth,c9=cH.lineWidth,c7,dg,de,di=cf.length&&h(c3)&&h(cD);if(!cI){cI=bo.g("axis").attr({zIndex:7}).add();cY=bo.g("grid").attr({zIndex:1}).add()}else{cI.empty();cY.empty()}if(di||cm){if(c8){a8(c5,function(dk,dj){if(dj%2===0&&dk<cD){cF(dk,c5[dj+1]!==au?c5[dj+1]:cD,c8)}})}a8(cG,function(dj){cF(dj.from,dj.to,dj.color)});if(cj&&!cC){for(var dd=c3;dd<=cD;dd+=cj){cR(dd,cH.minorGridLineColor,cH.minorGridLineWidth);if(da){cM(dd,cH.minorTickPosition,cH.minorTickColor,da,cH.minorTickLength)}}}a8(c5,function(dk,dj){de=dk+cQ;cR(de,cH.gridLineColor,cH.gridLineWidth);cM(dk,cH.tickPosition,cH.tickColor,cH.tickWidth,cH.tickLength,!((dk==c3&&!cH.showFirstLabel)||(dk==cD&&!cH.showLastLabel)),dj)});a8(cT,function(dj){cR(dj.value,dj.color,dj.width)})}if(!cA.hasRenderedLine&&c9){c7=bx+(cz?ba:0)+cl;dg=a9-bu-(cz?bh:0)+cl;bo.path(bo.crispLine([ao,cq?bx:c7,cq?dg:bX,ap,cq?bw-b6:c7,cq?dg:a9-bu],c9)).attr({stroke:cH.lineColor,"stroke-width":c9,zIndex:7}).add();cA.hasRenderedLine=true}if(!cA.hasRenderedTitle&&!cA.axisTitle&&dh&&dh.text){var db=cq?bx:bX;var df={low:db+(cq?0:co),middle:db+co/2,high:db+(cq?co:0)}[dh.align];var dc=(cq?bX+bh:bx)+(cq?1:-1)*(cz?-1:1)*dh.margin-(a2?parseInt(dh.style.fontSize||12,10)/3:0);cA.axisTitle=bo.text(dh.text,(cq?df:dc+(cz?ba:0)+cl)+(dh.x||0),(cq?dc-(cz?bh:0)+cl:df)+(dh.y||0),dh.style,dh.rotation||0,{low:"left",middle:"center",high:"right"}[dh.align]).attr({zIndex:7}).add();cA.hasRenderedTitle=true}cA.isDirty=false}function b8(c7){a8([cG,cT],function(c9){for(var c8=0;c8<c9.length;c8++){if(c9[c8].id==c7){c9.splice(c8,1);break}}});cp()}function cW(){if(bp.resetTracker){bp.resetTracker()}cp();a8(cf,function(c7){c7.isDirty=true})}function cJ(c7,c8){cA.categories=cC=c7;a8(cf,function(c9){c9.translate();c9.setTooltipPoints(true)});cA.isDirty=true;if(b(c8,true)){cW()}}if(bc&&cX&&cb===au){cb=true}if(!cz){cl*=-1}if(cq){cl*=-1}Y(cA,{addPlotBand:ck,addPlotLine:ck,adjustTickAmount:cZ,categories:cC,getExtremes:ct,getThreshold:c0,isXAxis:cX,options:cH,render:cp,setExtremes:cS,setScale:cK,setCategories:cJ,translate:ca,redraw:cW,removePlotBand:b8,removePlotLine:b8,reversed:cb,stacks:ce});for(cs in cE){aw(cA,cs,cE[cs])}cK()}function bm(b7){var b8={};function ca(cf,ce,cd,cc){if(!b8[cf]){var cb=bo.text(ce,bx+ba-20,bX+30,bA.toolbar.itemStyle,0,"right").on("click",cc).attr({zIndex:20}).add();b8[cf]=cb}}function b9(cb){Q(b8[cb].element);b8[cb]=null}return{add:ca,remove:b9}}function bE(cj){var ci,b7=cj.borderWidth,b8=cj.style,cm=parseInt(b8.padding,10),cn=b7+cm,cd=true,cc,ch,ca=0,b9=0;b8.padding=0;var cl=bo.g("tooltip").attr({zIndex:8}).add(),ce=bo.rect(cn,cn,0,0,cj.borderRadius,b7).attr({fill:cj.backgroundColor,"stroke-width":b7}).add(cl).shadow(cj.shadow),ck=bo.text("",cm+cn,parseInt(b8.fontSize,10)+cm+cn).attr({zIndex:1}).css(b8).add(cl);
function cb(co,cp){ca=cd?co:(2*ca+co)/3;b9=cd?cp:(b9+cp)/2;cl.translate(ca,b9);if(a6(co-ca)>1||a6(cp-b9)>1){be=function(){cb(co,cp)}}else{be=null}}function cf(){cd=true;cl.hide()}function cg(ct){var cp=ct.series,co=cj.borderColor||ct.color||cp.color||"#606060",cs,cr,cy,cx,cu,cw,cv=ct.tooltipText,cq=ct.tooltipPos;ci=cp;cs=w(cq?cq[0]:(bc?ba-ct.plotY:ct.plotX));cr=w(cq?cq[1]:(bc?bh-ct.plotX:ct.plotY));cu=b3(cs,cr);if(cv===false||!cu){cf()}else{if(cd){cl.show();cd=false}ck.attr({text:cv});cw=ck.getBBox();cc=cw.width;ch=cw.height;ce.attr({width:cc+2*cm,height:ch+2*cm,stroke:co});cy=cs-cc+bx-25;cx=cr-ch+bX+10;if(cy<7){cy=7;cx-=20}if(cx<5){cx=5}else{if(cx+ch>a9){cx=a9-ch-5}}cb(w(cy-cn),w(cx-cn))}}return{refresh:cg,hide:cf}}function bO(cj,ce){var cm,cl,cn,ch,ci=by.zoomType,cg=/x/.test(ci),cf=/y/.test(ci),co=cg&&!bc||cf&&bc,b7=cf&&!bc||cg&&bc;function ca(cp){cp=cp||ax.event;if(!cp.target){cp.target=cp.srcElement}if(cp.type!="mousemove"||ax.opera){bQ=aX(bq)}if(a2){cp.chartX=cp.x;cp.chartY=cp.y}else{if(cp.layerX===au){cp.chartX=cp.pageX-bQ.x;cp.chartY=cp.pageY-bQ.y}else{cp.chartX=cp.layerX;cp.chartY=cp.layerY}}return cp}function cb(cp){var cq={xAxis:[],yAxis:[]};a8(bR,function(cs,cr){var cv=cs.translate,cu=cs.isXAxis,ct=bc?!cu:cu;cq[cu?"xAxis":"yAxis"].push({axis:cs,value:cv(ct?cp.chartX-bx:bh-cp.chartY+bX,true)})});return cq}function cc(cs){var cp,cq=cj.hoverPoint,cr=cj.hoverSeries;if(cr&&cr.tracker){cp=cr.tooltipPoints[bc?cs.chartY:cs.chartX-bx];if(cp&&cp!=cq){cp.onMouseOver()}}}function b8(){var cq=cj.hoverSeries,cp=cj.hoverPoint;if(cp){cp.onMouseOut()}if(cq){cq.onMouseOut()}if(br){br.hide()}}function cd(){if(ch){var cr={xAxis:[],yAxis:[]},cq=ch.getBBox(),cs=cq.x-bx,cp=cq.y-bX;if(cn){a8(bR,function(cv,cu){var cz=cv.translate,cy=cv.isXAxis,cx=bc?!cy:cy,cw=cz(cx?cs:bh-cp-cq.height,true),ct=cz(cx?cs+cq.width:bh-cp,true);cr[cy?"xAxis":"yAxis"].push({axis:cv,min:X(cw,ct),max:aH(cw,ct)})});K(cj,"selection",cr,bZ)}ch=ch.destroy()}cj.mouseIsDown=L=cn=false}function b9(){var cp=true;bq.onmousedown=function(cq){cq=ca(cq);if(cq.preventDefault){cq.preventDefault()}cj.mouseIsDown=L=true;cm=cq.chartX;cl=cq.chartY;if(M&&(cg||cf)){if(!ch){ch=bo.rect(bx,bX,co?1:ba,b7?1:bh,0).attr({fill:"rgba(69,114,167,0.25)",zIndex:7}).add()}}};bq.onmousemove=function(cv){cv=ca(cv);cv.returnValue=false;var ct=cv.chartX,cu=cv.chartY,cr=!b3(ct-bx,cu-bX);if(L){cn=Math.sqrt(Math.pow(cm-ct,2)+Math.pow(cl-cu,2))>10;if(co){var cs=ct-cm;ch.attr({width:a6(cs),x:(cs>0?0:cs)+cm})}if(b7){var cq=cu-cl;ch.attr({height:a6(cq),y:(cq>0?0:cq)+cl})}}else{if(!cr){cc(cv)}}if(cr&&!cp){b8();cd()}cp=cr;return false};bq.onmouseup=function(cq){cd()};bq.onclick=function(ct){var cr=cj.hoverPoint;ct=ca(ct);ct.cancelBubble=true;if(!cn){if(cr&&V(ct.target,"isTracker")){var cs=cr.plotX,cq=cr.plotY;Y(cr,{pageX:bQ.x+bx+(bc?ba-cq:cs),pageY:bQ.y+bX+(bc?bh-cs:cq)});K(cj.hoverSeries||cr.series,"click",Y(ct,{point:cr}));cr.firePointEvent("click",ct)}else{Y(ct,cb(ct));if(b3(ct.chartX-bx,ct.chartY-bX)){K(cj,"click",ct)}}}cn=false}}function ck(){cj.trackerGroup=bP=bo.g("tracker");if(bc){bP.attr({width:cj.plotWidth,height:cj.plotHeight}).invert()}bP.attr({zIndex:9}).translate(bx,bX).add()}ck();if(ce.enabled){cj.tooltip=br=bE(ce)}b9();bt=setInterval(function(){if(be){be()}},32);Y(this,{zoomX:cg,zoomY:cf,resetTracker:b8})}var bM=function(ct){var cj=ct.options.legend;if(!cj.enabled){return}var cB=cj.layout=="horizontal",cw=cj.symbolWidth,b7=cj.symbolPadding,cs=[],cy=cj.style,ci=cj.itemStyle,ce=cj.itemHoverStyle,ck=cj.itemHiddenStyle,cD=parseInt(cy.padding,10),cC=20,cl=cj.lineHeight||16,cm=18,cA=4+cD+cw+b7,cc,ca,cu,cn,cq=cj.borderWidth,cb=cj.backgroundColor,cg,cv,cp=cj.width,b9,ch,b8=ct.series,cz=cj.reversed;function cr(cJ,cL){var cI=cJ.legendItem,cE=cJ.legendLine,cK=cJ.legendSymbol,cG=ck.color,cF=cL?cj.itemStyle.color:cG,cH=cL?cJ.color:cG;if(cI){cI.css({color:cF})}if(cE){cE.attr({stroke:cH})}if(cK){cK.attr({stroke:cH,fill:cH})}}function cx(cH,cJ,cG){var cF=cH.legendItem,cE=cH.legendLine,cK=cH.legendSymbol,cI=cH.checkbox;
if(cF){cF.attr({x:cJ,y:cG})}if(cE){cE.translate(cJ,cG-4)}if(cK){cK.translate(cJ,cG)}if(cI){cI.x=cJ;cI.y=cG}}function cf(cF){var cE=cs.length,cG=cF.checkbox;while(cE--){if(cs[cE]==cF){cs.splice(cE,1);break}}a8(["legendItem","legendLine","legendSymbol"],function(cH){if(cF[cH]){cF[cH].destroy()}});if(cG){Q(cF.checkbox)}}function co(cH){var cG,cI,cJ,cK,cE=cH.legendItem,cF=cH.series||cH;if(!cE){cK=/^(bar|pie|area|column)$/.test(cF.type);cH.legendItem=cE=bo.text(cj.labelFormatter.call(cH),0,0).css(cH.visible?ci:ck).on("mouseover",function(){cH.setState(aF);cE.css(ce)}).on("mouseout",function(){cE.css(cH.visible?ci:ck);cH.setState()}).on("click",function(cM){var cN="legendItemClick",cL=function(){cH.setVisible()};if(cH.firePointEvent){cH.firePointEvent(cN,null,cL)}else{K(cH,cN,null,cL)}}).attr({zIndex:2}).add(cg);if(!cK&&cH.options&&cH.options.lineWidth){cH.legendLine=bo.path([ao,-cw-b7,0,ap,-b7,0]).attr({"stroke-width":cH.options.lineWidth,zIndex:2}).add(cg)}if(cK){cJ=bo.rect(-cw-b7,-11,cw,12,2).attr({"stroke-width":0,zIndex:3}).add(cg)}else{if(cH.options&&cH.options.marker&&cH.options.marker.enabled){cJ=bo.symbol(cH.symbol,-cw/2-b7,-4,cH.options.marker.radius).attr(cH.pointAttr[aC]).attr({zIndex:3}).add(cg)}}cH.legendSymbol=cJ;cr(cH,cH.visible);if(cH.options&&cH.options.showCheckbox){cH.checkbox=al("input",{type:"checkbox",checked:cH.selected,defaultChecked:cH.selected},cj.itemCheckboxStyle,bq);aw(cH.checkbox,"click",function(cL){var cM=cL.target;K(cH,"checkboxClick",{checked:cM.checked},function(){cH.select()})})}}cx(cH,cc,ca);cG=cE.getBBox();cu=ca;cH.legendItemWidth=cI=cj.itemWidth||cw+b7+cG.width+cC;if(cB){cc+=cI;cv=cp||aH(cc-cA,cv);if(cc-cA+cI>(cp||(bw-2*cD-cA))){cc=cA;ca+=cl}}else{ca+=cl;cv=cp||aH(cI,cv)}cs.push(cH)}function cd(){cc=cA;ca=cm;cv=0;cu=0;if(!cg){cg=bo.g("legend").attr({zIndex:7}).add()}if(cz){b8.reverse()}a8(b8,function(cJ){if(!cJ.options.showInLegend){return}var cI=(cJ.options.legendType=="point")?cJ.data:[cJ];a8(cI,co)});if(cz){b8.reverse()}b9=cp||cv;ch=cu-cm+cl;if(cq||cb){b9+=2*cD;ch+=2*cD;if(!cn){cn=bo.rect(0,0,b9,ch,cj.borderRadius,cq||0).attr({stroke:cj.borderColor,"stroke-width":cq||0,fill:cb||ad}).add(cg).shadow(cj.shadow)}else{cn.attr({height:ch,width:b9})}}var cG=["left","right","top","bottom"],cH,cF=4;while(cF--){cH=cG[cF];if(cy[cH]&&cy[cH]!="auto"){cj[cF<2?"align":"verticalAlign"]=cH;cj[cF<2?"x":"y"]=parseInt(cy[cH],10)*(cF%2?-1:1)}}var cE=bb(Y({width:b9,height:ch},cj));cg.translate(cE.x,cE.y);a8(cs,function(cI){var cJ=cI.checkbox;if(cJ){ar(cJ,{left:(cE.x+cI.legendItemWidth+cJ.x-40)+af,top:(cE.y+cJ.y-11)+af})}})}cd();return{colorizeItem:cr,destroyItem:cf,renderLegend:cd}};function bY(b8){var b9=b8.type||by.defaultSeriesType,cb=p[b9],ca,b7=b4.hasRendered;if(b7){if(bc&&b9=="column"){cb=p.bar}else{if(!bc&&b9=="bar"){cb=p.column}}}ca=new cb();ca.init(b4,b8);if(!b7&&ca.inverted){bc=true}if(ca.isCartesian){M=ca.isCartesian}bS.push(ca);return ca}function b2(b8,b9){var b7;b9=b(b9,true);K(b4,"addSeries",{options:b8},function(){b7=bY(b8);b7.isDirty=true;b4.isDirty=true;if(b9){b4.redraw()}});return b7}b3=function(b7,ca){var b9=0,b8=0;return b7>=b9&&b7<=b9+ba&&ca>=b8&&ca<=b8+bh};function bV(){if(by.alignTicks!==false){a8(bR,function(b7){b7.adjustTickAmount()})}}function bW(){var b9=b4.isDirty,b8,b7=bS.length,ca=b7,cb;while(ca--){cb=bS[ca];if(cb.isDirty&&cb.options.stacking){b8=true;break}}if(b8){ca=b7;while(ca--){cb=bS[ca];if(cb.options.stacking){cb.isDirty=true}}}a8(bS,function(cc){if(cc.isDirty){cc.cleanData();cc.getSegments();if(cc.options.legendType=="point"){b9=true}}});bj=null;if(M){a8(bR,function(cc){cc.setScale()});bV();a8(bR,function(cc){if(cc.isDirty){cc.redraw()}})}a8(bS,function(cc){if(cc.isDirty&&cc.visible){cc.redraw()}});if(b9&&bi.renderLegend){bi.renderLegend();b4.isDirty=false}if(bp&&bp.resetTracker){bp.resetTracker()}K(b4,"redraw")}function bn(b8){var b7=bA.loading;if(!b1){b1=al(aj,{className:"highcharts-loading"},Y(b7.style,{left:bx+af,top:bX+af,width:ba+af,height:bh+af,zIndex:10,display:ad}),bq);
al("span",null,b7.labelStyle,b1)}if(!bg){ar(b1,{opacity:0,display:""});b1.getElementsByTagName("span")[0].innerHTML=b8||bA.lang.loading;an(b1,{opacity:b7.style.opacity},{duration:b7.showDuration});bg=true}}function bD(){an(b1,{opacity:0},{duration:bA.loading.hideDuration,complete:function(){ar(b1,{display:ad})}});bg=false}function b0(ca){var b8,b7,b9;for(b8=0;b8<bR.length;b8++){if(bR[b8].options.id==ca){return bR[b8]}}for(b8=0;b8<bS.length;b8++){if(bS[b8].options.id==ca){return bS[b8]}}for(b8=0;b8<bS.length;b8++){b9=bS[b8].data;for(b7=0;b7<b9.length;b7++){if(b9[b7].id==ca){return b9[b7]}}}return null}function bL(){var b7=bA.xAxis||{},b8=bA.yAxis||{},b9;b7=Z(b7);a8(b7,function(cb,ca){cb.index=ca;cb.isX=true});b8=Z(b8);a8(b8,function(cb,ca){cb.index=ca});bR=b7.concat(b8);b4.xAxis=[];b4.yAxis=[];bR=t(bR,function(ca){b9=new bs(b4,ca);b4[b9.isXAxis?"xAxis":"yAxis"].push(b9);return b9});bV()}function bd(){var b7=[];a8(bS,function(b8){b7=b7.concat(m(b8.data,function(b9){return b9.selected}))});return b7}function bF(){return m(bS,function(b7){return b7.selected})}bC=function(){K(b4,"selection",{resetSelection:true},bZ);b4.toolbar.remove("zoom")};bZ=function(b7){var b8=aD.lang;b4.toolbar.add("zoom",b8.resetZoom,b8.resetZoomTitle,bC);if(!b7||b7.resetSelection){a8(bR,function(b9){b9.setExtremes(null,null,false)})}else{a8(b7.xAxis.concat(b7.yAxis),function(ca){var b9=ca.axis;if(b4.tracker[b9.isXAxis?"zoomX":"zoomY"]){b9.setExtremes(ca.min,ca.max,false)}})}bW()};function bN(){var cb=bA.title,b8=cb.align,b9=bA.subtitle,b7=b9.align,ca={left:0,center:bw/2,right:bw};if(cb&&cb.text){bo.text(cb.text,ca[b8]+cb.x,cb.y,cb.style,0,b8).attr({"class":"highcharts-title"}).add()}if(b9&&b9.text){bo.text(b9.text,ca[b7]+b9.x,b9.y,b9.style,0,b7).attr({"class":"highcharts-subtitle"}).add()}}bb=function(ca){var cc=ca.align,cb=ca.verticalAlign,b8=ca.x||0,b9=ca.y||0,b7={x:b8||0,y:b9||0};if(/^(right|center)$/.test(cc)){b7.x=(bw-ca.width)/{right:1,center:2}[cc]+b8}if(/^(bottom|middle)$/.test(cb)){b7.y=(a9-ca.height)/{bottom:1,middle:2}[cb]+b9}return b7};function bl(){bK=by.renderTo;b5=aT+H++;if(typeof bK=="string"){bK=B.getElementById(bK)}bK.innerHTML="";if(!bK.offsetWidth){bf=bK.cloneNode(0);ar(bf,{position:r,top:"-9999px",display:""});B.body.appendChild(bf)}var b7=(bf||bK).offsetHeight;b4.chartWidth=bw=by.width||(bf||bK).offsetWidth||600;b4.chartHeight=a9=by.height||(b7>bX+bu?b7:0)||400;b4.plotWidth=ba=bw-bx-b6;b4.plotHeight=bh=a9-bX-bu;b4.plotLeft=bx;b4.plotTop=bX;b4.container=bq=al(aj,{className:"highcharts-container"+(by.className?" "+by.className:""),id:b5},Y({position:l,overflow:am,width:bw+af,height:a9+af,textAlign:"left"},by.style),bf||bK);b4.renderer=bo=by.renderer=="SVG"?new q(bq,bw,a9):new T(bq,bw,a9)}function bv(){var b7,cc=bA.labels,ca=bA.credits,b9=by.borderWidth||0,cb=by.backgroundColor,b8=by.plotBackgroundColor,cd=by.plotBackgroundImage;b7=2*b9+(by.shadow?8:0);if(b9||cb){bo.rect(b7/2,b7/2,bw-b7,a9-b7,by.borderRadius,b9).attr({stroke:by.borderColor,"stroke-width":b9,fill:cb||ad}).add().shadow(by.shadow)}if(b8){bo.rect(bx,bX,ba,bh,0).attr({fill:b8}).add().shadow(by.plotShadow)}if(cd){bo.image(cd,bx,bX,ba,bh).add()}if(by.plotBorderWidth){bo.rect(bx,bX,ba,bh,0,by.plotBorderWidth).attr({stroke:by.plotBorderColor,"stroke-width":by.plotBorderWidth,zIndex:4}).add()}if(M){a8(bR,function(ce){ce.render()})}bN();if(cc.items){a8(cc.items,function(){var cf=Y(cc.style,this.style),ce=parseInt(cf.left,10)+bx,cg=parseInt(cf.top,10)+bX+12;delete cf.left;delete cf.top;bo.text(this.html,ce,cg,cf).attr({zIndex:2}).add()})}a8(bS,function(ce){ce.render()});bi=b4.legend=new bM(b4);if(!b4.toolbar){b4.toolbar=bm(b4)}if(ca.enabled&&!b4.credits){bo.text(ca.text,bw-10,a9-5,ca.style,0,"right").on("click",function(){location.href=ca.href}).attr({zIndex:8}).add()}b4.hasRendered=true;if(bf){bK.appendChild(bq);Q(bf)}}function bU(){var b7=bS.length;aq(ax,"unload",bU);aq(b4);a8(bR,function(b8){aq(b8)});while(b7--){bS[b7].destroy()}bq.onmousedown=bq.onmousemove=bq.onmouseup=bq.onclick=null;
bq.parentNode.removeChild(bq);bq=null;clearInterval(bt);for(b7 in b4){delete b4[b7]}}function bH(){var b7="onreadystatechange";if(!i&&B.readyState!="complete"){B.attachEvent(b7,function(){B.detachEvent(b7,arguments.callee);bH()});return}bl();a8(bA.series||[],function(b8){bY(b8)});b4.inverted=bc=b(bc,bA.chart.inverted);b4.plotSizeX=bJ=bc?bh:ba;b4.plotSizeY=bI=bc?ba:bh;b4.tracker=bp=new bO(b4,bA.tooltip);bL();a8(bS,function(b8){b8.translate();b8.setTooltipPoints()});b4.render=bv;bv();K(b4,"load");bk&&bk(b4)}aG=0;I=0;aw(ax,"unload",bU);if(bG){for(bz in bG){aw(b4,bz,bG[bz])}}b4.options=bA;b4.series=bS;b4.addSeries=b2;b4.destroy=bU;b4.get=b0;b4.getAlignment=bb;b4.getSelectedPoints=bd;b4.getSelectedSeries=bF;b4.hideLoading=bD;b4.isInsidePlot=b3;b4.redraw=bW;b4.showLoading=bn;bH()}var f=function(){};f.prototype={init:function(M,a9){var L=this,ba;L.series=M;L.applyOptions(a9);L.pointAttr={};if(M.options.colorByPoint){ba=M.chart.options.colors;if(!L.options){L.options={}}L.color=L.options.color=L.color||ba[aG++];if(aG>=ba.length){aG=0}}return L},applyOptions:function(a9){var L=this,M=L.series;L.config=a9;if(typeof a9=="number"||a9===null){L.y=a9}else{if(typeof a9=="object"&&typeof a9.length!="number"){Y(L,a9);L.options=a9}else{if(typeof a9[0]=="string"){L.name=a9[0];L.y=a9[1]}else{if(typeof a9[0]=="number"){L.x=a9[0];L.y=a9[1]}}}}if(L.x===au){L.x=M.autoIncrement()}},destroy:function(){var L=this,M;if(L==L.series.chart.hoverPoint){L.onMouseOut()}aq(L);a8(["dataLabel","graphic","tracker","group"],function(a9){if(L[a9]){L[a9].destroy()}});if(L.legendItem){L.series.chart.legend.destroyItem(L)}for(M in L){L[M]=null}},select:function(bb,M){var L=this,a9=L.series,ba=a9.chart;L.selected=bb=b(bb,!L.selected);L.firePointEvent(bb?"select":"unselect");L.setState(bb&&v);if(!M){a8(ba.getSelectedPoints(),function(bc){if(bc.selected&&bc!=L){bc.selected=false;bc.setState(aC);bc.firePointEvent("unselect")}})}},onMouseOver:function(){var M=this,ba=M.series.chart,L=ba.tooltip,a9=ba.hoverPoint;if(a9&&a9!=M){a9.onMouseOut()}M.firePointEvent("mouseOver");if(L){L.refresh(M)}M.setState(aF);ba.hoverPoint=M},onMouseOut:function(){var L=this;L.firePointEvent("mouseOut");L.setState(aC);L.series.chart.hoverPoint=null},update:function(a9,ba){var L=this,M=L.series;ba=b(ba,true);L.firePointEvent("update",{options:a9},function(){L.applyOptions(a9);M.isDirty=true;if(ba){M.chart.redraw()}})},remove:function(bc){var L=this,M=L.series,ba=M.chart,bb=M.data,a9=bb.length;bc=b(bc,true);L.firePointEvent("remove",null,function(){while(a9--){if(bb[a9]==L){bb.splice(a9,1);break}}L.destroy();M.isDirty=true;if(bc){ba.redraw()}})},firePointEvent:function(ba,M,bc){var L=this,a9=this.series,bb=a9.options;if(bb.point.events[ba]||(L.options&&L.options.events&&L.options.events[ba])){this.importEvents()}if(ba=="click"&&bb.allowPointSelect){bc=function(bd){L.select(null,bd.ctrlKey||bd.metaKey||bd.shiftKey)}}K(this,ba,M,bc)},importEvents:function(){if(!this.hasImportedEvents){var L=this,ba=y(L.series.options.point,L.options),M=ba.events,a9;L.events=M;for(a9 in M){aw(L,a9,M[a9])}this.hasImportedEvents=true}},setState:function(M){var bg=this,ba=bg.series,bf=ba.options.states,be=ba.options.marker,bb=be&&!be.enabled,a9=be&&be.states[M],bc=a9&&a9.enabled===false,bd=ba.chart,L=bg.pointAttr;if(!M){M=aC}if((bg.selected&&M!=v)||(bf[M]&&bf[M].enabled===false)||(M&&(bc||bb&&!a9.enabled))){return}if(M&&!bg.graphic){if(!ba.stateMarkerGraphic){ba.stateMarkerGraphic=bd.renderer.circle(0,0,L[M].r).attr(L[M]).add(ba.group)}ba.stateMarkerGraphic.translate(bg.plotX,bg.plotY)}else{if(bg.graphic){bg.graphic.attr(L[M])}}},setTooltipText:function(){var L=this;L.tooltipText=L.series.chart.options.tooltip.formatter.call({series:L.series,point:L,x:L.category,y:L.y,percentage:L.percentage,total:L.total||L.stackTotal})}};var aa=function(){};aa.prototype={isCartesian:true,type:"line",pointClass:f,pointAttrToOptions:{stroke:"lineColor","stroke-width":"lineWidth",fill:"fillColor",r:"radius"},init:function(bc,bb){var a9=this,ba,M,L=bc.series.length;
a9.chart=bc;bb=a9.setOptions(bb);Y(a9,{index:L,options:bb,name:bb.name||"Series "+(L+1),state:aC,pointAttr:{},visible:bb.visible!==false,selected:bb.selected===true});M=bb.events;for(ba in M){aw(a9,ba,M[ba])}a9.getColor();a9.getSymbol();a9.setData(bb.data,false)},autoIncrement:function(){var L=this,M=L.options,a9=L.xIncrement;a9=b(a9,M.pointStart,0);L.pointInterval=b(L.pointInterval,M.pointInterval,1);L.xIncrement=a9+L.pointInterval;return a9},cleanData:function(){var L=this,a9=L.data,M;a9.sort(function(bb,ba){return(bb.x-ba.x)});for(M=a9.length-1;M>=0;M--){if(a9[M-1]){if(a9[M-1].x==a9[M].x){a9.splice(M-1,1)}}}},getSegments:function(){var M=-1,L=[],a9=this.data;a8(a9,function(ba,bb){if(ba.y===null){if(bb>M+1){L.push(a9.slice(M+1,bb))}M=bb}else{if(bb==a9.length-1){L.push(a9.slice(M+1,bb+1))}}});this.segments=L},setOptions:function(L){var a9=this.chart.options.plotOptions,M=y(a9[this.type],a9.series,L);return M},getColor:function(){var L=this.chart.options.colors;this.color=this.options.color||L[aG++]||"#0000ff";if(aG>=L.length){aG=0}},getSymbol:function(){var M=this.chart.options.symbols,L=this.options.marker.symbol||M[I++];this.symbol=L;if(I>=M.length){I=0}},addPoint:function(ba,bc,M){var a9=this,bb=a9.data,L=(new a9.pointClass()).init(a9,ba);bc=b(bc,true);bb.push(L);if(M){bb[0].remove(false)}a9.isDirty=true;if(bc){a9.chart.redraw()}},setData:function(ba,bb){var M=this,bc=M.data,L=M.initialColor,a9=bc&&bc.length||0;M.xIncrement=null;if(h(L)){aG=L}ba=t(Z(ba||[]),function(bd){return(new M.pointClass()).init(M,bd)});while(a9--){bc[a9].destroy()}M.data=ba;M.cleanData();M.getSegments();M.isDirty=true;if(b(bb,true)){M.chart.redraw()}},remove:function(a9){var L=this,M=L.chart;a9=b(a9,true);if(!L.isRemoving){L.isRemoving=true;K(L,"remove",null,function(){L.destroy();M.isDirty=true;if(a9){M.redraw()}})}L.isRemoving=false},translate:function(){var ba=this,bg=ba.chart,bf=ba.options.stacking,be=ba.xAxis.categories,M=ba.yAxis,bi=M.stacks[ba.type],bd=ba.data,bc=bd.length;while(bc--){var bj=bd[bc],bb=bj.x,L=bj.y,bh,bk,a9;bj.plotX=ba.xAxis.translate(bb);if(bf&&ba.visible&&bi[bb]){bk=bi[bb];a9=bk.total;bk.cum=bh=bk.cum-L;L=bh+L;if(bf=="percent"){bh=a9?bh*100/a9:0;L=a9?L*100/a9:0}bj.percentage=a9?bj.y*100/a9:0;bj.stackTotal=a9;bj.yBottom=M.translate(bh,0,1)}if(L!==null){bj.plotY=M.translate(L,0,1)}bj.clientX=bg.inverted?bg.plotHeight-bj.plotX:bj.plotX;bj.category=be&&be[bj.x]!==au?be[bj.x]:bj.x}},setTooltipPoints:function(a9){var M=this,bd=M.chart,L=bd.inverted,bb=[],bf=(L?bd.plotTop:bd.plotLeft)+bd.plotSizeX,be,ba,bc=[];if(a9){M.tooltipPoints=null}a8(M.segments,function(bg){bb=bb.concat(bg)});if(M.xAxis&&M.xAxis.reversed){bb=bb.reverse()}a8(bb,function(bg,bh){if(!M.tooltipPoints){bg.setTooltipText()}be=bb[bh-1]?bb[bh-1].high+1:0;ba=bg.high=bb[bh+1]?(N((bg.plotX+(bb[bh+1]?bb[bh+1].plotX:bf))/2)):bf;while(be<=ba){bc[L?bf-be++:be++]=bg}});M.tooltipPoints=bc},onMouseOver:function(){var M=this,a9=M.chart,L=a9.hoverSeries,ba=M.stateMarkerGraphic;if(a9.mouseIsDown){return}if(ba){ba.show()}if(L&&L!=M){L.onMouseOut()}if(M.options.events.mouseOver){K(M,"mouseOver")}if(M.tracker){M.tracker.toFront()}M.setState(aF);a9.hoverSeries=M},onMouseOut:function(){var a9=this,ba=a9.options,bb=a9.chart,L=bb.tooltip,M=bb.hoverPoint;if(M){M.onMouseOut()}if(a9&&ba.events.mouseOut){K(a9,"mouseOut")}if(L&&!ba.stickyTracking){L.hide()}a9.setState();bb.hoverSeries=null},animate:function(ba){var L=this,a9=L.chart,M=L.clipRect;if(ba){if(!M.isAnimating){M.attr("width",0);M.isAnimating=true}}else{M.animate({width:a9.plotSizeX},{complete:function(){M.isAnimating=false},duration:1000});this.animate=null}},drawPoints:function(){var bb=this,M,bd=bb.data,be=bb.chart,L,bg,bc,bf,ba,a9;if(bb.options.marker.enabled){bc=bd.length;while(bc--){bf=bd[bc];L=bf.plotX;bg=bf.plotY;a9=bf.graphic;if(bg!==au){M=bf.pointAttr[bf.selected?v:aC];ba=M.r;if(a9){a9.attr({x:L,y:bg,r:ba})}else{bf.graphic=be.renderer.symbol(b(bf.marker&&bf.marker.symbol,bb.symbol),L,bg,ba).attr(M).add(bb.group)}}}}},convertAttribs:function(ba,M,be,bd){var bb=this.pointAttrToOptions,L,a9,bc={};
ba=ba||{};M=M||{};be=be||{};bd=bd||{};for(L in bb){a9=bb[L];bc[L]=b(ba[a9],M[L],be[L],bd[L])}return bc},getAttribs:function(){var bb=this,M=bb.options.marker||bb.options,bj=M.states,bh=bj[aF],bf,a9={},bg=bb.color,be=bb.data,bd,bk,bc=[],L,ba=bb.pointAttrToOptions,bi;if(bb.options.marker){a9={stroke:bg,fill:bg};bh.radius=bh.radius||M.radius+2;bh.lineWidth=bh.lineWidth||M.lineWidth+1}else{a9={fill:bg};bh.color=bh.color||x(bh.color||bg).brighten(bh.brightness).get()}bc[aC]=bb.convertAttribs(M,a9);a8([aF,v],function(bm){bc[bm]=bb.convertAttribs(bj[bm],bc[aC])});bb.pointAttr=bc;bd=be.length;while(bd--){bk=be[bd];M=(bk.options&&bk.options.marker)||bk.options;if(M&&M.enabled===false){M.radius=0}bi=false;if(bk.options){for(var bl in ba){if(h(M[ba[bl]])){bi=true}}}if(bi){L=[];bj=M.states||{};bf=bj[aF]=bj[aF]||{};if(!bb.options.marker){bf.color=x(bf.color||bk.options.color).brighten(bf.brightness||bh.brightness).get()}L[aC]=bb.convertAttribs(M,bc[aC]);L[aF]=bb.convertAttribs(bj[aF],bc[aF],L[aC]);L[v]=bb.convertAttribs(bj[v],bc[v],L[aC])}else{L=bc}bk.pointAttr=L}},destroy:function(){var L=this,a9=L.chart,bb=a9.series,M=L.clipRect,ba;aq(L);if(L.legendItem){L.chart.legend.destroyItem(L)}a8(L.data,function(bc){bc.destroy()});a8(["area","graph","dataLabelsGroup","group","tracker"],function(bc){if(L[bc]){L[bc].destroy()}});if(M&&M!=L.chart.clipRect){M.destroy()}if(a9.hoverSeries==L){a9.hoverSeries=null}a8(bb,function(bd,bc){if(bd==L){bb.splice(bc,1)}});for(ba in L){delete L[ba]}},drawDataLabels:function(){if(this.options.dataLabels.enabled){var M=this,bi,bh,bb=M.data,bg=M.options.dataLabels,bf,bd=M.dataLabelsGroup,be=M.chart,L=be.inverted,ba=M.type,a9,bc;if(!bd){bd=M.dataLabelsGroup=be.renderer.g(aT+"data-labels").attr({visibility:M.visible?ah:am,zIndex:4}).translate(be.plotLeft,be.plotTop).add()}a9=bg.color;if(a9=="auto"){a9=null}bg.style.color=b(a9,M.color);a8(bb,function(bj){var bl=b(bj.barX,bj.plotX),bk=bj.plotY,bn=bj.tooltipPos,bm=bj.dataLabel;if(bm){bj.dataLabel=bm.destroy()}bf=bg.formatter.call({x:bj.x,y:bj.y,series:M,point:bj,percentage:bj.percentage,total:bj.total||bj.stackTotal});bi=(L?be.plotWidth-bk:bl)+bg.x;bh=(L?be.plotHeight-bl:bk)+bg.y;if(bn){bi=bn[0]+bg.x;bh=bn[1]+bg.y}bc=bg.align;if(ba=="column"){bi+={center:bj.barW/2,right:bj.barW}[bc]||0}if(bf){bj.dataLabel=be.renderer.text(bf,bi,bh,bg.style,bg.rotation,bc).attr({zIndex:1,visibility:bj.visible===false?am:"inherit"}).add(bd)}if(M.drawConnector){M.drawConnector(bj)}})}},drawGraph:function(M){var bb=this,bk=bb.options,bj=bb.chart,bn=bb.graph,be=[],bi,a9=bb.area,bl=bb.group,bd=bk.lineColor||bb.color,ba=bk.lineWidth,bh,L=bj.renderer,bm=bb.yAxis.getThreshold(bk.threshold||0),bf=/^area/.test(bb.type),bg=[],bc=[];a8(bb.segments,function(bq){if(bq.length>1){bh=[];a8(bq,function(bs,bt){if(bt<2){bh.push([ao,ap][bt])}if(bt&&bk.step){var bu=bq[bt-1];bh.push(bs.plotX,bu.plotY)}bh.push(bs.plotX,bs.plotY)});be=be.concat(bh);if(bf){var br=[],bp,bo=bh.length;for(bp=0;bp<bo;bp++){br.push(bh[bp])}if(bk.stacking&&bb.type!="areaspline"){for(bp=bq.length-1;bp>=0;bp--){br.push(bq[bp].plotX,bq[bp].yBottom)}}else{br.push(bq[bq.length-1].plotX,bm,bq[0].plotX,bm,"z")}bc=bc.concat(br)}}else{bg.push(bq[0])}});bb.graphPath=be;bb.singlePoints=bg;if(bf){bi=b(bk.fillColor,x(bb.color).setOpacity(bk.fillOpacity||0.75).get());if(a9){a9.attr({d:bc})}else{bb.area=bb.chart.renderer.path(bc).attr({fill:bi}).add(bb.group)}}if(bn){bn.attr({d:be})}else{if(ba){bb.graph=L.path(be).attr({stroke:bd,"stroke-width":ba+af}).add(bl).shadow(bk.shadow)}}},render:function(){var M=this,a9=M.chart,bb,ba=M.options.animation&&M.animate,L=a9.renderer;if(!M.clipRect){M.clipRect=!a9.hasRendered&&a9.clipRect?a9.clipRect:L.clipRect(0,0,a9.plotSizeX,a9.plotSizeY);if(!a9.clipRect){a9.clipRect=M.clipRect}}if(!M.group){bb=M.group=L.g("series");if(a9.inverted){bb.attr({width:a9.plotWidth,height:a9.plotHeight}).invert()}bb.clip(M.clipRect).attr({visibility:M.visible?ah:am,zIndex:3}).translate(a9.plotLeft,a9.plotTop).add()}M.drawDataLabels();if(ba){M.animate(true)
}M.getAttribs();if(M.drawGraph){M.drawGraph()}M.drawPoints();if(M.options.enableMouseTracking!==false){M.drawTracker()}if(ba){M.animate()}M.isDirty=false},redraw:function(){var L=this;L.translate();L.setTooltipPoints(true);L.render()},setState:function(bb){var L=this,M=L.options,ba=L.graph,bd=M.states,bc=L.stateMarkerGraphic,a9=M.lineWidth;bb=bb||aC;if(L.state!=bb){L.state=bb;if(bd[bb]&&bd[bb].enabled===false){return}if(bb){a9=bd[bb].lineWidth||a9}else{if(bc){bc.hide()}}if(ba){ba.animate({"stroke-width":a9},bb?0:500)}}},setVisible:function(bb,bj){var bc=this,bg=bc.chart,ba=bc.legendItem,L=bc.group,bi=bc.tracker,bf=bc.dataLabelsGroup,M,be,bd=bc.data,bk,bh=bg.options.chart.ignoreHiddenSeries,a9=bc.visible;bc.visible=bb=bb===au?!a9:bb;M=bb?"show":"hide";if(bb){bc.isDirty=bh}if(L){L[M]()}if(bi){bi[M]()}else{be=bd.length;while(be--){bk=bd[be];if(bk.tracker){bk.tracker[M]()}}}if(bf){bf[M]()}if(ba){bg.legend.colorizeItem(bc,bb)}if(bh){if(bc.options.stacking){a8(bg.series,function(bl){if(bl.options.stacking&&bl.visible){bl.isDirty=true}})}}if(bj!==false){bg.redraw()}K(bc,M)},show:function(){this.setVisible(true)},hide:function(){this.setVisible(false)},select:function(M){var L=this;L.selected=M=(M===au)?!L.selected:M;if(L.checkbox){L.checkbox.checked=M}K(L,M?"select":"unselect")},drawTracker:function(){var a9=this,bf=a9.options,L=a9.graphPath,be=a9.chart,M=be.options.tooltip.snap,bh=a9.tracker,bg=bf.cursor,bd=bg&&{cursor:bg},bc=a9.singlePoints,ba,bb;for(bb=0;bb<bc.length;bb++){ba=bc[bb];L.push(ao,ba.plotX-3,ba.plotY,ap,ba.plotX+3,ba.plotY)}if(bh){bh.attr({d:L})}else{a9.tracker=be.renderer.path(L).attr({isTracker:true,stroke:az,fill:ad,"stroke-width":bf.lineWidth+2*M,"stroke-linecap":"round",visibility:a9.visible?ah:am,zIndex:1}).on("mouseover",function(){if(be.hoverSeries!=a9){a9.onMouseOver()}}).on("mouseout",function(){if(!bf.stickyTracking){a9.onMouseOut()}}).css(bd).add(be.trackerGroup)}}};var F=J(aa);p.line=F;var a0=J(aa,{type:"area"});p.area=a0;function a1(bb){var bf=[];var be=[];var ba;for(ba=0;ba<bb.length;ba++){bf[ba]=bb[ba].plotX;be[ba]=bb[ba].plotY}this.xdata=bf;this.ydata=be;var bd=[];this.y2=[];var M=be.length;this.n=M;this.y2[0]=0;this.y2[M-1]=0;bd[0]=0;for(ba=1;ba<M-1;ba++){var bc=(bf[ba+1]-bf[ba-1]);var bg=(bf[ba]-bf[ba-1])/bc;var L=bg*this.y2[ba-1]+2;this.y2[ba]=(bg-1)/L;bd[ba]=(be[ba+1]-be[ba])/(bf[ba+1]-bf[ba])-(be[ba]-be[ba-1])/(bf[ba]-bf[ba-1]);bd[ba]=(6*bd[ba]/(bf[ba+1]-bf[ba-1])-bg*bd[ba-1])/L}for(var a9=M-2;a9>=0;a9--){this.y2[a9]=this.y2[a9]*this.y2[a9+1]+bd[a9]}}a1.prototype={get:function(M){if(!M){M=50}var bd=this.n;var ba=(this.xdata[bd-1]-this.xdata[0])/(M-1);var bc=[];var a9=[];bc[0]=this.xdata[0];a9[0]=this.ydata[0];var bb=[{plotX:bc[0],plotY:a9[0]}];for(var L=1;L<M;L++){bc[L]=bc[0]+L*ba;a9[L]=this.interpolate(bc[L]);bb[L]={plotX:bc[L],plotY:a9[L]}}return bb},interpolate:function(L){var bd=this.n-1;var a9=0;while(bd-a9>1){var M=(bd+a9)/2;if(this.xdata[N(M)]>L){bd=M}else{a9=M}}var bb=N(bd),bf=N(a9);var ba=this.xdata[bb]-this.xdata[bf];var be=(this.xdata[bb]-L)/ba;var bc=(L-this.xdata[bf])/ba;return be*this.ydata[bf]+bc*this.ydata[bb]+((be*be*be-be)*this.y2[bf]+(bc*bc*bc-bc)*this.y2[bb])*(ba*ba)/6}};var aU=J(aa,{type:"spline",drawGraph:function(a9){var L=this,M=L.segments;L.splinedata=L.getSplineData();L.segments=L.splinedata;aa.prototype.drawGraph.apply(L,arguments);L.segments=M},getSplineData:function(){var a9=this,ba=a9.chart,bb=[],L=ba.plotSizeX,M;a8(a9.segments,function(bf){if(a9.xAxis.reversed){bf=bf.reverse()}var be=[],bc,bd;a8(bf,function(bg,bh){bc=bf[bh+2]||bf[bh+1]||bg;bd=bf[bh-2]||bf[bh-1]||bg;if(bc.plotX>=0&&bd.plotX<=L){be.push(bg)}});if(be.length>1){M=w(aH(L,be[be.length-1].clientX-be[0].clientX)/3)}bb.push(bf.length>1?M?(new a1(be)).get(M):[]:bf)});return bb}});p.spline=aU;var a=J(aU,{type:"areaspline"});p.areaspline=a;var P=J(aa,{type:"column",pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color",r:"borderRadius"},init:function(){aa.prototype.init.apply(this,arguments);
var L=this,M=L.chart;if(M.hasRendered){a8(M.series,function(a9){if(a9.type==L.type){a9.isDirty=true}})}},translate:function(){var L=this,bi=L.chart,bk=0,bf=L.xAxis.reversed,bm=L.xAxis.categories,M;aa.prototype.translate.apply(L);a8(bi.series,function(br){if(br.type==L.type){if(!br.options.stacking){br.columnIndex=bk++}else{if(!h(M)){M=bk++}br.columnIndex=M}}});var bd=L.options,bq=L.data,ba=L.closestPoints,a9=a6(bq[1]?bq[ba].plotX-bq[ba-1].plotX:bi.plotSizeX/(bm?bm.length:1)),bo=a9*bd.groupPadding,bg=a9-2*bo,bp=bg/bk,bl=bd.pointWidth,be=h(bl)?(bp-bl)/2:bp*bd.pointPadding,bb=b(bl,bp-2*be),bj=(bf?bk-L.columnIndex:L.columnIndex)||0,bn=be+(bo+bj*bp-(a9/2))*(bf?-1:1),bh=L.yAxis.getThreshold(bd.threshold||0),bc=bd.minPointLength;a8(bq,function(br){var bt=br.plotY,bw=br.plotX+bn,bv=a7(X(bt,bh)),bx=bb,bs=a7(a6((br.yBottom||bh)-bt)),bu;if(a6(bs)<(bc||5)){if(bc){bs=bc;bv=bh-(bt<=bh?bc:0)}bu=bv-3}Y(br,{barX:bw,barY:bv,barW:bx,barH:bs});br.shapeType="rect";br.shapeArgs={x:bw,y:bv,width:bx,height:bs,r:bd.borderRadius};br.trackerArgs=h(bu)&&y(br.shapeArgs,{height:6,y:bu})})},getSymbol:function(){},drawGraph:function(){},drawPoints:function(){var a9=this,ba=a9.options,L=a9.chart.renderer,bb,M;a8(a9.data,function(bc){if(h(bc.plotY)){bb=bc.graphic;M=bc.shapeArgs;if(bb){bb.attr(M)}else{bc.graphic=L[bc.shapeType](M).attr(bc.pointAttr[bc.selected?v:aC]).add(a9.group).shadow(ba.shadow)}}})},drawTracker:function(){var a9=this,bc=a9.chart,L=bc.renderer,ba,be,M=+new Date(),bd=a9.options.cursor,bb=bd&&{cursor:bd},bf;a8(a9.data,function(bg){be=bg.tracker;ba=bg.trackerArgs||bg.shapeArgs;if(be){be.attr(ba)}else{bg.tracker=L[bg.shapeType](ba).attr({isTracker:M,fill:az,visibility:a9.visible?ah:am,zIndex:1}).on("mouseover",function(bh){bf=bh.relatedTarget||bh.fromElement;if(bc.hoverSeries!=a9&&V(bf,"isTracker")!=M){a9.onMouseOver()}bg.onMouseOver()}).on("mouseout",function(bh){if(!a9.options.stickyTracking){bf=bh.relatedTarget||bh.toElement;if(V(bf,"isTracker")!=M){a9.onMouseOut()}}}).css(bb).add(bc.trackerGroup)}})},cleanData:function(){var a9=this,bb=a9.data,L,M,bc,ba;aa.prototype.cleanData.apply(a9);for(ba=bb.length-1;ba>=0;ba--){if(bb[ba-1]){L=bb[ba].x-bb[ba-1].x;if(M===au||L<M){M=L;bc=ba}}}a9.closestPoints=bc},animate:function(a9){var L=this,M=L.data;if(!a9){a8(M,function(ba){var bb=ba.graphic;if(bb){bb.attr({height:0,y:L.yAxis.translate(0,0,1)});bb.animate({height:ba.barH,y:ba.barY},{duration:1000})}});L.animate=null}},remove:function(){var L=this,M=L.chart;if(M.hasRendered){a8(M.series,function(a9){if(a9.type==L.type){a9.isDirty=true}})}aa.prototype.remove.apply(L,arguments)}});p.column=P;var ay=J(P,{type:"bar",init:function(L){L.inverted=this.inverted=true;P.prototype.init.apply(this,arguments)}});p.bar=ay;var aE=J(aa,{type:"scatter",translate:function(){var L=this;aa.prototype.translate.apply(L);a8(L.data,function(M){M.shapeType="circle";M.shapeArgs={x:M.plotX,y:M.plotY,r:L.chart.options.tooltip.snap}})},drawTracker:function(){var L=this,a9=L.options.cursor,M=a9&&{cursor:a9},ba;a8(L.data,function(bb){ba=bb.graphic;if(ba){ba.attr({isTracker:true}).on("mouseover",function(bc){L.onMouseOver();bb.onMouseOver()}).on("mouseout",function(bc){if(!L.options.stickyTracking){L.onMouseOut()}}).css(M)}})},cleanData:function(){}});p.scatter=aE;var aB=J(f,{init:function(){f.prototype.init.apply(this,arguments);var L=this,M;Y(L,{visible:L.visible!==false,name:b(L.name,"Slice")});M=function(){L.slice()};aw(L,"select",M);aw(L,"unselect",M);return L},setVisible:function(a9){var L=this,M=L.series.chart,ba;L.visible=a9=a9===au?!L.visible:a9;ba=a9?"show":"hide";L.group[ba]();if(L.tracker){L.tracker[ba]()}if(L.dataLabel){L.dataLabel[ba]()}if(L.legendItem){M.legend.colorizeItem(L,a9)}},slice:function(bb,bc){var L=this,M=L.series,ba=M.chart,a9=L.slicedTranslation;bc=b(bc,true);bb=L.sliced=h(bb)?bb:!L.sliced;L.group.animate({translateX:(bb?a9[0]:ba.plotLeft),translateY:(bb?a9[1]:ba.plotTop)},100)}});var j=J(aa,{type:"pie",isCartesian:false,pointClass:aB,pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color"},getColor:function(){this.initialColor=aG
},translate:function(){var bl=0,bb=this,bn=-0.25,bk=bb.options,bc=bk.slicedOffset,bf=bk.center,bh=bb.chart,bj=bh.plotWidth,M=bh.plotHeight,a9,bd,ba,be=bb.data,L=2*R.PI,bm,bi=X(bj,M),bg;bf.push(bk.size,bk.innerSize||0);bf=t(bf,function(bo,bp){bg=/%$/.test(bo);return bg?[bj,M,bi,bi][bp]*parseInt(bo,10)/100:bo});a8(be,function(bo){bl+=bo.y});a8(be,function(bo){bm=bl?bo.y/bl:0;a9=bn*L;bn+=bm;bd=bn*L;bo.shapeType="arc";bo.shapeArgs={x:bf[0],y:bf[1],r:bf[2]/2,innerR:bf[3]/2,start:a9,end:bd};ba=(bd+a9)/2;bo.slicedTranslation=t([aO(ba)*bc+bh.plotLeft,z(ba)*bc+bh.plotTop],w);bo.tooltipPos=[bf[0]+aO(ba)*bf[2]*0.35,bf[1]+z(ba)*bf[2]*0.35];bo.percentage=bm*100;bo.total=bl});this.setTooltipPoints()},render:function(){var L=this;L.getAttribs();this.drawPoints();if(L.options.enableMouseTracking!==false){L.drawTracker()}this.drawDataLabels();L.isDirty=false},drawPoints:function(){var a9=this,ba=a9.chart,L=ba.renderer,bc,bb,M;a8(a9.data,function(bd){bb=bd.graphic;M=bd.shapeArgs;if(!bd.group){bc=bd.sliced?bd.slicedTranslation:[ba.plotLeft,ba.plotTop];bd.group=L.g("point").attr({zIndex:3}).add().translate(bc[0],bc[1])}if(bb){bb.attr(M)}else{bd.graphic=L.arc(M).attr(bd.pointAttr[aC]).add(bd.group)}if(bd.visible===false){bd.setVisible(false)}})},drawTracker:P.prototype.drawTracker,getSymbol:function(){}});p.pie=j;ax.Highcharts={Chart:a3,dateFormat:at,getOptions:aN,numberFormat:g,Point:f,Renderer:T,seriesTypes:p,setOptions:av,Series:aa,addEvent:aw,createElement:al,discardElement:Q,css:ar,each:a8,extend:Y,map:t,merge:y,pick:b,extendClass:J}})();Ext.ux.HighChart=Ext.extend(Ext.BoxComponent,{defaultSerieType:null,resizable:true,updateDelay:0,loadMask:false,addSeries:function(b,g){g=(g==null)?true:false;var j=new Array(),h=new Array(),a,f;for(var d=0;d<b.length;d++){var e=b[d];if(!e.serieCls){if(e.type!=null||this.defaultSerieType!=null){a=Ext.ux.HighChart.Series.get(e.type!=null?e.type:this.defaultSerieType)}else{a=Ext.ux.HighChart.Serie}f=new a(e)}else{f=e}h.push(f.config);j.push(f)}if(this.chart){if(!g){this.removeAllSeries();this.series=j;this.chartConfig.series=h}else{this.chartConfig.series=this.chartConfig.series?this.chartConfig.series.concat(h):h;this.series=this.series?this.series.concat(j):j}for(var d=0;d<h.length;d++){this.chart.addSeries(h[d],true)}this.refresh()}else{if(g){this.chartConfig.series=this.chartConfig.series?this.chartConfig.series.concat(h):h;this.series=this.series?this.series.concat(j):j}else{this.chartConfig.series=h;this.series=j}}},removeSerie:function(b,a){a=a||true;if(this.chart){this.chart.series[b].remove(a);this.chartConfig.series.splice(b,1)}this.series.splice(b,1)},removeAllSeries:function(){var b=this.series.length;for(var a=0;a<b;a++){this.removeSerie(0)}},setTitle:function(a){if(this.chartConfig.title){this.chartConfig.title.text=a}else{this.chartConfig.title={text:a}}if(this.chart&&this.chart.container){this.draw()}},setSubTitle:function(a){if(this.chartConfig.subtitle){this.chartConfig.subtitle.text=a}else{this.chartConfig.subtitle={text:a}}if(this.chart&&this.chart.container){this.draw()}},initComponent:function(){if(this.store){this.store=Ext.StoreMgr.lookup(this.store)}Ext.ux.HighChart.superclass.initComponent.call(this)},initEvents:function(){if(this.loadMask){this.loadMask=new Ext.LoadMask(this.el,Ext.apply({store:this.store},this.loadMask))}},afterRender:function(){if(this.store){this.bindStore(this.store,true)}Ext.ux.HighChart.superclass.afterRender.call(this);this.bindComponent(true);Ext.applyIf(this.chartConfig.chart,{renderTo:this.el.dom});Ext.applyIf(this.chartConfig,{xAxis:[{}]});if(this.xField&&this.store){this.updatexAxisData()}if(this.series){this.addSeries(this.series,false)}else{this.series=[]}this.initEvents();this.update(500)},onMove:function(){},draw:function(){if(this.chart&&this.rendered){if(this.resizable){for(var a=0;a<this.series.length;a++){this.series[a].visible=this.chart.series[a].visible}this.chart.destroy();delete this.chart;this.chart=new Highcharts.Chart(this.chartConfig)}}else{if(this.rendered){this.chart=new Highcharts.Chart(this.chartConfig)}}for(a=0;a<this.series.length;a++){if(!this.series[a].visible){this.chart.series[a].hide()}}this.refresh()},onContainerResize:function(){this.draw()},updatexAxisData:function(){var c=[],a=this.store.data.items;if(this.xField&&this.store){for(var b=0;b<a.length;b++){c.push(a[b].data[this.xField])}if(this.chart){this.chart.xAxis[0].setCategories(c,true)}else{this.chartConfig.xAxis[0].categories=c}}},bindComponent:function(c){var b=function(d){if(d.ownerCt){return b(d.ownerCt)}else{return d}};var a=b(this);if(c){a.on("move",this.onMove,this);if(this.ownerCt){this.ownerCt.on("render",this.update,this)}}else{if(this.ownerCt){this.ownerCt.un("render",this.update,this)}a.un("move",this.onMove,this)}},bindStore:function(a,b){if(!b&&this.store){if(a!==this.store&&this.store.autoDestroy){this.store.destroy()}else{this.store.un("datachanged",this.onDataChange,this);this.store.un("load",this.onLoad,this);this.store.un("add",this.onAdd,this);this.store.un("remove",this.onRemove,this);this.store.un("update",this.onUpdate,this);this.store.un("clear",this.onClear,this)}}if(a){a=Ext.StoreMgr.lookup(a);a.on({scope:this,load:this.onLoad,datachanged:this.onDataChange,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,clear:this.onClear})}this.store=a;if(a&&!b){this.refresh()}},refresh:function(){if(this.store&&this.chart){var d=new Array(),b=this.chart.series.length,c;for(c=0;c<b;c++){d.push(new Array())}var f=this.store.data.items;var g=[];for(var h=0;h<f.length;h++){var a=f[h];
if(this.xField){g.push(a.data[this.xField])}for(c=0;c<b;c++){var e=this.series[c],j;if((e.type=="pie"&&e.useTotals)){if(h==0){e.clear()}j=e.getData(a,h)}else{j=e.getData(a,h);d[c].push(j)}}}for(c=0;c<b;c++){if(this.series[c].useTotals){this.chart.series[c].setData(this.series[c].getTotals())}else{if(d[c].length>0){this.chart.series[c].setData(d[c],(c==(b-1)))}}}if(this.xField){this.updatexAxisData()}}},refreshRow:function(e){var b=this.store.indexOf(e);if(this.chart){for(var c=0;c<this.chart.series.length;c++){var d=this.chart.series[c];var a=this.series[c].getData(e,b);if(this.series[c].type=="pie"&&this.series[c].useTotals){this.series[c].update(e);this.chart.series[c].setData(this.series[c].getTotals())}else{d.data[b].update(a)}}if(this.xField){this.updatexAxisData()}}},update:function(b){var a=b||this.updateDelay;if(!this.updateTask){this.updateTask=new Ext.util.DelayedTask(this.draw,this)}this.updateTask.delay(a)},onDataChange:function(){this.refresh()},onClear:function(){this.refresh()},onUpdate:function(b,a){this.refreshRow(a)},onAdd:function(a,b,f){var j=false,g=[];for(var d=0;d<b.length;d++){var c=b[d];if(d==b.length-1){j=true}if(this.xField){g.push(c.data[this.xField])}for(var h=0;h<this.chart.series.length;h++){var e=this.chart.series[h],l=this.series[h];var k=l.getData(c,f+d);if(!(l.type=="pie"&&l.useTotals)){e.addPoint(k,j)}}}if(this.xField){this.chart.xAxis[0].setCategories(g,true)}},onResize:function(){Ext.ux.HighChart.superclass.onResize.call(this);this.update()},onRemove:function(f,e,b,a){for(var c=0;c<this.series.length;c++){var d=this.series[c];if(d.type=="pie"&&d.useTotals){d.removeData(e,b);this.chart.series[c].setData(d.getTotals())}else{this.chart.series[c].data[b].remove(true)}}Ext.each(this.chart.series,function(g){g.data[b].remove(true)});if(this.xField){this.updatexAxisData()}},onLoad:function(){this.refresh()},destroy:function(){delete this.series;if(this.chart){this.chart.destroy();delete this.chart}this.bindStore(null);this.bindComponent(null);Ext.ux.HighChart.superclass.destroy.call(this)}});Ext.reg("highchart",Ext.ux.HighChart);Ext.ux.HighChart.Series=function(){var a=new Array(),b=new Array();return{reg:function(d,c){a.push(c);b.push(d)},get:function(c){return a[b.indexOf(c)]}}}();Ext.ux.HighChart.Serie=function(a){a.type=this.type;if(!a.data){a.data=[]}Ext.apply(this,a);this.config=a};Ext.ux.HighChart.Serie.prototype={type:null,xField:null,yField:null,visible:true,clear:Ext.emptyFn,getData:function(e,d){var c=this.yField||this.dataIndex,b=this.xField,a={data:e.data,y:e.data[c]};if(b){a.x=e.data[b]}return a},serieCls:true};Ext.ux.HighChart.SplineSerie=Ext.extend(Ext.ux.HighChart.Serie,{type:"spline"});Ext.ux.HighChart.Series.reg("spline",Ext.ux.HighChart.SplineSerie);Ext.ux.HighChart.ColumnSerie=Ext.extend(Ext.ux.HighChart.Serie,{type:"column"});Ext.ux.HighChart.Series.reg("column",Ext.ux.HighChart.ColumnSerie);Ext.ux.HighChart.BarSerie=Ext.extend(Ext.ux.HighChart.Serie,{type:"bar"});Ext.ux.HighChart.Series.reg("bar",Ext.ux.HighChart.BarSerie);Ext.ux.HighChart.LineSerie=Ext.extend(Ext.ux.HighChart.Serie,{type:"line"});Ext.ux.HighChart.Series.reg("line",Ext.ux.HighChart.LineSerie);Ext.ux.HighChart.AreaSerie=Ext.extend(Ext.ux.HighChart.Serie,{type:"area"});Ext.ux.HighChart.Series.reg("area",Ext.ux.HighChart.AreaSerie);Ext.ux.HighChart.AreaSplineSerie=Ext.extend(Ext.ux.HighChart.Serie,{type:"areaspline"});Ext.ux.HighChart.Series.reg("areaspline",Ext.ux.HighChart.AreaSplineSerie);Ext.ux.HighChart.ScatterSerie=Ext.extend(Ext.ux.HighChart.Serie,{type:"scatter"});Ext.ux.HighChart.Series.reg("scatter",Ext.ux.HighChart.ScatterSerie);Ext.ux.HighChart.PieSerie=Ext.extend(Ext.ux.HighChart.Serie,{type:"pie",categorieField:null,dataField:null,useTotals:false,columns:[],constructor:function(c){Ext.ux.HighChart.PieSerie.superclass.constructor.apply(this,arguments);if(this.useTotals){this.columnData={};var a=this.columns.length;for(var b=0;b<a;b++){this.columnData[this.columns[b]]=100/a}}},addData:function(b){for(var a=0;
a<this.columns.length;a++){var d=this.columns[a];this.columnData[d]=this.columnData[d]+b.data[d]}},update:function(b){for(var a=0;a<this.columns.length;a++){var d=this.columns[a];if(b.modified[d]){this.columnData[d]=this.columnData[d]+b.data[d]-b.modified[d]}}},removeData:function(d,a){for(var b=0;b<this.columns.length;b++){var e=this.columns[b];this.columnData[e]=this.columnData[e]-d.data[e]}},clear:function(){for(var a=0;a<this.columns.length;a++){var b=this.columns[a];this.columnData[b]=0}},getData:function(b,a){if(this.useTotals){this.addData(b);return[]}return[b.data[this.categorieField],b.data[this.dataField]]},getTotals:function(){var b=new Array();for(var d=0;d<this.columns.length;d++){var e=this.columns[d];b.push([e,this.columnData[e]])}return b}});Ext.ux.HighChart.Series.reg("pie",Ext.ux.HighChart.PieSerie);(function(){var table={};window.unitConverter=function(value,unit){this.value=value;if(unit){this.currentUnit=unit}};unitConverter.prototype.as=function(targetUnit){this.targetUnit=targetUnit;return this};unitConverter.prototype.is=function(currentUnit){this.currentUnit=currentUnit;return this};unitConverter.prototype.val=function(){var val;var target;var current;var flipMultiplier=false;var curUnit=escape(this.currentUnit);var tarUnit=escape(this.targetUnit);if(table[this.targetUnit]!=undefined){current=table[tarUnit];target=current[curUnit];current=current[tarUnit]}else{current=table[curUnit];target=current[tarUnit];current=current[curUnit];flipMultiplier=true}if(target.conversionFunc==undefined){if(flipMultiplier){val=this.value*(target.multiplier/current.multiplier)}else{val=this.value*(current.multiplier/target.multiplier)}}else{var func=target.conversionFunc.replace("{value}",this.value);val=eval(func)}return(val)};unitConverter.prototype.toString=function(){return this.val()+" "+this.targetUnit};unitConverter.prototype.debug=function(){return this.value+" "+this.currentUnit+" is "+this.val()+" "+this.targetUnit};unitConverter.addUnit=function(baseUnit,actualUnit,multiplier){var toUnits;if(table[baseUnit]==undefined){table[baseUnit]={}}toUnits=table[baseUnit];if(typeof(multiplier)=="number"){toUnits[actualUnit]={multiplier:multiplier}}else{if(typeof(multiplier)=="string"){toUnits[actualUnit]={conversionFunc:multiplier}}}table[baseUnit]=toUnits};var prefixes=["Y","Z","E","P","T","G","M","k","h","da","","d","c","m","u","n","p","f","a","z","y"];var factors=[24,21,18,15,12,9,6,3,2,1,0,-1,-2,-3,-6,-9,-12,-15,-18,-21,-24];var units=["m"];for(var j=0;j<units.length;j++){var base=units[j];for(var i=0;i<prefixes.length;i++){unitConverter.addUnit(base,prefixes[i]+base,Math.pow(10,factors[i]))}}unitConverter.addUnit("celsius","celsius",1);unitConverter.addUnit("celsius","fahrenheit","{value}*9/5+32");unitConverter.addUnit("celsius","%B0F","{value}*9/5+32");unitConverter.addUnit("mb","mb",1);unitConverter.addUnit("mb","inches mercury",0.0295);unitConverter.addUnit("m_s-1","m_s-1",1);unitConverter.addUnit("m_s-1","cm_s-1",0.01);unitConverter.addUnit("mm_s-1","mm_s-1",0.1);unitConverter.addUnit("mm_s-1","cm_s-1",0.1);unitConverter.addUnit("m_s-1","knots",1.9438444925);unitConverter.addUnit("m_s-1","mph",2.2369362921);unitConverter.addUnit("cm_s-1","mph",0.022369362921);unitConverter.addUnit("mm","inch",0.039);unitConverter.addUnit("m","ft",3.28);window.$unitConversion=function(value,unit){var unitConversion=new window.unitConverter(value,unit);return unitConversion}})();function typeOfEx(b){var a=typeof b;if(a==="object"){if(b){if(typeof b.length==="number"&&!(b.propertyIsEnumerable("length"))&&typeof b.splice==="function"){a="array"}}else{a="null"}}return a}var Base=function(){};Base.extend=function(b,f){var e=Base.prototype.extend;Base._prototyping=true;var d=new this;e.call(d,b);d.base=function(){};delete Base._prototyping;var c=d.constructor;var a=d.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==a){this._constructing=true;c.apply(this,arguments);delete this._constructing}else{if(arguments[0]!=null){return(arguments[0].extend||e).call(arguments[0],d)}}}};a.ancestor=this;a.extend=this.extend;a.forEach=this.forEach;a.implement=this.implement;a.prototype=d;a.toString=this.toString;a.valueOf=function(g){return(g=="object")?a:c.valueOf()};e.call(a,f);if(typeof a.init=="function"){a.init()}return a};Base.prototype={extend:function(f,h){if(arguments.length>1){var c=this[f];if(c&&(typeof h=="function")&&(!c.valueOf||c.valueOf()!=h.valueOf())&&/\bbase\b/.test(h)){var g=h.valueOf();h=function(){var i=this.base||Base.prototype.base;this.base=c;var k=g.apply(this,arguments);this.base=i;return k};h.valueOf=function(i){return(i=="object")?h:g};h.toString=Base.toString}this[f]=h}else{if(f){var a=Base.prototype.extend;if(!Base._prototyping&&typeof this!="function"){a=this.extend||a}var e={toSource:null};var b=["constructor","toString","valueOf"];var d=Base._prototyping?0:1;while(j=b[d++]){if(f[j]!=e[j]){a.call(this,j,f[j])}}for(var j in f){if(!e[j]){a.call(this,j,f[j])}}}}return this}};Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(c,d,b){for(var a in c){if(this.prototype[a]===undefined){d.call(b,c[a],a,c)}}},implement:function(){for(var a=0;a<arguments.length;a++){if(typeof arguments[a]=="function"){arguments[a](this.prototype)}else{this.prototype.extend(arguments[a])}}return this},toString:function(){return String(this.valueOf())}});googleAnalytics=Base.extend({trackerId:"",tracker:null,constructor:function(a){this.trackerId=a},getTracker:function(){try{this.tracker=_gat._getTracker(this.trackerId);return(this.tracker)}catch(a){if(console!==undefined){console.exception(a)}}return(null)},trackEvent:function(e,a,c,b){try{this.tracker._trackEvent(e,a,c,b);return(true)}catch(d){if(console!==undefined){console.exception(d)}}return(false)},recordOutboundLink:function(c,b,a){this.trackEvent(b,a);setTimeout('document.location = "'+c.href+'"',100)},trackPageView:function(){try{this.tracker._trackPageview();this.tracker._setVar("<? echo $var_uservar ?>")}catch(a){if(console!==undefined){console.exception(a)}}}});Ext.namespace("rcoosmapping");GeoExt.Popup.prototype.getState=function(){return null};rcoosmapping.lookupTable=Ext.extend(Ext.data.Record,{obsTypes:null,uomTypes:null,organization:null,dataUrl:null,iconUrls:null,platformTypes:null,constructor:function(a){if(a.data.lookups.obs_type!==undefined){this.obsType=a.data.lookups.obs_type}if(a.data.lookups.uom_type!==undefined){this.uomTypes=a.data.lookups.uom_type}if(a.data.lookups.organization!==undefined){this.organization=a.data.lookups.organization}if(a.data.lookups.data_url!==undefined){this.dataUrl=a.data.lookups.data_url}if(a.data.lookups.icon_urls!==undefined){this.iconUrls=a.data.lookups.icon_urls}if(a.data.lookups.type_list!==undefined){this.platformTypes=a.data.lookups.type_list}rcoosmapping.lookupTable.superclass.constructor.call(this,a)},getDisplayIconURL:function(b){var a;if(this.iconUrls.icons[b]!==undefined){a=this.iconUrls.icons[b]}return(a)},getObsName:function(a){var b;if(this.obsType[a]!==undefined){b=this.obsType[a].standard_name}return(b)},getObsDisplayName:function(a){var b;if(this.obsType[a]!==undefined){b=this.obsType[a].display}return(b)},getObsID:function(b){for(var a in this.obsType){if(this.obsType[a].display==b||this.obsType[a].standard_name==b){return(a)}}return(undefined)},getUOMName:function(c,b){var a;if(this.uomTypes[c]!==undefined){if(b){a=this.uomTypes[c].imperial}else{a=this.uomTypes[c].display}if(a===undefined||a.length===0){a=this.uomTypes[c].display}}return(a)},getNativeUOMName:function(b){var a;if(this.uomTypes[b]!==undefined){a=this.uomTypes[b].standard_name}return(a)},getImperialUOMName:function(c){var b;for(var a in this.uomTypes){if(this.uomTypes[a].standard_name==c){b=this.uomTypes[a].imperial;break}}return(b)},getOrganizationName:function(b){var a;if(this.organization[b]!==undefined){a=this.organization[b].short_name}return(a)},getOrganizationID:function(b){for(var a in this.organization){if(this.organization[a].short_name==b){return(a)}}return(undefined)},getOrganizationURL:function(a){var b;if(this.organization[a]!==undefined){b=this.organization[a].url}return(b)},getDataURL:function(b){var a;if(this.dataUrl[b]!==undefined){a=this.dataUrl[b].url}return(a)},getDataURLType:function(b){var a;if(this.dataUrl[b]!==undefined){a=this.dataUrl[b].type}return(a)},getDataURLTooltip:function(a){var b;if(this.dataUrl[a]!==undefined){b=this.dataUrl[a].tip}return(b)},getPlatformTypeName:function(b){var a;if(this.platformTypes[b]!==undefined){a=this.platformTypes[b].type_name}return(a)}});rcoosmapping.observationsObj=Ext.extend(Ext.data.JsonStore,{lookupTable:null,constructor:function(a){if(a===undefined){a={}}a.autoDestroy=true;a.root="features";a.idProperty=function(c){var b=c.properties.obsType+":"+c.properties.sorder+":"+c.properties.uomType;return(b)};this.lookupTable=a.lookupTable;a.fields=[{name:"type",mapping:"type"},{name:"geometryType",mapping:"geometry.type"},{name:"geometryCoords",mapping:"geometry.coordinates"},{name:"obsType",mapping:"properties.obsType"},{name:"uomType",mapping:"properties.uomType"},{name:"times",mapping:"properties.time"},{name:"values",mapping:"properties.value"},{name:"sorder",mapping:"properties.sorder"},{name:"qc_levels",mapping:"properties.qc_level"}];rcoosmapping.observationsObj.superclass.constructor.call(this,a)},getValues:function(b,g){var f;var h=this.getById(b);if(h!==undefined){f=h.get("values");var e;for(e=0;e<f.length;e++){if(f[e].length){f[e]=Number(f[e]);if(g){var d=h.get("uomType");var a=this.lookupTable.getImperialUOMName(d);if(a!==undefined&&a.length){var c=this.convertValue(f[e],d,a);if(c){f[e]=c}}}}}}return(f)},getLatestValue:function(b,e){var f;var g=this.getById(b);if(g!==undefined){values=g.get("values");f=Number(values[values.length-1]);if(e){var d=g.get("uomType");var a=this.lookupTable.getImperialUOMName(d);if(a!==undefined&&a.length){var c=this.convertValue(f,d,a);if(c){f=c}}}}return(f)},getLatestQCLevel:function(a){var c;var d=this.getById(a);if(d!==undefined){var b=d.get("qc_levels");if(b!==null){c=Number(b[b.length-1])
}}return(c)},getQCLevels:function(a){var c;var d=this.getById(a);if(d!==undefined){c=d.get("qc_levels");if(c!==null){var b;for(b=0;b<c.length;b++){c[b]=Number(c[b])}}}return(c)},convertValue:function(d,c,a){var b=window.$unitConversion(d,c).as(a).val();return(b)},getTimes:function(a){var c;var b=this.getById(a);if(b!==undefined){c=b.get("times")}return(c)},getLatestTime:function(a){var b=this.getTimes(a);if(b!==undefined){return(b[b.length-1])}return(undefined)},getObsTimeSeries:function(a,d){var e=[];var f=this.getTimes(a);var c=this.getValues(a,d);if(f!==undefined&&c!==undefined){var b;for(b=0;b<f.length;b++){e[b]=[f[b],Number(c[b])]}}return(e)}});rcoosmapping.timeSeriesGraph=Ext.extend(Ext.ux.HighChart,{initComponent:function(){rcoosmapping.timeSeriesGraph.superclass.initComponent.call(this)},addTimeSeries:function(k,a,l,j,b){if(this.chart===undefined){this.chart=new Highcharts.Chart(this.chartConfig)}var h=[];var g;for(g=0;g<l.length;g++){var d=l[g][0];var f=d.replace(" ","T");f=Date.parseDate(d,"c");h[g]=f.format("Y-m-d<br/>H:i:s")}this.chart.xAxis[0].setCategories(h);var e=[{type:"line",name:k,data:l}];this.addSeries(e,true);var c=this.chart.yAxis[0];c.options.title.text=k+"("+a+")";c.axisTitle.destroy();c.axisTitle=null;c.hasRenderedTitle=false;c.redraw()}});rcoosmapping.insitu=Ext.extend(Ext.Panel,{feature:null,obsStore:null,selectControl:null,googAnalytics:null,initComponent:function(){this.id="Observations";this.title="Observations";this.layout="border";var b=this.buildHeaderPanel(this.feature);var c=this.buildToolbar();this.bbar=[c];var a=new Ext.Panel({id:"dataPanel",region:"center",width:500,height:100,margins:"1 1 1 1",layout:"border"});this.buildDataPanels(a,this.feature);this.items=[b,a];rcoosmapping.insitu.superclass.initComponent.call(this)},destroy:function(){if(this.obsStore!==null){this.obsStore.removeAll()}var c=this.findById("dataPanel");if(c!==null){var b=c.findById("currentObs");if(b!==null){b.store.removeAll()}}var a=this.feature.get("feature");this.selectControl.unselect(a)},buildToolbar:function(){var c=this.feature.get("lookupTable");var b=this.feature.get("links");var d=[];var a;for(a in b){d.push({id:a,type:"button",tooltip:c.getDataURLTooltip(b[a].urlId),tooltipType:"title",icon:c.getDisplayIconURL(b[a].iconId),listeners:{click:function(g,j){var h=this.feature.get("lookupTable");var e=this.feature.get("links");var f=h.getDataURL(e[g.id].urlId)+e[g.id].id;window.open(f);if(this.googAnalytics!==null){this.googAnalytics.trackEvent("Interactive Map Platforms",g.id,this.feature.get("staID"))}},scope:this}})}return(d)},setObsData:function(n){var k=false;if(n!==undefined){k=true;if(this.obsStore!==null){this.obsStore.removeAll()}var v=this.feature.get("lookupTable");this.obsStore=new rcoosmapping.observationsObj({data:n,lookupTable:v});var e=this.findById("dataPanel");if(e!==null){var o=e.findById("currentObs");if(o!==null){var b=o.getStore();b.remove();var z=null;var y=[];var g=this.feature.get("staObs");if(g.length){var u;for(u=0;u<g.length;u++){var w=g[u];var m=v.getObsName(w.Properties.obsTypeDesc);var s=v.getObsDisplayName(w.Properties.obsTypeDesc);if(s===undefined||(s.length===0)){s=m}var a=v.getNativeUOMName(w.Properties.uomID,true);var p=w.Properties.sorder;var A=m+":"+p+":"+a;var q=this.obsStore.getLatestValue(A,true);if(q!==undefined){q=q.toFixed(2)}else{q=""}var l=this.obsStore.getLatestQCLevel(A);var x=v.getUOMName(w.Properties.uomID,true);var j=Ext.data.Record.create([{name:"obsName",mapping:"obsName"},{name:"obsDisplayName",mapping:"obsDisplayName"},{name:"value",mapping:"value",type:"float"},{name:"uomName",mapping:"uomName"},{name:"dbUomName",mapping:"dbUomName"},{name:"sorder",mapping:"sorder"},{name:"qcLevel",mapping:"qcLevel"}]);var r=new j({obsName:m,obsDisplayName:s,value:q,uomName:x,dbUomName:a,sorder:p,qcLevel:l});b.add(r);if(z===null){var d=this.obsStore.getLatestTime(A);if(d!==undefined){z=d.replace(" ","T");z=Date.parseDate(z,"c");var c=e.findById("currentObsTime");if(c!==null){c.update({loading:false,time:z})
}var f=e.findById("obsGraphPanel");if(f!==null){var t=this.obsStore.getObsTimeSeries(A,true);f.addTimeSeries(s,x,t,false)}}}}}else{k=false}o.selectRange(0,0,false)}}}if(k===false){var e=this.findById("dataPanel");if(e!==null){var c=e.findById("currentObsTime");if(c!==null){var h={loading:false,time:null};c.update(h)}}}},buildHeaderPanel:function(b){var a=new Ext.XTemplate("<div>",'<table width="100%" class="layoutAssistant"><tbody>','<tr><td class="default"><p class="markerHead"><a target="_blank" href="{[values.get("staURL")]}">Station {[values.get("staID")]}</a></p></td></tr>',"</tbody></table>",'<div class="area markerVSpace"><table width="100%" class="layoutAssistant"><tbody>','<tr><td class="default"><p class="region"><b>Location: </b>{[values.get("staDesc")]}</p></td><td style="padding-left: 8px;" class="default aright"><p class="latLon aright"><b>Lat:</b> {[values.get("lat")]} <b>Lon:</b> {[values.get("lon")]}</p></td></tr></tbody></table>','<p class="provider"><b>Provider:</b> <a target="_blank" href="{[values.get("lookupTable").getOrganizationURL(values.get("orgName"))]}" class="iwa">{[values.get("lookupTable").getOrganizationName(values.get("orgName"))]}</a><b>Data Source:</b> {[values.get("lookupTable").getOrganizationName(values.get("orgName"))]}</p>','<tpl if="this.checkStatus(values)"><table width="100%" class="layoutAssistant">','<tbody><tr><td class="default"><p class="platformIssue"><b>Issue:</b> {[values.get("status")["begin_date"]]} {[values.get("status")["reason"]]}<p></td></tr></tbody></table></tpl>',"</div>","</div>",{checkStatus:function(d){var e=d.get("status");if(e===null){return(false)}return(true)}});var c={region:"north",layout:"fit",margins:"1 1 1 1",width:500,height:"auto",tpl:a,data:b,listeners:{render:function(d){d.tpl.overwrite(this.body,this.data)}}};return(c)},buildDataPanels:function(f,c){var g=null;var e=null;var b=null;if(f!==null){g=new Ext.XTemplate('<div class="markerMeasurements">','<table class="layoutAssistant chart" align="left"><tbody>','<tpl for=".">','<tr class="chartButton thumb-wrap"><td class="chartButtonL"><b>{obsDisplayName}</b></td><td class="chartButtonM">{value}</td><td class="chartButtonR">{uomName}</td></tr>',"</tpl>","</tbody></table>","</div>");var d=new Ext.data.Store();var b=new Ext.DataView({id:"currentObs",cls:"area obs-panel-body",region:"center",layout:"fit",emptyText:"Loading data",store:d,data:c,width:250,height:200,margins:"1 1 1 1",tpl:g,autoScroll:true,singleSelect:true,overClass:"x-view-over",itemSelector:"tr.thumb-wrap",listeners:{click:this.obsClicked}});e=new Ext.XTemplate('<div style="padding: 2px;" class="updateInfo">','<table align="center" class="layoutAssistant"><tbody>',"<tr>",'<tpl if="values.loading"><td class="default vcenter"><div id="loading-mask"></div><div id="loading"><div class="loading-indicator"><b>Loading...</b></div></div></td></tpl>','<tpl if="values.loading == false">','<td class="default vcenter"><img width="18" height="18" border="0" src={[this.getDataAgeIcon(values.time)]} style="margin-right: 5px;"></td>','<td class="default vcenter"><p style="padding: 0px;" class="updateInfo"><b><span class="updateInfo">Data Updated: </span></b><span class="updateInfo">{[this.getTimeString(values.time)]}</span></p></td></tr>',"</tbody></table>","</tpl>","</div>",{getDataAgeIcon:function(l){var j="./resources/images/data_age/";if(l!==null){var k=new Date();var n=k.getElapsed(l);var m=3600000;if(n<=m){j+="icon_0-1.png"}else{if((n>m)&&(n<=(2*m))){j+="icon_1-2.png"}else{if((n>(2*m))&&(n<(3*m))){j+="icon_2-3.png"}else{if((n>(3*m))&&(n<(4*m))){j+="icon_3-4.png"}else{if((n>(4*m))&&(n<(12*m))){j+="icon_10-11.png"}else{j+="icon_12+.png"}}}}}}else{j+="icon_no_data.png"}return(j)},getTimeString:function(k){var j="No Data Available";if(k!==null){j=k.format("Y-m-d H:i:s")}return(j)}});var h=new Ext.Panel({id:"currentObsTime",bodyCssClass:"area",region:"north",layout:"fit",margins:"1 1 1 1",width:500,height:25,html:"",tpl:e,listeners:{render:function(j){var k=null;
if(this.data===undefined){k={loading:true}}j.tpl.overwrite(this.body,k)}}});var a=new rcoosmapping.timeSeriesGraph({id:"obsGraphPanel",region:"east",layout:"fit",width:250,height:200,chartConfig:{chart:{defaultSeriesType:"line",backgroundColor:"#FFFFFF",margin:[10,30,40,60]},plotOptions:{line:{color:"#000000",lineWidth:1,marker:{radius:2}}},title:{text:"Observation Graph",style:{color:"#000000",fontSize:"11px"}},subtitle:{text:"",style:{color:"#000000",fontSize:"8px"}},tooltip:{formatter:function(){var k=this.point.name;updateTime=k.replace(" ","T");updateTime=Date.parseDate(updateTime,"c");updateTime=updateTime.format("m-d H:i:s");var j="Date: "+updateTime+"<br>Value: "+this.y.toFixed(2);return j}},legend:{enabled:false},xAxis:[{endOnTick:true,maxPadding:0,minPadding:0,showLastLabel:true,labels:{align:"center",style:{font:"10px tahoma,arial,helvetica,sans-serif",color:"#000000"},formatter:function(){if(this.isFirst||this.isLast){return(this.value)}}}}],yAxis:[{maxPadding:0,minPadding:0,title:{text:" ",style:{font:"10px tahoma,arial,helvetica,sans-serif",color:"#000000"}},labels:{style:{font:"10px tahoma,arial,helvetica,sans-serif",color:"#000000"}}}]}});f.add(h);f.add(b);f.add(a)}return(f)},obsClicked:function(g,e,b,f){var d=g.ownerCt;if(d!==null){var l=d.ownerCt;if(l!==null){var c=g.store.getAt(e);if(c!==null){var n=c.get("obsName");var k=c.get("dbUomName");var a=c.get("sorder");var j=d.findById("obsGraphPanel");if(j!==null){var h=n+":"+a+":"+k;var m=l.obsStore.getObsTimeSeries(h,true);j.addTimeSeries(c.get("obsDisplayName"),c.get("uomName"),m,false)}}}}}});rcoosmapping.popup=Ext.extend(GeoExt.Popup,{feature:null,selectControl:null,googAnalytics:null,initComponent:function(){this.listeners={afterrender:this.afterrender};rcoosmapping.popup.superclass.initComponent.call(this)},afterrender:function(){var b=new Ext.TabPanel({resizeTabs:true,width:this.getInnerWidth(),height:this.getInnerHeight(),id:"tabPanel",activeTab:0});this.add(b);var a=new rcoosmapping.insitu({itemId:"insituPanel",feature:this.feature,selectControl:this.selectControl,googAnalytics:this.googAnalytics});b.add(a)},setObsData:function(c){var d=this.findById("tabPanel");if(d!==null){for(var a=0;a<d.items.length;a++){var b=d.items.get(a);if(b.setObsData!==undefined){b.setObsData(c)}}}}});rcoosmapping.featureFilterPanel=Ext.extend(Ext.FormPanel,{layers:[],lookupTable:null,initComponent:function(){this.listeners={checkboxgroupchange:this.checkBoxChange};rcoosmapping.featureFilterPanel.superclass.initComponent.call(this)},addFilterGroup:function(a,c,d){var b=new Ext.form.FieldSet({id:c+"filterSet",title:d,autoHeight:true,autoWidth:true,layout:"fit",collapsed:false,collapsible:true,bubbleEvents:["checkboxgroupchange"],listeners:{check:function(f,e){this.fireEvent("checkboxgroupchange",this.title,f,e)}},items:{id:c+"FilterGroup",xtype:"checkboxgroup",autoHeight:true,autoWidth:true,vertical:true,columns:2,items:a,bubbleEvents:["check"]}});b.addEvents("checkboxgroupchange");this.add(b)},checkBoxChange:function(k,j,a){if(this.lookupTable!==null){var b;var c;var d=this.layers[0].strategies[0];var e=d.filter;var g=null;if(k=="Organizations"){b=this.lookupTable.getOrganizationID(j.boxLabel);c="orgName";g=e.filters[0]}else{if(k=="Observations"){b=this.lookupTable.getObsID(j.boxLabel);c="staObs.Properties.obsTypeDesc";g=e.filters[1]}}if(a){var h=new OpenLayers.Filter.ComparisonEx({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:c,value:b});g.filters.push(h)}else{for(var f=0;f<g.filters.length;f++){if(g.filters[f].value==b){g.filters.splice(f,1);break}}}if(e.filters[0].filters.length===0&&e.filters[1].filters.length===0){e.type=OpenLayers.Filter.Logical.OR}else{e.type=OpenLayers.Filter.Logical.AND}if(e.filters[0].filters.length===0){e.filters[0].type=OpenLayers.Filter.Logical.AND}else{e.filters[0].type=OpenLayers.Filter.Logical.OR}if(e.filters[1].filters.length===0){e.filters[1].type=OpenLayers.Filter.Logical.AND}else{e.filters[1].type=OpenLayers.Filter.Logical.OR}d.setFilter(d.filter)
}},addObservationGroup:function(a){var c=[];for(var b=0;b<a.length;b++){c.push({boxLabel:a[b],checked:false,name:"obs-cb-"+b,bubbleEvents:["check"]})}this.addFilterGroup(c,"obs","Observations")},addProvidersGroup:function(a){var b=[];for(var c=0;c<a.length;c++){b.push({boxLabel:a[c],checked:false,name:"org-cb-"+c,bubbleEvents:["check"]})}this.addFilterGroup(b,"orgs","Organizations")}});rcoosmapping.platformVectorLayer=Ext.extend(OpenLayers.Layer.Vector,{featureStore:null,lookupTable:null,selectControl:null,hoverControl:null,hoverTimeout:undefined,nfoPopup:undefined,mapObj:null,googAnalytics:null,featuresUrl:null,layerActive:null,parentPanel:null,constructor:function(b,a){if(a.lookups!==undefined){this.lookupTable=a.lookups}this.mapObj=a.map;this.googAnalytics=a.googAnalytics;if(a.layerOptions.featuresUrl!==undefined){this.featuresUrl=a.layerOptions.featuresUrl}this.layerActive=a.layerOptions.active;this.parentPanel=a.parentPanel;rcoosmapping.platformVectorLayer.superclass.constructor.call(this,b,a.layerOptions.options);if(a.platforms!==undefined){this.createFeatureStore(a.platforms);this.createSelectFeature(this.mapObj,this.layerActive)}if(this.mapObj!==undefined){this.mapObj.addLayer(this)}},createFilters:function(){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[]});var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[]});var b=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[c,a]});var d=new OpenLayers.Strategy.Filter({filter:b});d.setLayer(this);return([d])},createFilterPanel:function(){var f="westPanel-"+this.parentPanel.title;var e=this.parentPanel.findById(f);if(e!==null){var b=new rcoosmapping.featureFilterPanel({id:"filterPanel",title:"Filters",border:false,header:true,draggable:false,autoScroll:true,overflow:"auto",lookupTable:this.lookupTable,layers:[this]});var a=[];for(var d in this.lookupTable.organization){a.push(this.lookupTable.organization[d].short_name)}b.addProvidersGroup(a);a=[];for(var c in this.lookupTable.obsType){a.push(this.lookupTable.obsType[c].display)}b.addObservationGroup(a);e.insert(0,b);e.doLayout()}},getFeaturesData:function(a){url=this.featuresUrl;if(a!==undefined){url=a}Ext.Ajax.request({autoAbort:true,url:url,scope:this,scriptTag:true,callbackName:"json_callback",success:this.queryFeaturesSuccess,failure:function(c,b){alert("Failed to retrieve the platform data, cannot display platforms.");return}})},queryFeaturesSuccess:function(f,e){var d=Ext.util.JSON.decode(f.responseText);if(d.lookups!==undefined){var g={lookups:d.lookups};this.lookupTable=new rcoosmapping.lookupTable({root:"lookups",data:g});if(d.layers!==undefined){var b;for(b in d.layers){if(b=="vector"){var c;for(c in d.layers[b]){if(c=="insitu"){var a=d.layers[b][c].features;this.createFeatureStore(a);this.createSelectFeature(this.mapObj,this.layerActive);var h=this.createFilters();this.strategies=h;this.createFilterPanel()}}}}}}},createFeatureStore:function(b){var a=this.createFeatures(b);this.featureStore=new GeoExt.data.FeatureStore({autoLoad:true,reader:new GeoExt.data.FeatureReader({},[{name:"orgName",type:"integer"},{name:"staDataFile",type:"string"},{name:"staID",type:"string"},{name:"staDesc",type:"string"},{name:"staTypeImage",type:"integer"},{name:"staTypeId",type:"integer"},{name:"staURL",type:"string"},{name:"lat",type:"string"},{name:"lon",type:"string"},{name:"status",defaultValue:null},{name:"links"},{name:"staObs"},{name:"lookupTable"},{name:"obsDataObj"}]),data:a,layer:this,initDir:GeoExt.data.FeatureStore.STORE_TO_LAYER})},createFeatures:function(d){var g=[];for(i=0;i<d.length;i++){var h=d[i];var c=this.mapObj.projection.projCode;var e=c;if(this.mapObj.displayProjection!==undefined){e=this.mapObj.displayProjection.projCode}var b=rcoosmapping.utils.reprojectPoint(this.mapObj.displayProjection,c,h.geometry.coordinates[0],h.geometry.coordinates[1]);h.properties.lookupTable=this.lookupTable;h.properties.obsDataObj=null;h.properties.lon=h.geometry.coordinates[0];
h.properties.lat=h.geometry.coordinates[1];h.geometry.coordinates[0]=b.lon;h.geometry.coordinates[1]=b.lat;var f=new OpenLayers.Format.GeoJSON();var j=f.read(h);if(j.length){var a=this.lookupTable.getDisplayIconURL(h.properties.staTypeImage);if(a!==undefined){j[0].style={externalGraphic:a,graphicWidth:18,graphicHeight:18,graphicZIndex:1}}g[i]=j[0]}}return(g)},createSelectFeature:function(a,b){this.selectControl=new OpenLayers.Control.SelectFeature([this],{id:"insituclick",onSelect:this.onFeatureSelect,parentObj:this,scope:this,toggle:true});this.hoverControl=new OpenLayers.Control.SelectFeature([this],{id:"insituhover",hover:true,highlightOnly:true,renderIntent:"temporary",scope:this,eventListeners:{beforefeaturehighlighted:function(c){},featurehighlighted:function(c){var j=c.feature;j.style.cursor="pointer";if(this.toolTip!==undefined){this.toolTip.destroy();this.toolTip=undefined}var d=j.attributes.staID;var g="<table><tbody><tr><td>"+d+" (Click platform for details)</td></tr>";var l=j.geometry.getBounds().getCenterLonLat();var h=this.mapObj.getViewPortPxFromLonLat(l);var f=Ext.fly(this.mapObj.div).getBox();var k=this.featureStore.getRecordFromFeature(j);var e=k.get("status");if(e!==null){g+='<tr><td><p class="platformIssue"><b>Technical Issue with Buoy</b></p></td></tr>'}g+="</tbody></table>";this.toolTip=new Ext.ToolTip({id:"ToolTip",html:g,width:"auto",autoWidth:true,hideDelay:5000});this.toolTip.showAt([h.x+f.x+10,h.y+f.y-15]);if(this.hoverTimeout!==undefined){clearTimeout(this.hoverTimeout);this.hoverTimeout=undefined}thisObj=this;this.hoverTimeout=setTimeout(function(){thisObj.hoverData(thisObj,c)},500)},featureunhighlighted:function(d){if(this.hoverTimeout!==undefined){clearTimeout(this.hoverTimeout);this.hoverTimeout=undefined}if(this.toolTip!==undefined){this.toolTip.destroy();this.toolTip=undefined}var c=d.feature;delete c.style.cursor},scope:this}});this.hoverControl.handlers.feature.stopClick=false;this.hoverControl.handlers.feature.stopDown=false;a.addControl(this.hoverControl);a.addControl(this.selectControl);if(b){this.hoverControl.activate();this.selectControl.activate()}},hoverData:function(c,d){var b=d.feature;var e=c.lookupTable.getDataURL(b.attributes.staDataURL);var a=e+b.attributes.staDataFile;Ext.Ajax.request({autoAbort:true,url:a,scope:this,scriptTag:true,callbackName:"json_callback",extraParams:{feature:c.featureStore.getRecordFromFeature(b)},success:function(q,m){if(c.toolTip!==null){var n=null;var r=null;if(q.responseText){try{n=Ext.util.JSON.decode(q.responseText);var x=new rcoosmapping.observationsObj({data:{features:n.features},lookupTable:c.lookupTable});var E=null;var o=m.extraParams.feature.get("staObs");var k=m.extraParams.feature.get("staID");var p="<table><tbody><tr><td>"+k+" (Click platform for details)</td></tr>";var l;var f="";var B="";var A=m.extraParams.feature.get("status");if(A!==null){p+='<tr><td><p class="platformIssue"><b>Issue:</b> '+A.begin_date+" "+A.reason+"</p></td></tr>"}else{if(o.length){for(var y=0;y<o.length;y++){var z=o[y];var t=c.lookupTable.getObsName(z.Properties.obsTypeDesc);var w=c.lookupTable.getObsDisplayName(z.Properties.obsTypeDesc);if(w===undefined||(w.length===0)){w=t}var g=c.lookupTable.getNativeUOMName(z.Properties.uomID,true);var v=z.Properties.sorder;var D=t+":"+v+":"+g;var u=x.getLatestValue(D,true);if(u!==undefined){u=u.toFixed(2)}else{u=""}var s=x.getLatestQCLevel(D);var C=c.lookupTable.getUOMName(z.Properties.uomID,true);if(l==undefined){l=x.getLatestTime(D);if(l!==undefined){var h=l.replace(" ","T");h=Date.parseDate(h,"c");h=h.format("Y-m-d H:i:s");f="<tr><td>Data Time</td><td>"+h+"</td><tr>"}}B+="<tr><td>"+w+"</td><td>"+u+"</td><td>"+C+"</td></tr>"}}}p+=f;p+=B;p+="</tbody></table>";c.toolTip.body.update(p);c.toolTip.syncSize()}catch(j){}if(c.googAnalytics!==undefined){c.googAnalytics.trackEvent("Interactive Map Platforms","Hover",k)}}}}})},onFeatureSelect:function(c){this.clearPopup();var a=this.featureStore.getRecordFromFeature(c);if(a!==undefined){this.nfoPopup=new rcoosmapping.popup({id:"FeaturePopup",map:this.mapObj,title:"Feature Information",autoScroll:true,location:c.geometry.getBounds().getCenterLonLat(),panIn:true,width:500,height:350,collapsible:true,anchored:true,feature:a,selectControl:this.selectControl,googAnalytics:this.googAnalytics});
this.nfoPopup.show();var d=this.lookupTable.getDataURL(c.attributes.staDataURL);var b=d+c.attributes.staDataFile;Ext.Ajax.request({autoAbort:true,url:b,scriptTag:true,callbackName:"json_callback",scope:this,extraParams:{feature:a},success:function(j,h){var g;var e;var l;if(j.responseText){try{g=Ext.util.JSON.decode(j.responseText);l={features:g.features}}catch(k){g=undefined;e=undefined}if(this.nfoPopup!==undefined){try{this.nfoPopup.setObsData(l)}catch(f){if(console!==undefined){console.exception(f)}}}}},failure:function(g,f){try{this.nfoPopup.setObsData(undefined)}catch(e){if(console!==undefined){console.exception(e)}}}});if(this.googAnalytics!==undefined){this.googAnalytics.trackEvent("Interactive Map Platforms","Click",a.get("staID"))}}},onFeatureUnselect:function(a){var b=0},clearPopup:function(){if(this.hoverTimeout!==undefined){clearTimeout(this.hoverTimeout);this.hoverTimeout=undefined}if(this.toolTip!==undefined){this.toolTip.destroy();this.toolTip=undefined}if(this.nfoPopup!==undefined){this.nfoPopup.close();this.nfoPopup=undefined}},enableToolTips:function(a){if(a){if(this.hoverControl!==undefined){this.hoverControl.activate();this.selectControl.activate()}}else{if(this.hoverControl!==undefined){this.hoverControl.deactivate();this.selectControl.deactivate()}}}});OpenLayers.Layer.WMSEx=OpenLayers.Class(OpenLayers.Layer.WMS,{alwaysRefresh:false,initialize:function(b,a,d,c){this.alwaysRefresh=c.alwaysRefresh;this.eventListeners={loadstart:this.loadStart};OpenLayers.Layer.WMS.prototype.initialize.apply(this,arguments)},loadStart:function(b,a){if(this.alwaysRefresh){this.mergeNewParams({random:Math.random()})}}});rcoosmapping.kmlLayer=Ext.extend(OpenLayers.Layer.Vector,{popup:undefined,mapObj:undefined,googAnalytics:undefined,constructor:function(a,b){if(b.strategies!=undefined&&b.strategies.toUpperCase()=="FIXED"){b.strategies=[new OpenLayers.Strategy.Fixed()]}if(b.protocol!=undefined){b.protocol=new OpenLayers.Protocol.HTTP({url:b.protocol.url,format:new OpenLayers.Format.KML({extractStyles:b.protocol.format.extractStyles,extractAttributes:b.protocol.format.extractAttributes,maxDepth:b.protocol.format.maxDepth})})}if(b.projection!=undefined){b.projection=new OpenLayers.Projection(b.projection)}rcoosmapping.kmlLayer.superclass.constructor.call(this,a,b);if(b.map!=undefined&&b.QUERYABLE!=undefined&&b.QUERYABLE){this.createSelectFeature(b.map)}},setGoogleAnalytics:function(a){this.googAnalytics=a},createSelectFeature:function(b){this.mapObj=b;var a=new OpenLayers.Control.SelectFeature([this],{onSelect:this.kmlClick,scope:this});this.mapObj.addControl(a)},clearPopup:function(){if(this.popup!=undefined){this.popup.close();this.popup=undefined}},buildContent:function(a){return(a.attributes.description)},kmlClick:function(a){this.clearPopup();var b=this.buildContent(a);this.popup=new GeoExt.Popup({id:"kmlPopup",map:this.mapObj,title:"Information",autoScroll:true,location:a,width:375,height:200,collapsible:true,anchored:true,html:b});this.popup.show();if(this.googAnalytics!=undefined){this.googAnalytics.trackEvent("KML Feature","Click")}}});rcoosmapping.earthNCCharts=OpenLayers.Class(OpenLayers.Layer.XYZ,{constructor:function(b,a,c){rcoosmapping.earthNCCharts.superclass.constructor.call(this,b,configParams.layerOptions.options)},getURL:function(d){var c=this.map.getResolution();var e=this.map.getZoom()+this.map.baseLayer.minZoomLevel;var g=Math.round((d.left-this.maxExtent.left)/(c*this.tileSize.w));var f=Math.round((this.maxExtent.top-d.top)/(c*this.tileSize.h));var b=1<<e;f=b-f-1;var a=this.url;var j=""+g+f+e;if(a instanceof Array){a=this.selectUrl(j,a)}var h=OpenLayers.String.format(a,{x:g,y:f,z:e});return(h)}});OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:true,type:"png",useScales:false,overrideDPI:false,initialize:function(c,b,k){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);if(this.resolutions){this.serverResolutions=this.resolutions;
this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0])}if(this.layerInfo){var f=this.layerInfo;var h=new OpenLayers.Bounds(f.fullExtent.xmin,f.fullExtent.ymin,f.fullExtent.xmax,f.fullExtent.ymax);this.projection="EPSG:"+f.spatialReference.wkid;this.sphericalMercator=(f.spatialReference.wkid==102100);this.units=(f.units=="esriFeet")?"ft":"m";if(!!f.tileInfo){this.tileSize=new OpenLayers.Size(f.tileInfo.width||f.tileInfo.cols,f.tileInfo.height||f.tileInfo.rows);this.tileOrigin=new OpenLayers.LonLat(f.tileInfo.origin.x,f.tileInfo.origin.y);var a=new OpenLayers.Geometry.Point(h.left,h.top);var e=new OpenLayers.Geometry.Point(h.right,h.bottom);if(this.useScales){this.scales=[]}else{this.resolutions=[]}this.lods=[];for(var l in f.tileInfo.lods){var j=f.tileInfo.lods[l];if(this.useScales){this.scales.push(j.scale)}else{this.resolutions.push(j.resolution)}var d=this.getContainingTileCoords(a,j.resolution);j.startTileCol=d.x;j.startTileRow=d.y;var g=this.getContainingTileCoords(e,j.resolution);j.endTileCol=g.x;j.endTileRow=g.y;this.lods.push(j)}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]);this.serverResolutions=this.resolutions;if(this.overrideDPI&&f.tileInfo.dpi){OpenLayers.DOTS_PER_INCH=f.tileInfo.dpi}}}},getContainingTileCoords:function(a,b){return new OpenLayers.Pixel(Math.max(Math.floor((a.x-this.tileOrigin.lon)/(this.tileSize.w*b)),0),Math.max(Math.floor((this.tileOrigin.lat-a.y)/(this.tileSize.h*b)),0))},calculateMaxExtentWithLOD:function(f){var c=(f.endTileCol-f.startTileCol)+1;var b=(f.endTileRow-f.startTileRow)+1;var a=this.tileOrigin.lon+(f.startTileCol*this.tileSize.w*f.resolution);var e=a+(c*this.tileSize.w*f.resolution);var d=this.tileOrigin.lat-(f.startTileRow*this.tileSize.h*f.resolution);var g=d-(b*this.tileSize.h*f.resolution);return new OpenLayers.Bounds(a,g,e,d)},calculateMaxExtentWithExtent:function(b,e){var d=new OpenLayers.Geometry.Point(b.left,b.top);var c=new OpenLayers.Geometry.Point(b.right,b.bottom);var g=this.getContainingTileCoords(d,e);var a=this.getContainingTileCoords(c,e);var f={resolution:e,startTileCol:g.x,startTileRow:g.y,endTileCol:a.x,endTileRow:a.y};return this.calculateMaxExtentWithLOD(f)},getUpperLeftTileCoord:function(b){var a=new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top);return this.getContainingTileCoords(a,b)},getLowerRightTileCoord:function(b){var a=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(a,b)},getMaxExtentForResolution:function(g){var c=this.getUpperLeftTileCoord(g);var f=this.getLowerRightTileCoord(g);var h=(f.x-c.x)+1;var j=(f.y-c.y)+1;var e=this.tileOrigin.lon+(c.x*this.tileSize.w*g);var b=e+(h*this.tileSize.w*g);var a=this.tileOrigin.lat-(c.y*this.tileSize.h*g);var d=a-(j*this.tileSize.h*g);return new OpenLayers.Bounds(e,d,b,a)},clone:function(a){if(a==null){a=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options)}return OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},getMaxExtent:function(){var a=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(a)},getTileOrigin:function(){var a=this.getMaxExtent();return new OpenLayers.LonLat(a.left,a.bottom)},getURL:function(j){var g=this.getResolution();var d=(this.tileOrigin.lon+(g*this.tileSize.w/2));var c=(this.tileOrigin.lat-(g*this.tileSize.h/2));var k=j.getCenterLonLat();var n={x:k.lon,y:k.lat};var m=(Math.round(Math.abs((k.lon-d)/(g*this.tileSize.w))));var l=(Math.round(Math.abs((c-k.lat)/(g*this.tileSize.h))));var h=this.map.getZoom();if(this.lods){var f=this.lods[this.map.getZoom()];h=f.level;if((m<f.startTileCol||m>f.endTileCol)||(l<f.startTileRow||l>f.endTileRow)){return null}}else{var b=this.getUpperLeftTileCoord(g);var e=this.getLowerRightTileCoord(g);if((m<b.x||m>=e.x)||(l<b.y||l>=e.y)){return null}}var a=this.url;var o=""+m+l+h;if(a instanceof Array){a=this.selectUrl(o,a)}if(this.useArcGISServer){a=a+"/tile/${z}/${y}/${x}"}else{m="C"+this.zeroPad(m,8,16);l="R"+this.zeroPad(l,8,16);
h="L"+this.zeroPad(h,2,16);a=a+"/${z}/${y}/${x}."+this.type}a=OpenLayers.String.format(a,{x:m,y:l,z:h});return a},zeroPad:function(b,a,c){var d=b.toString(c||10);while(d.length<a){d="0"+d}return d},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"});rcoosmapping.utils={reprojectPoint:function(c,d,b,g){var f=new OpenLayers.Projection(c);var e=new OpenLayers.Projection(d);var a=new OpenLayers.LonLat(b,g);a.transform(f,e);return(a)}};GeoExt.tree.layerLoaderExtended=Ext.extend(GeoExt.tree.LayerLoader,{defaultGFILayer:"",createNode:function(a){this.baseAttrs.cls="layer-tree-node";if(this.baseAttrs.radioGroup!=undefined){if(a.layer.options.QUERYABLE!=undefined&&a.layer.options.QUERYABLE==false){delete this.baseAttrs.radioGroup}}if(this.baseAttrs.slider!=undefined){if(a.layer.options.opacitySlider!=undefined&&a.layer.options.opacitySlider==false){delete this.baseAttrs.slider}}var b=GeoExt.tree.layerLoaderExtended.superclass.createNode.apply(this,arguments);b.layer.events.on({loadstart:this.loadStart,scope:b});b.layer.events.on({loadend:this.loadEnd,scope:b});b.layer.events.on({loadcancel:this.loadCancel,scope:b});return b},loadStart:function(a,b){this.setIcon("./resources/images/default/grid/loading.gif")},loadEnd:function(a,b){this.setIcon("./resources/images/default/tree/leaf.gif")},loadCancel:function(a,b){this.setIcon("./resources/images/default/tree/leaf.gif")}});rcoosmapping.olMap=Ext.extend(Ext.Panel,{olMap:undefined,dataLayerTree:undefined,tileCacheURL:"",mapservURL:"",mapFile:"",ImageType:"image/png",TileCacheMod:"",nfoPopup:undefined,layerStore:undefined,initGFISelect:false,helpWindow:undefined,mapLegendURL:"",googAnalytics:undefined,lookupTable:null,insituPlatforms:null,mapInited:false,constructor:function(a){this.toolbarItems=[];this.obsInfoControls=[];rcoosmapping.olMap.superclass.constructor.call(this,a)},createPanel:function(a){this.layout="border";this.title=a;this.hideMode="offsets";this.autoScroll=true;this.draggable=false;this.add({id:"westPanel-"+a,region:"west",title:" ",split:true,width:200,minSize:175,maxSize:400,collapsible:true,margins:"0 0 0 5",layout:"accordion",layoutConfig:{animate:true},deferredRender:false,items:[this.dataLayerTree]});this.add({id:"mapPanel-"+a,region:"center",title:"Map",layout:"fit",frame:false,border:true,margins:"5 5 0 0",deferredRender:false,items:[{xtype:"gx_mappanel",map:this.olMap,layers:this.layerStore,zoom:13,border:false,tbar:this.toolbarItems,id:a+"OLMap"}]});this.add({id:"legendPanel-"+a,region:"east",title:"Map Legend",width:200,collapsible:true,margins:"0 0 0 5",autoScroll:true,deferredRender:false,items:[{bodyCssClass:"east-panel-body",title:"",height:"auto",autoLoad:{url:this.mapLegendURL,scripts:false},border:true,autoScroll:true}]})},createToolbar:function(b){var a=function(c){c.push(" ");c.push("-");c.push(" ")};action=new GeoExt.Action({control:new OpenLayers.Control.ZoomToMaxExtent(),map:this.olMap,iconCls:"zoomfull",toggleGroup:b,tooltip:"Zoom to full extent"});this.toolbarItems.push(action);a(this.toolbarItems);action=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox(),tooltip:"Zoom in: click in the olMap or use the left mouse button and drag to create a rectangle",map:this.olMap,iconCls:"zoomin",toggleGroup:b});this.toolbarItems.push(action);action=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox({out:true}),tooltip:"Zoom out: click in the olMap or use the left mouse button and drag to create a rectangle",map:this.olMap,iconCls:"zoomout",toggleGroup:b});this.toolbarItems.push(action);action=new GeoExt.Action({control:new OpenLayers.Control.DragPan({isDefault:false}),tooltip:"Pan olMap: keep the left mouse button pressed and drag the olMap",map:this.olMap,iconCls:"pan",toggleGroup:b});this.toolbarItems.push(action);a(this.toolbarItems);action=new GeoExt.Action({control:new OpenLayers.Control.WMSGetFeatureInfo({isDefault:true}),tooltip:"For layers with querying ability, this issues a request for the data",map:this.olMap,iconCls:"info",toggleGroup:b});this.toolbarItems.push(action);
a(this.toolbarItems);action=new Ext.Action({tooltip:"General Map Help",handler:function(){if(this.helpWindow!=undefined){this.helpWindow.close()}this.helpWindow=new Ext.Window({title:"Help",autoScroll:true,height:500,width:"auto",autoLoad:{url:"./help.html",scripts:false},border:true});this.helpWindow.show()},iconCls:"help",toggleGroup:b,scope:this});this.toolbarItems.push(action)},createMap:function(c){var b=navigator.appName;var a=navigator.appVersion;var d=a.substring(22,25);if(b=="Microsoft Internet Explorer"&&d=="6.0"){this.ImageType="image/png1";this.TileCacheMod="ie6"}this.olMap=new OpenLayers.Map(c)},createLayer:function(a,c,b,g,e,f){var d=null;if(a=="OpenLayers.Layer.WMS"){var d=new OpenLayers.Layer.WMS(c,b,g,e);if(f){this.obsInfoControls.push({click:new OpenLayers.Control.WMSGetFeatureInfo({layers:[d],queryVisible:true,maxFeatures:1,vendorParams:{map:d.params.MAP}})})}}if(a=="OpenLayers.Layer.WMSEx"){d=new OpenLayers.Layer.WMSEx(c,b,g,e);if(f!=undefined&&f){this.obsInfoControls.push({click:new OpenLayers.Control.WMSGetFeatureInfo({layers:[d],queryVisible:true,maxFeatures:1,vendorParams:{map:d.params.MAP}})})}}else{if(a=="OpenLayers.Layer.Google"){d=new OpenLayers.Layer.Google(c,e)}else{if(a=="OpenLayers.Layer.XYZ"){d=new OpenLayers.Layer.XYZ(c,b,e)}else{if(a=="rcoosmapping.earthNCCharts"){d=new rcoosmapping.earthNCCharts(c,b,e)}else{if(a=="OpenLayers.Layer.Vector"){d=new OpenLayers.Layer.Vector(c,e)}else{if(a=="OpenLayers.Layer.ArcGISCache"){d=new OpenLayers.Layer.ArcGISCache(c,b,e)}}}}}}return(d)},addWMSLayer:function(b,a,f,d,e){var c=new OpenLayers.Layer.WMS(b,a,f,d);this.olMap.addLayer(c);if(e){this.obsInfoControls.push({click:new OpenLayers.Control.WMSGetFeatureInfo({url:a,layers:[c],queryVisible:true,maxFeatures:1})})}return(c)},addGoogleLayer:function(a,c){var b=new OpenLayers.Layer.Google(a,c);this.olMap.addLayer(b);return(b)},createLayers:function(a){this.addLayers(a);this.buildGFIControls();this.layerStore=new GeoExt.data.LayerStore({map:this.olMap,layers:this.olMap.layers,initDir:GeoExt.data.LayerStore.MAP_TO_STORE})},addLayers:function(h){if(h!==undefined){var j=h.layers;var g=j.length;for(var d=0;d<g;d++){var e=j[d];for(var b in e.children){if(b!==undefined){var l=e.children[b];var a;if(l.url!==undefined){a=l.url}var c;if(l.params!==undefined){c=l.params}var k;if(l.options!==undefined){k=l.options}if(l.type=="OpenLayers.Layer.Google"){if(k.type=="G_PHYSICAL_MAP"){k.type=G_PHYSICAL_MAP}else{if(k.type=="G_HYBRID_MAP"){k.type=G_HYBRID_MAP}}}var f=this.createLayer(l.type,b,a,c,k,l.EnableGetFeatureInfo);if(f!==null){this.olMap.addLayer(f)}else{if(l.type=="rcoosmapping.platformVectorLayer"){f=new rcoosmapping.platformVectorLayer(b,{layerOptions:l,map:this.olMap,googAnalytics:this.googAnalytics,parentPanel:this});f.getFeaturesData()}}if(l.zIndexDelta!=undefined){this.olMap.raiseLayer(f,l.zIndexDelta)}}}}}},createLayerTree:function(b){var c=Ext.extend(GeoExt.tree.LayerNodeUI,new GeoExt.tree.TreeNodeUIEventMixinExtended());var a=new Ext.tree.AsyncTreeNode({expanded:true});this.dataLayerTree=new Ext.tree.TreePanel({bodyCssClass:"west-panel-body",title:b,border:false,header:true,draggable:false,autoScroll:true,loader:new Ext.tree.TreeLoader({applyLoader:false,uiProviders:{layernodeui:c}}),root:a,plugins:[new GeoExt.tree.RadioButtonPlugin({listeners:{scope:this,radiochange:function(k){var g=this.olMap;var d=g.controls.length;for(var f=0;f<d;f++){var l=g.controls[f];if(l.layers!=undefined){var h=l.layers.length;for(var e=0;e<h;e++){if(k.layer.name==l.layers[e].name){l.activate()}else{l.deactivate()}}}}}}}),new GeoExt.tree.LayerOpacitySliderPlugin({listeners:{opacityslide:function(d,e){}}}),new GeoExt.tree.LayerInfoPlugin({listeners:{layerinfoclick:function(d,e){window.open(d.layer.attributionLink)}}})],rootVisible:false,lines:false})},populateLayerTree:function(c){this.displayLayerInGroup=function(e){var d=e.get("layer");if(d.displayInLayerSwitcher){if(d.options.GROUP==this.baseAttrs.group){if(d.options.QUERYABLE!=undefined&&d.options.QUERYABLE){this.baseAttrs.radioGroup="radioGroup";
this.baseAttrs.uiProvider="layernodeui"}if(d.options.opacitySlider!=undefined&&d.options.opacitySlider){this.baseAttrs.slider="layeropacityslider";this.baseAttrs.uiProvider="layernodeui"}if(d.options.attributionLink!=undefined&&d.options.attributionLink){this.baseAttrs.layerinfo="layerinfoclick";this.baseAttrs.uiProvider="layernodeui"}return(true)}}return(false)};this.displayInBaseLayer=function(e){var d=e.get("layer");if(d.displayInLayerSwitcher){if(d.isBaseLayer){return(true)}}return(false)};this.buildTreeNodes=function(g,d){emptyGroupName="";var l=[];f={id:"Base Layer",cls:"layer-tree-node",nodeType:"gx_baselayercontainer",expanded:true,loader:new GeoExt.tree.layerLoaderExtended({baseAttrs:{},filter:this.displayInBaseLayer,store:this.layerStore})};l.push(f);for(var k=0;k<g.length;k++){var m=g[k];if(m.displayInLayerSwitcher==false||m.isBaseLayer){continue}if(m.options.GROUP==undefined){layerGroup=emptyGroupName}var e=false;var n=l.length;var o=-1;for(var h=0;h<n;h++){if(l[h].text==m.options.GROUP){e=true;break}}if(!e){var f;f={id:m.options.GROUP,cls:"layer-tree-node",text:m.options.GROUP,nodeType:"gx_layercontainer",expanded:true,loader:new GeoExt.tree.layerLoaderExtended({defaultGFILayer:"Real Time Observations",baseAttrs:{group:m.options.GROUP},filter:this.displayLayerInGroup,store:this.layerStore})};l.push(f)}}return(l)};var b=this.buildTreeNodes(c,name);var a=new Ext.tree.AsyncTreeNode({expanded:true,children:b});this.dataLayerTree.setRootNode(a);return(this.dataLayerTree)},addLayerToTreeNode:function(a){if(a.options!=undefined&&a.options.GROUP!=undefined){var b=this.dataLayerTree.getNodeById(a.options.GROUP);if(b==undefined){}else{}}},setInitialGFINode:function(f,c){var a=this.dataLayerTree.getRootNode();var d=a.findChild("text",f);if(d!=null){for(var b=0;b<d.childNodes.length;b++){if(d.childNodes[b].text==c){var e=d.childNodes[b].getUI();e.node.attributes.radio.checked=true;break}}}},launchInfoPopup:function(c,d,b){this.clearPopup();var a=d.getLonLatFromPixel(c.xy);this.nfoPopup=new GeoExt.Popup({id:"FeaturePopup",map:d,title:"Feature Information",autoScroll:true,location:a,html:c.text,width:300,height:"auto",collapsible:true,anchored:true,ctCls:b});this.nfoPopup.show()},obsInfoClick:function(a){this.launchInfoPopup(a,this.olMap,"featurePopupBox")},clearPopup:function(){if(this.nfoPopup!==undefined){this.nfoPopup.close();this.nfoPopup=undefined}},buildGFIControls:function(){var a=this.obsInfoControls.length;for(var c=0;c<a;c++){var b=this.obsInfoControls[c].click;b.events.register("getfeatureinfo",this,this.obsInfoClick);this.olMap.addControl(b);b.activate()}},getJsonData:function(b,a,d){var c=OpenLayers.ProxyHost+b;Ext.Ajax.request({url:c,success:a,failure:d,scope:this})},configAjaxQuery:function(c,b){var a=Ext.util.JSON.decode(c.responseText)},setLegendURL:function(a){this.mapLegendURL=a},setCenter:function(a,c){for(var b in this.olMap.controls){var d=this.olMap.controls[b];if(d.CLASS_NAME=="OpenLayers.Control.ArgParser"){if(d.center==null||c){this.olMap.setCenter(a)}break}}},setAnalytics:function(a){this.googAnalytics=a},mapInitialized:function(a){this.mapInited=a},init:function(a,g,d,b){this.dataServerIP=a;this.tileCacheURL="http://"+d+"/tilecache/tilecache.py?";this.mapservURL="http://"+g+"/cgi-bin/mapserv?";this.secooraMapFile="/home/xeniaprod/mapping/secoora/SecooraObs.map";this.generalMapFile="/home/xeniaprod/mapping/common/general.map";this.ImageType="image/png";this.TileCacheMod="";this.mapLegendURL="legend.html";if(b.googAnalytics!=undefined){this.setAnalytics(b.googAnalytics)}OpenLayers.ProxyHost=b.proxyHost;var h=b.mapConfig;var f=rcoosmapping.utils.reprojectPoint(h.displayProjection,h.projection,h.mapExtents.lowerLeft.lon,h.mapExtents.lowerLeft.lat);var c=rcoosmapping.utils.reprojectPoint(h.displayProjection,h.projection,h.mapExtents.upperRight.lon,h.mapExtents.upperRight.lat);var e={maxExtent:new OpenLayers.Bounds(f.lon,f.lat,c.lon,c.lat),numZoomLevels:h.numZoomLevels,maxResolution:h.maxResolution,resolutions:h.resolutions,projection:new OpenLayers.Projection(h.projection),displayProjection:new OpenLayers.Projection(h.displayProjection),units:h.units,controls:[new OpenLayers.Control.Navigation({zoomWheelEnabled:true,autoActivate:true}),new OpenLayers.Control.MousePosition({numdigits:2}),new OpenLayers.Control.PanZoomBar(),new OpenLayers.Control.Permalink("permalink"),new OpenLayers.Control.ScaleLine()]};
this.createMap(e);this.olMap.id=b.layerTreeName;this.createToolbar(b.toolbarGroupName);this.createLayers(h);this.createLayerTree(b.layerTreeName);this.populateLayerTree(this.olMap.layers);this.dataLayerTree.addListener("checkchange",this.treeNodeCheckChange,this)}});