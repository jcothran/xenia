#summary vmware considerations and best practices

<wiki:toc max_depth="6" />

see also vmware documents [http://www.vmware.com/appliances/partner/vmware_ready/test_matrix.html test matrix] [http://www.vmware.com/files/pdf/vam_virtual_appliance_guidelines.pdf appliance guidelines]

= Security = 

_Try to keep the distributed image as secure as possible._

As an image or clone, any security weaknesses in one copy will be present in all copies until the image security issue is addressed or the image patched and updated.

Any personal/institutional information or passwords should not be included as part of the distributed image(remove/change before merge/distribution).


#system
users: root, user, xeniaprod
files: /etc/hosts.allow
applications: java/tomcat, geoserver

#postgres
users: postgres, xeniaprod
files: pg_hba.conf

/home/xeniaprod/config

= Storage = 

_Try to keep the distributed image physical disk size as small as possible._

Relevant applications and software should be included on the image, but large associated datasets should be referenced off-image with documentation regarding access as a separate link or download.

#system
/usr2/data/xeniaprod

#postgres
/usr2/pg_data

= Organization = 

_Try to keep the applications and their locations or associated crons as organized as possible._

For the Xenia related scripts, everything should be currently located under the directory branch */home/xeniaprod* and accessed via the user *xeniaprod* with an associated *crontab* for running user 'xeniaprod' scripts.

There is one user crontab entry under user 'root' relating to nightly *cleanup* of files generated by apache/web user 'www-data'.

The folders/scripts under /home/xeniaprod should reflect the same xenia project *svn* folder/scripts structure for consistency between the project and svn.  This will not be true for the initial version 1.0 release(svn will lag image scripts due to many conversion changes), but should be corrected in upcoming release.

= Code/Scripts = 

Try to make configuration easier by placing all configuration options and security information within the same or a few *config files* (say in XML format).  Failing this, try to use comment LABELS which are documented and easily seen and searched for in the code.

Try to make common code *flexible enough for reuse in a variety of possible contexts*.  For instance, would prefer to have one script with a few database flag options (Oracle,SQL Server, PostgreSQL, MySQL, Sqlite, etc) than several scripts which only vary by their database connection method and small differences in SQL syntax.

= Checklist =

{{{
search for #VM_CONFIG in effected files

#stop crons - root, xeniaprod

#enable #VM_CONFIG
xeniaprod: crontab -e

#enable feeds as needed
/home/xeniaprod/cron/getObskml.sh
/home/xeniaprod/cron/mk_xenia_all_latest.sh

=
#postgres
optional - database size on /usr2, delete old records - vacuum

user passwds - postgres,xeniaprod
psql -U postgres -h xxx.xxx.xxx.xxx
alter user postgres with password 'postgres99';
alter user xeniaprod with password 'xeniaprod99';

#enable #VM_CONFIG ip addresses
sudo vi /usr2/pg_data/pg_hba.conf

cd /home/xeniaprod/config #database user/password
  dbConfig.ini
  environment_xenia_default.xml

/etc/hosts.allow  #ssh ip access
/etc/exports #nfs remote mount access

=
#reset user passwds to public defaults - user,root,xeniaprod,postgres - as root, passwd <username>

#remove hidden log, history files
cd /home/xeniaprod
ls -la -sort

rm .sqlite_history 
rm .ssh/known_hosts 
rm .gnuplot_history
rm .bash_history 
rm .psql_history 
rm /var/lib/postgresql/.psql_history

#remove old log, tmp files under /usr2

=
clear users history (history -c)

clear apache/tomcat, application logs
=
optional - reboot, check ps-auxf, top
}}}

= Shortlist =

{{{
#within server image

1)stop xeniaprod crontab

2)comment out 'extra' data flow inputs

3)change db passwords, config file references

4)access - /etc/hosts.allow,/etc/exports,pg.hba

5)user passwords default/neutral set

6)clear user home history files, history

7)re-enable sample crontab flow

#from vSphere power off image

#from vCenter select image as source, destination as 'virtual appliance' and begin image copy

#split image, edit version reference,etc to download wiki page

E:\accord_backup\vmware\xeniavm20090722>c:\unxutils\usr\local\wbin\split.exe --b
ytes=2000m xeniavm20090722.vmdk multi

#move large single image to archive desktop folder, upload split image to torino via scp
}}}