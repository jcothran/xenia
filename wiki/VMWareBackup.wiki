#summary Process for backing up VMWare Images via ghettoVCB

= Introduction =

[http://communities.vmware.com/docs/DOC-8760 ghettoVCB] is a script that resides in the ESXi host which can backup your VMWare images to a NAS devices.

= Server setup =
We're running a mixture of ESXi 4.0 and ESXi 5.0 host servers. To get ghettoVCB to work, the ssh port must be open to have console access to the OS.
== Enabling SSH Console Access ==
  * ESXi 4.0, [http://www.vm-help.com/esx40i/ESXi_enable_SSH.php here] are the instructions I followed.
  * ESXi 5.0, [http://kb.vmware.com/selfservice/microsites/search.do?cmd=displayKC&docType=kc&docTypeID=DT_KB_1_1&externalId=2004746 here] are the instructions I followed.

== Setup on ESXi ==
Although I did not specifically see this in the ghettoVCB documentation, many users had posted to the forum that directories not under /vmfs/volumes were deleted under a reboot. 
I created a user: vmbackup to be able to have ssh access when needed. Initially, you need to have root ssh access to make changes, but once the cron is setup and everything seems to be work, it is worthwhile to disallow root access.
For our setups, I created a backup directory under /vmfs/volumes/datastore1/backup where I placed the various pieces:
  * ghettoVCB.sh - Backup shell script
  * daily_backup.conf - configuration file for the script that has settings specific for the daily backups
  * daily_list.txt - list of VM Images to backup on the daily cycle.
  * weekly_backup.conf - config file for the weekly backups.
  * weekly_list.txt - list of VM Images to backup on the weekly cycle.
There is no crontab editor such as crontab -e in ESXi, instead you directly edit the file: /var/spool/cron/crontabs/root . The setup is the same as a normal *Nix cron job.

== Backup location ==
Our .112 NAS is the location the VM images are copied to. The directories are:
  * daily - /taurus/vmbackups/mnt_backup 
  * weekly - /taurus/vmbackups/weekly (not yet enabled)

== To Do ==
The .vmdk files are very large, finding a way to compress them would be very helpful in conserving drive space.